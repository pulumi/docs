<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
    <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="google-site-verification" content="j-Opn93zR4YQcV5bbYN99BmNc48BT5mzd2VpzKaW9YY" />

    

    
    <meta property="og:type" content="article">
    <meta property="og:url" content="/docs/quickstart/cloudfx/tutorial-thumbnailer/">
    <meta property="og:site_name" content="pulumi">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@PulumiCorp">

    

    
        <meta property="og:title" content="Tutorial: Multi-Cloud Containers and Serverless">
    

    
        <meta name="description" content="In this tutorial, we&rsquo;ll use JavaScript to combine serverless, containers and cloud infrastructure together into a &ldquo;Colada&rdquo; application. We use serverless functions as event triggers and containers for longer-running tasks.
We&rsquo;ll build an application that extracts a thumbnail from a video using AWS Lambda and Fargate. Below is the architecture of the Pulumi application. The code for this tutorial is available on GitHub, and a video walkthrough of this example is available on YouTube.">
        <meta property="og:description" content="In this tutorial, we&rsquo;ll use JavaScript to combine serverless, containers and cloud infrastructure together into a &ldquo;Colada&rdquo; application. We use serverless functions as event triggers and containers for longer-running tasks.
We&rsquo;ll build an application that extracts a thumbnail from a video using AWS Lambda and Fargate. Below is the architecture of the Pulumi application. The code for this tutorial is available on GitHub, and a video walkthrough of this example is available on YouTube.">
    

    
    
    <meta property="og:image" content="/social/pulumi.png">

    <title>Tutorial: Multi-Cloud Containers and Serverless - Pulumi</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />

    
    <link rel="canonical" href="https://www.pulumi.com/docs/quickstart/cloudfx/tutorial-thumbnailer/" >

    
    <link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Pulumi Blog" />

    
    
    
        
        
        
        <link rel="stylesheet" href="/css/styles.3496f5522ba2ee3f8bbb9a51ff2cb20fb6827ca85a8ae61de0a9f960bacf1023.css" integrity="sha256-NJb1Uiui7j&#43;Lu5pR/yyyD7aCfKhaiuYd4Kn5YLrPECM=">
    

    <script async defer src="https://buttons.github.io/buttons.js"></script>

    
    
        <script src="//cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function(event) {
                anchors.add("h1:not(.no-anchor), h2:not(.no-anchor), h3:not(.no-anchor), h4:not(.no-anchor), h5:not(.no-anchor), h6:not(.no-anchor)");
            });
        </script>
    

    
    
</head>

    <body class="section-docs">
        <nav class="bg-black text-white text-sm py-2 px-4 lg:px-0 transition-all max-h-screen md:max-h-full">
    <div class="container mx-auto">
        <ul class="flex justify-end items-center h-6">
            <li class="mr-8"><a href="https://slack.pulumi.io/" target="_blank">Slack</a></li>
            <li class="mr-8"><a href="https://github.com/pulumi" target="_blank">GitHub</a></li>
            <li class="mr-8"><a href="https://app.pulumi.com/" target="_blank">Console</a></li>
            <li class="github-widget">
                <a class="github-button" href="https://github.com/pulumi/pulumi" data-size="small" data-show-count="true" aria-label="Star pulumi/pulumi on GitHub">Star</a>
            </li>
        </ul>
    </div>
</nav>



<nav class="nav-main bg-purple-700 py-6 px-4 lg:px-0 border-t border-purple-500">
    <div class="container mx-auto">
        <header class="flex items-center justify-between flex-wrap md:flex-no-wrap">
            <div class="flex items-center flex-shrink-0 text-white lg:mr-6">
                <a class="block" href="/">
                    <img class="h-10 block" src="/images/logo/logo-inv.svg" alt="Pulumi logo">
                </a>
            </div>

            <div class="nav-header-toggle block md:hidden">
                <button class="flex items-center px-3 py-2 border rounded text-white border-purple-400 bg-purple-600">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <ul class="nav-header-items hidden w-full flex-grow md:flex md:items-center md:w-auto text-white text-sm md:text-xs lg:text-sm uppercase pt-4 md:pt-0">
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/product/" data-submenu="product" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Products
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/why-pulumi/" data-submenu="why" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Why Pulumi
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/pricing/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Pricing
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/docs/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded bg-purple-400 hover:bg-purple-400">
                            Docs
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/blog/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Blog
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/about/" data-submenu="about" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            About
                        </a>
                    </li>
                

                <li class="md:ml-auto md:mr-2 lg:mr-4">
                    <a class="block mt-4 md:mt-0 md:text-xs lg:text-sm btn btn-orange-translucent" href="https://app.pulumi.com/">Sign In</a>
                </li>
                <li>
                    <a class="block mt-4 md:mt-0 md:text-xs lg:text-sm btn" href="https://app.pulumi.com/signup">Sign Up</a>
                </li>
            </ul>
        </header>
    </div>
</nav>
<div class="submenu">
    <div class="text-white relative overflow-visible">
        <div class="submenu-item submenu-item-product hidden absolute inset-x-0 z-50 bg-purple-700 shadow-lg pt-8 pb-16">
            <div class="container mx-auto flex items-start">
                <div class="w-1/2 pr-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">The Pulumi Platform</h3>
                    <p class="text-white">
                        Cloud Apps and Infrastructure for any cloud using languages you already know and love.
                    </p>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-sdk">Pulumi SDK</a>
                            <span>&rarr; Cloud native infrastructure as code.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-crosswalk">Pulumi Crosswalk</a>
                            <span>&rarr; Productive infrastructure as code with built-in best practices.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-saas">Pulumi SaaS</a>
                            <span>&rarr; Continuously deliver and manage cloud software for any cloud.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#multi-cloud-subscription">Multi-Cloud Subscription</a>
                            <span>&rarr; End-to-end Kubernetes solutions to achieve multi-cloud.</span>
                        </li>
                    </ul>
                    <p>
                        <span class="text-white">Pulumi is open source, free to start, and has plans available for teams.</span>
                        <a class="text-orange-500 hover:text-orange-400 hover:mr-1 transition-all" href="/pricing/">View Pricing</a> &rarr;
                    </p>
                </div>
                <div class="w-1/2 pl-12 text-purple-100 text-sm">
                    <h3 class="text-white">Get Started</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/reference/install/">Install (Mac, Windows, Linux)</a> &rarr;
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/">Documentation and Examples</a> &rarr;
                        </li>
                    </ul>
                    <h3 class="text-white">Migrate to Pulumi</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/cloudformation/">from CloudFormation</a> &rarr;
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/terraform/">from Terraform</a> &rarr;
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="submenu-item submenu-item-why hidden absolute inset-x-0 z-50 bg-purple-700 shadow pt-8 pb-16">
           <div class="container mx-auto flex items-start">
                <div class="w-1/2 pr-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">Solutions for All Teams and Engineers</h3>
                    <p class="text-white">
                        Maximize cloud velocity for Dev, DevOps, and IT, no matter your team size.
                    </p>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-developers">For Developers</a>
                            <span>&rarr; Your favorite languages, tools, and libraries.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-operators">For DevOps and IT</a>
                            <span>&rarr; Empower your team to deliver to many clouds.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-business-leaders">For Business Leaders</a>
                            <span>&rarr; Modern multi-cloud for startups and enterprises.</span>
                        </li>
                    </ul>
                </div>
                <div class="w-1/4 px-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">Any Code</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/serverless/">Serverless</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/containers/">Containers</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/kubernetes/">Kubernetes</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/reference/tutorials/aws/tutorial-ec2-webserver/">Infrastructure</a>
                            <span>&rarr;</span>
                        </li>
                    </ul>
                </div>
                <div class="w-1/4 pl-12 text-purple-100 text-sm">
                    <h3 class="text-white">Migrate to Pulumi</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/aws/">AWS</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/azure/">Azure</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/gcp/">GCP</a>
                            <span>&rarr;</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


        
        

        <main>
            
    <div class="container mx-auto px-8 py-8 md:px-0">
        <div class="md:flex">

            <div class="md:w-2/12 mt-2 md:order-last">
                <div class="mb-8 md:mb-4">
                    <form class="relative" action="/docs/search/" method="GET">
    <i class="fas fa-search absolute inset-y-0 flex items-center pl-3 text-gray-500"></i>
    <input
        id="search-query"
        name="q"
        class="block w-full py-2 px-4 pl-8 text-sm border border-gray-400 focus:border-blue-500 focus:outline-none rounded transition"
        placeholder="Search the docs"
        autocomplete="off">
</form>

                </div>

                <div class="ml-3 hidden md:block">
                    
    <ul class="p-0 list-none">
        
        
        
        
        
            <li>
                <a class="text-gray-600 hover:text-blue-700 text-xs" href="https://github.com/pulumi/docs/edit/master/content/docs/quickstart/cloudfx/tutorial-thumbnailer.md" target="_blank">
                    <i class="fas fa-edit mr-2"></i>
                    Edit this Page
                </a>
            </li>
        

        <li>
            <a class="text-gray-600 hover:text-blue-700 text-xs" href="https://github.com/pulumi/docs/issues/new?body=File: [docs%2fquickstart%2fcloudfx%2ftutorial-thumbnailer.md](%2fdocs%2fquickstart%2fcloudfx%2ftutorial-thumbnailer%2f)" target="_blank">
                <i class="far fa-check-square mr-2"></i>
                Request a Change
            </a>
        </li>
    </ul>


                </div>
            </div>

            <div class="md:w-3/12 pr-8 mt-2 mb-8 pb-8 border-b-2 border-gray-400 md:border-none md:pb-0 md:mb-0">
                








    
    
    


<aside class="toc">
    <h3 class="no-anchor">
        <a href="/docs/">Docs</a>
    </h3>

    
        <h4 class="no-anchor">
            <a href="/docs/quickstart/">Get Started</a>
        </h4>
    
    
    

    
        
        

        
            
            

            

            <div class="toggleVisible separator">
                <div class="toggle" data-title="AWS">
                    <div class="collapsed">
                        <div class="sidenav-topic ">
                            <a data-title="AWS" href="/docs/quickstart/aws/">AWS</a><span class="toggleButton">
                                    <i class="fas fa-caret-right"></i>
                                </span></div>
                    </div>
                    <div class="expanded">
                        <div class="sidenav-topic  sidenav-parent  ">
                            <a data-title="AWS" href="/docs/quickstart/aws/">AWS</a><span class="toggleButton">
                                    <i class="fas fa-caret-down"></i>
                                </span></div>
                        
                            <div class="sidenav-subsection text-sm">
                                
    
    

    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Install Pulumi" href="/docs/quickstart/aws/install-pulumi/">Install Pulumi</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Install Language Runtime" href="/docs/quickstart/aws/install-language-runtime/">Install Language Runtime</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Configure AWS" href="/docs/quickstart/aws/configure/">Configure AWS</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Create a New Project" href="/docs/quickstart/aws/create-project/">Create a New Project</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Review the New Project" href="/docs/quickstart/aws/review-project/">Review the New Project</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Deploy the Stack" href="/docs/quickstart/aws/deploy-stack/">Deploy the Stack</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Modify the Program" href="/docs/quickstart/aws/modify-program/">Modify the Program</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Deploy the Changes" href="/docs/quickstart/aws/deploy-changes/">Deploy the Changes</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Destroy the Stack" href="/docs/quickstart/aws/destroy-stack/">Destroy the Stack</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Next Steps" href="/docs/quickstart/aws/next-steps/">Next Steps</a>
            </div>
        
    

                            </div>
                        
                    </div>
                </div>
            </div>
        
            
            

            

            <div class="toggleVisible separator">
                <div class="toggle" data-title="Azure">
                    <div class="collapsed">
                        <div class="sidenav-topic ">
                            <a data-title="Azure" href="/docs/quickstart/azure/">Azure</a><span class="toggleButton">
                                    <i class="fas fa-caret-right"></i>
                                </span></div>
                    </div>
                    <div class="expanded">
                        <div class="sidenav-topic  sidenav-parent  ">
                            <a data-title="Azure" href="/docs/quickstart/azure/">Azure</a><span class="toggleButton">
                                    <i class="fas fa-caret-down"></i>
                                </span></div>
                        
                            <div class="sidenav-subsection text-sm">
                                
    
    

    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Install Pulumi" href="/docs/quickstart/azure/install-pulumi/">Install Pulumi</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Install Language Runtime" href="/docs/quickstart/azure/install-language-runtime/">Install Language Runtime</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Configure Azure" href="/docs/quickstart/azure/configure/">Configure Azure</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Create a New Project" href="/docs/quickstart/azure/create-project/">Create a New Project</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Review the New Project" href="/docs/quickstart/azure/review-project/">Review the New Project</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Deploy the Stack" href="/docs/quickstart/azure/deploy-stack/">Deploy the Stack</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Modify the Program" href="/docs/quickstart/azure/modify-program/">Modify the Program</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Deploy the Changes" href="/docs/quickstart/azure/deploy-changes/">Deploy the Changes</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Destroy the Stack" href="/docs/quickstart/azure/destroy-stack/">Destroy the Stack</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Next Steps" href="/docs/quickstart/azure/next-steps/">Next Steps</a>
            </div>
        
    

                            </div>
                        
                    </div>
                </div>
            </div>
        
            
            

            

            <div class="toggleVisible separator">
                <div class="toggle" data-title="Google Cloud">
                    <div class="collapsed">
                        <div class="sidenav-topic ">
                            <a data-title="Google Cloud" href="/docs/quickstart/gcp/">Google Cloud</a><span class="toggleButton">
                                    <i class="fas fa-caret-right"></i>
                                </span></div>
                    </div>
                    <div class="expanded">
                        <div class="sidenav-topic  sidenav-parent  ">
                            <a data-title="Google Cloud" href="/docs/quickstart/gcp/">Google Cloud</a><span class="toggleButton">
                                    <i class="fas fa-caret-down"></i>
                                </span></div>
                        
                            <div class="sidenav-subsection text-sm">
                                
    
    

    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Install Pulumi" href="/docs/quickstart/gcp/install-pulumi/">Install Pulumi</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Install Language Runtime" href="/docs/quickstart/gcp/install-language-runtime/">Install Language Runtime</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Configure Google Cloud" href="/docs/quickstart/gcp/configure/">Configure Google Cloud</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Create a New Project" href="/docs/quickstart/gcp/create-project/">Create a New Project</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Review the New Project" href="/docs/quickstart/gcp/review-project/">Review the New Project</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Deploy the Stack" href="/docs/quickstart/gcp/deploy-stack/">Deploy the Stack</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Modify the Program" href="/docs/quickstart/gcp/modify-program/">Modify the Program</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Deploy the Changes" href="/docs/quickstart/gcp/deploy-changes/">Deploy the Changes</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Destroy the Stack" href="/docs/quickstart/gcp/destroy-stack/">Destroy the Stack</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Next Steps" href="/docs/quickstart/gcp/next-steps/">Next Steps</a>
            </div>
        
    

                            </div>
                        
                    </div>
                </div>
            </div>
        
            
            

            

            <div class="toggleVisible">
                <div class="toggle" data-title="Kubernetes">
                    <div class="collapsed">
                        <div class="sidenav-topic ">
                            <a data-title="Kubernetes" href="/docs/quickstart/kubernetes/">Kubernetes</a><span class="toggleButton">
                                    <i class="fas fa-caret-right"></i>
                                </span></div>
                    </div>
                    <div class="expanded">
                        <div class="sidenav-topic  sidenav-parent  ">
                            <a data-title="Kubernetes" href="/docs/quickstart/kubernetes/">Kubernetes</a><span class="toggleButton">
                                    <i class="fas fa-caret-down"></i>
                                </span></div>
                        
                            <div class="sidenav-subsection text-sm">
                                
    
    

    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Install Pulumi" href="/docs/quickstart/kubernetes/install-pulumi/">Install Pulumi</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Install Language Runtime" href="/docs/quickstart/kubernetes/install-language-runtime/">Install Language Runtime</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Configure Kubernetes" href="/docs/quickstart/kubernetes/configure/">Configure Kubernetes</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Create a New Project" href="/docs/quickstart/kubernetes/create-project/">Create a New Project</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Review the New Project" href="/docs/quickstart/kubernetes/review-project/">Review the New Project</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Deploy the Stack" href="/docs/quickstart/kubernetes/deploy-stack/">Deploy the Stack</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Modify the Program" href="/docs/quickstart/kubernetes/modify-program/">Modify the Program</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Deploy the Changes" href="/docs/quickstart/kubernetes/deploy-changes/">Deploy the Changes</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Destroy the Stack" href="/docs/quickstart/kubernetes/destroy-stack/">Destroy the Stack</a>
            </div>
        
    
        
        

        
            <div class="sidenav-topic mb-2 ">
                <a data-title="Next Steps" href="/docs/quickstart/kubernetes/next-steps/">Next Steps</a>
            </div>
        
    

                            </div>
                        
                    </div>
                </div>
            </div>
        

    

    
        <h4 class="no-anchor">
            <a href="/docs/reference/">Reference</a>
        </h4>
    
</aside>



            </div>

            <div class="md:w-7/12">
                <h1>Tutorial: Multi-Cloud Containers and Serverless</h1>
                

<p>In this tutorial, we&rsquo;ll use JavaScript to combine serverless, containers and cloud infrastructure together into a
&ldquo;Colada&rdquo; application. We use serverless functions as event triggers and containers for longer-running tasks.</p>

<p>We&rsquo;ll build an application that extracts a thumbnail from a video using AWS Lambda and
<a href="https://aws.amazon.com/fargate/">Fargate</a>. Below is the architecture of the Pulumi application. The
code for this tutorial is <a href="https://github.com/pulumi/examples/tree/master/cloud-js-thumbnailer">available on GitHub</a>,
and a video walkthrough of this example is <a href="https://www.youtube.com/watch?v=Bofmh1qnNSE">available on YouTube</a>.</p>

<p><img src="/images/docs/quickstart/video-thumbnail-diagram.png" alt="Video thumbnail diagram" width="600"></p>

<h2 id="prerequisites">Prerequisites</h2>

<ol>
    <li><a href="/docs/reference/install/">Install Pulumi</a></li>
    <li><a href="/docs/reference/clouds/aws/setup/">Configure AWS credentials</a></li>
</ol>


<h2 id="create-and-deploy-the-project">Create and deploy the project</h2>

<ol>
<li><p>Make sure <a href="https://docs.docker.com/install/">Docker</a> is installed and running.</p></li>

<li><p>Run <code>pulumi new</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ mkdir video-thumbnail <span class="o">&amp;&amp;</span> <span class="nb">cd</span> video-thumbnail
$ pulumi new aws-javascript</code></pre></div></li>

<li><p>Replace the contents of <code>index.js</code> with the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="k">const</span> <span class="nx">cloud</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@pulumi/cloud-aws&#34;</span><span class="p">);</span>

<span class="c1">// A bucket to store videos and thumbnails.
</span><span class="c1"></span><span class="k">const</span> <span class="nx">bucket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cloud</span><span class="p">.</span><span class="nx">Bucket</span><span class="p">(</span><span class="s2">&#34;bucket&#34;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">bucketName</span> <span class="o">=</span> <span class="nx">bucket</span><span class="p">.</span><span class="nx">bucket</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

<span class="c1">// A task which runs a containerized FFMPEG job to extract a thumbnail image.
</span><span class="c1"></span><span class="k">const</span> <span class="nx">ffmpegThumbnailTask</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cloud</span><span class="p">.</span><span class="nx">Task</span><span class="p">(</span><span class="s2">&#34;ffmpegThumbTask&#34;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">build</span><span class="o">:</span> <span class="s2">&#34;./&#34;</span><span class="p">,</span>  <span class="c1">// folder containing the Dockerfile
</span><span class="c1"></span>    <span class="nx">memoryReservation</span><span class="o">:</span> <span class="mi">512</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// When a new video is uploaded, run the FFMPEG task on the video file.
</span><span class="c1">// Use the time index specified in the filename (e.g. cat_00-01.mp4 uses timestamp 00:01)
</span><span class="c1"></span><span class="nx">bucket</span><span class="p">.</span><span class="nx">onPut</span><span class="p">(</span><span class="s2">&#34;onNewVideo&#34;</span><span class="p">,</span> <span class="nx">bucketArgs</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`*** New video: file </span><span class="si">${</span><span class="nx">bucketArgs</span><span class="p">.</span><span class="nx">key</span><span class="si">}</span><span class="sb"> was uploaded at </span><span class="si">${</span><span class="nx">bucketArgs</span><span class="p">.</span><span class="nx">eventTime</span><span class="si">}</span><span class="sb">.`</span><span class="p">);</span>
    <span class="k">const</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">bucketArgs</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>

    <span class="k">const</span> <span class="nx">thumbnailFile</span> <span class="o">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">framePos</span> <span class="o">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)).</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">);</span>

    <span class="nx">ffmpegThumbnailTask</span><span class="p">.</span><span class="nx">run</span><span class="p">({</span>
        <span class="nx">environment</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&#34;S3_BUCKET&#34;</span><span class="o">:</span>   <span class="nx">bucketName</span><span class="p">.</span><span class="nx">get</span><span class="p">(),</span>
            <span class="s2">&#34;INPUT_VIDEO&#34;</span><span class="o">:</span> <span class="nx">file</span><span class="p">,</span>
            <span class="s2">&#34;TIME_OFFSET&#34;</span><span class="o">:</span> <span class="nx">framePos</span><span class="p">,</span>
            <span class="s2">&#34;OUTPUT_FILE&#34;</span><span class="o">:</span> <span class="nx">thumbnailFile</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Running thumbnailer task.`</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">},</span> <span class="p">{</span> <span class="nx">keySuffix</span><span class="o">:</span> <span class="s2">&#34;.mp4&#34;</span> <span class="p">});</span>

<span class="c1">// When a new thumbnail is created, log a message.
</span><span class="c1"></span><span class="nx">bucket</span><span class="p">.</span><span class="nx">onPut</span><span class="p">(</span><span class="s2">&#34;onNewThumbnail&#34;</span><span class="p">,</span> <span class="nx">bucketArgs</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`*** New thumbnail: file </span><span class="si">${</span><span class="nx">bucketArgs</span><span class="p">.</span><span class="nx">key</span><span class="si">}</span><span class="sb"> was saved at </span><span class="si">${</span><span class="nx">bucketArgs</span><span class="p">.</span><span class="nx">eventTime</span><span class="si">}</span><span class="sb">.`</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
<span class="p">},</span> <span class="p">{</span> <span class="nx">keySuffix</span><span class="o">:</span> <span class="s2">&#34;.jpg&#34;</span> <span class="p">});</span>

<span class="c1">// Export the bucket name.
</span><span class="c1"></span><span class="nx">exports</span><span class="p">.</span><span class="nx">bucketName</span> <span class="o">=</span> <span class="nx">bucketName</span><span class="p">;</span>
</code></pre></div>
<p>This code declares the following resources:</p>

<ul>
<li><strong>Cloud infrastructure</strong>. S3 bucket for videos and still frames. We define a <a href="/docs/reference/stack/#outputs">stack output property</a> <code>bucketName</code>, to easily retrieve this value after the project has been deployed.</li>
<li><strong>Containers</strong>. Uses <a href="/docs/reference/pkg/nodejs/pulumi/cloud/#Task">cloud.Task</a>, which is a high-level, convenient component for working with containers. The component automatically provisions a container registry instance in ECR, runs a Docker build, and saves the Docker image to the provisioned ECR instance. It also defines an ECS task and configures it to use the built image.</li>
<li><strong>Serverless functions</strong>

<ul>
<li>The Lambda function <code>onNewVideo</code> is triggered whenever a new <code>.mp4</code> video file is uploaded to the S3 bucket. The Lambda extracts the time index that is encoded in the video filename (in the form <code>file_mm-ss</code>) and launches the container task.</li>
<li>The Lambda function <code>onNewThumbnail</code> is triggered when a new <code>.jpg</code> thumbnail file is uploaded to the S3 bucket, and prints a message to the log file.</li>
</ul></li>
</ul></li>

<li><p>In the same directory, create a <code>Dockerfile</code> with the following contents. For the container setup, it uses an existing container for FFmpeg ad installs Python and the AWS CLI. When the container is started, it copies the video file from S3, runs <code>ffmpeg</code>, and copies the output back to S3.</p>
<div class="highlight"><pre class="chroma"><code class="language-docker" data-lang="docker"><span class="k">FROM</span><span class="s"> jrottenberg/ffmpeg</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span><span class="se"></span>    apt-get install python-dev python-pip -y <span class="o">&amp;&amp;</span> <span class="se">\
</span><span class="se"></span>    apt-get clean<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">RUN</span> pip install awscli<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /tmp/workdir</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">ENTRYPOINT</span><span class="s"> \</span><span class="err">
</span><span class="err"></span>  <span class="nb">echo</span> <span class="s2">&#34;Starting ffmpeg task...&#34;</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span><span class="se"></span>  <span class="nb">echo</span> <span class="s2">&#34;Copying video from S3&#34;</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span><span class="se"></span>  aws s3 cp s3://<span class="si">${</span><span class="nv">S3_BUCKET</span><span class="si">}</span>/<span class="si">${</span><span class="nv">INPUT_VIDEO</span><span class="si">}</span> ./<span class="si">${</span><span class="nv">INPUT_VIDEO</span><span class="si">}</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span><span class="se"></span>  ffmpeg -v error -i ./<span class="si">${</span><span class="nv">INPUT_VIDEO</span><span class="si">}</span> -ss <span class="si">${</span><span class="nv">TIME_OFFSET</span><span class="si">}</span> -vframes <span class="m">1</span> -f image2 -an -y <span class="si">${</span><span class="nv">OUTPUT_FILE</span><span class="si">}</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span><span class="se"></span>  <span class="nb">echo</span> <span class="s2">&#34;Copying thumbnail to S3&#34;</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span><span class="se"></span>  aws s3 cp ./<span class="si">${</span><span class="nv">OUTPUT_FILE</span><span class="si">}</span> s3://<span class="si">${</span><span class="nv">S3_BUCKET</span><span class="si">}</span>/<span class="si">${</span><span class="nv">OUTPUT_FILE</span><span class="si">}</span></code></pre></div></li>

<li><p>Install the <code>@pulumi/cloud-aws</code> NPM package:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ npm install --save @pulumi/cloud-aws @pulumi/cloud</code></pre></div></li>

<li><p>Configure Pulumi to use AWS Fargate. (Note: Fargate is currently available only in <code>us-east-1</code>, <code>us-east-2</code>, <code>us-west-2</code>, and <code>eu-west-1</code>).</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ pulumi config <span class="nb">set</span> cloud-aws:useFargate true</code></pre></div></li>

<li><p>Preview and deploy changes via <code>pulumi up</code>, which will take a few minutes. During the preview phase, Pulumi runs the Docker build.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ pulumi up
Previewing update of stack <span class="s1">&#39;thumbnailer-testing&#39;</span>
...

Diagnostics:
  ...
  global: global
    info: Building container image <span class="s1">&#39;pulum-dc8d99de-container&#39;</span>: <span class="nv">context</span><span class="o">=</span>./docker-ffmpeg-thumb

Do you want to perform this update? yes
Updating stack <span class="s1">&#39;thumbnailer-testing&#39;</span>
Performing changes:
...

---outputs:---
bucketName: <span class="s2">&#34;bucket-0c91106&#34;</span>

info: <span class="m">32</span> changes performed:
    + <span class="m">32</span> resources created
Update duration: 1m48.486679173s</code></pre></div></li>
</ol>

<h2 id="test-the-application">Test the application</h2>

<p>To test the application, we&rsquo;ll upload a video to S3, view the running application logs, then download the thumbnail from S3.</p>

<h3 id="1-upload-a-video-to-s3">1. Upload a video to S3</h3>

<ul>
<li><p>Download <a href="https://github.com/pulumi/examples/blob/master/cloud-js-thumbnailer/sample/cat.mp4?raw=true">a short sample video</a> to your project folder.</p></li>

<li><p>Copy the video to S3, encoding the time index in the filename (00:01 becomes <code>00-01</code>):</p>

<pre><code>$ aws s3 cp cat.mp4 s3://$(pulumi stack output bucketName)/cat_00-01.mp4
upload: cat.mp4 to s3://bucket-0c91106/cat_00-01.mp4
</code></pre></li>
</ul>

<h3 id="2-view-logs">2. View logs</h3>

<p>Run <code>pulumi logs -f</code> for the streaming logs of the Lambda functions as well as the Fargate task. Note that the log contains a prefix that matches the functions and tasks in your code, such as <code>onNewVideo</code> and <code>ffmpegThumbTask</code>:</p>

<pre><code>$ pulumi logs -f
Collecting logs for stack thumbnail-quickstart-dev since 2018-05-25T13:32:27.000-07:00.

 2018-05-25T14:29:17.935-07:00[                    onNewVideo] *** New video: file cat_00-01.mp4 was uploaded at 2018-05-25T21:29:17.230Z.
 2018-05-25T14:29:22.319-07:00[                    onNewVideo] Running thumbnailer task.
 2018-05-25T14:30:25.995-07:00[               ffmpegThumbTask] Starting ffmpeg task...
 2018-05-25T14:30:25.995-07:00[               ffmpegThumbTask] Copying video FROM S3
download: s3://bucket-756b44a/cat_00-01.mp4 to ./cat_00-01.mp4    pleted 256.0 KiB/666.5 KiB (1.9 MiB/s) with 1 file(s) remaining
 2018-05-25T14:30:31.037-07:00[               ffmpegThumbTask] Copying thumbnail TO S3
upload: ./cat.jpg to s3://bucket-756b44a/cat.jpg                  pleted 86.6 KiB/86.6 KiB (303.9 KiB/s) with 1 file(s) remaining
 2018-05-25T14:30:34.298-07:00[                onNewThumbnail] *** New thumbnail: file cat.jpg was saved at 2018-05-25T21:30:33.724Z.
</code></pre>

<h3 id="3-download-the-thumbnail-file">3. Download the thumbnail file</h3>

<p>After you see the <code>*** New thumbnail</code> message, copy the jpg from S3.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ aws s3 cp s3://<span class="k">$(</span>pulumi stack output bucketName<span class="k">)</span>/cat.jpg .
download: s3://bucket-0c91106/cat.jpg to ./cat.jpg</code></pre></div>
<h2 id="clean-up">Clean up</h2>

<p>Let's remove the cloud resources that have been provisioned.</p>

<ol>
    <li>Run <code>pulumi destroy</code> to tear down all resources.</li>
    <li>To delete the stack itself, run <code>pulumi stack rm</code>. Note that this command deletes all deployment history from the Pulumi Console.</li>
</ol>


<h2 id="next-steps">Next steps</h2>

<p>For a version of this sample that includes AWS Rekognition, see the <a href="https://github.com/pulumi/examples/tree/master/cloud-js-thumbnailer-machine-learning">Video Thumbnailer with Machine Learning</a> JavaScript example.</p>

<p>For an example application that connects two containers, see the <a href="https://github.com/pulumi/examples/tree/master/cloud-ts-voting-app">Voting App</a> TypeScript sample.</p>

            </div>
        </div>
    </div>

        </main>

        <nav class="footer bg-purple-700 py-8 px-8 md:px-0">
    <div class="container mx-auto">
        <footer>
            <div class="md:flex items-top justify-between flex-wrap">

                <div class="mb-6 md:w-4/12">
                    <a class="block mt-2" href="/">
                        <img class="h-10 opacity-50" src="/images/logo/logo-white.svg" alt="Pulumi logo">
                    </a>
                    <a class="inline-block my-4 opacity-50 text-white text-lg" href="mailto:team@pulumi.com">team@pulumi.com</a>
                    <ul class="flex inline-items text-blue-300 text-2xl">
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://twitter.com/pulumicorp" target="_blank"><i class="fab fa-twitter"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://www.linkedin.com/company/pulumi/" target="_blank"><i class="fab fa-linkedin"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://github.com/pulumi/" target="_blank"><i class="fab fa-github"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://www.youtube.com/channel/UC2Dhyn4Ev52YSbcpfnfP0Mw" target="_blank"><i class="fab fa-youtube"></i></a></li>
                        <li><a class="hover:text-blue-200" href="https://slack.pulumi.io/" target="_blank"><i class="fab fa-slack-hash"></i></a></li>
                    </ul>
                </div>

                <div class="flex flex-wrap items-top md:w-8/12">
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/containers/">Containers</a></li>
                        <li class="mb-4"><a href="/serverless/">Serverless</a></li>
                        <li class="mb-4"><a href="/docs/reference/tutorials/aws/tutorial-ec2-webserver/">Infrastructure</a></li>
                        <li class="mb-4"><a href="/kubernetes/">Kubernetes</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/docs/reference/install/">Install</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/">Get Started</a></li>
                        <li class="mb-4"><a href="/docs/reference/">Documentation</a></li>
                        <li class="mb-4"><a href="/docs/reference/pkg/">APIs</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/docs/quickstart/aws/">AWS</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/azure/">Azure</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/gcp/">Google Cloud</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/kubernetes/">Kubernetes</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/cloudfx/">Cloud Framework</a></li>
                        <li class="mb-4"><a href="/docs/reference/clouds/openstack/">OpenStack</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/about/">About Us</a></li>
                        <li class="mb-4"><a href="/contact/">Contact Us</a></li>
                        <li class="mb-4"><a href="/support/">Support</a></li>
                        <li class="mb-4"><a href="/careers/">Careers</a></li>
                    </ul>
                </div>
            </div>

            <div class="text-white opacity-75 text-sm lg:flex items-center border-t border-purple-500 mt-4 pt-4">
                
                <p class="md:w-4/12">&copy; 2019 Pulumi. All rights reserved.</p>

                <ul class="md:w-8/12">
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/trademark/">Trademark Usage</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/acceptable-use/">Acceptable Use Policy</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/terms-and-conditions/">Terms &amp; Conditions</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/privacy/">Privacy Policy</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/professional-services-agreement/">Professional Services Agreement</a></li>
                    
                </ul>
            </div>
        </footer>
    </div>
</nav>

        <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>











    




<script src="/js/bundle.min.8d935315b94bf6e77843b9c51ebc10238af740294e751f49b183b5d1e27a1c27.js" integrity="sha256-jZNTFblL9ud4Q7nFHrwQI4r3QClOdR9JsYO10eJ6HCc="></script>

    </body>
</html>
