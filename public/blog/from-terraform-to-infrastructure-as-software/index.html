<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
    <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="google-site-verification" content="j-Opn93zR4YQcV5bbYN99BmNc48BT5mzd2VpzKaW9YY" />

    

    
    <meta property="og:type" content="article">
    <meta property="og:url" content="/blog/from-terraform-to-infrastructure-as-software/">
    <meta property="og:site_name" content="pulumi">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@PulumiCorp">

    
        
            
            
                
                    <meta name="twitter:creator" content="@pgavlin">
                
            
        
    

    
        <meta property="og:title" content="From Terraform to Infrastructure as Software">
    

    
        <meta name="description" content="Here at Pulumi, we love programming the cloud using infrastructure as
code. From the project&rsquo;s outset, we&rsquo;ve been inspired by technologies
like Terraform, AWS CloudFormation, and Helm, and in fact leverage the
Terraform Providers ecosystem, to support a broad range of clouds,
including AWS, Azure, and Google Cloud. Just recently, we extended this
with first class support for Kubernetes. Pulumi delivers the same
infrastructure as code workflows only using general purpose languages
like JavaScript, TypeScript, Python, and Go, extending robust
infrastructure provisioning with abstraction and reuse, highly
productive tooling, and access to all the other things we already know
and love about programming languages.

In this article, we will convert existing Terraform configuration to
Pulumi TypeScript. By doing so, we&rsquo;ll see how using general purpose
programming languages can help you create simpler, more flexible
infrastructure as code, with greater productivity and less repetition.
The infrastructure we&rsquo;ll be working with describes a load-balanced web
server hosted by an AWS EC2 instance per availability zone with an
option to allow SSH access. Of course, these same benefits would also
accrue were we to target Azure, Google Cloud, or Kubernetes instead.">
        <meta property="og:description" content="Here at Pulumi, we love programming the cloud using infrastructure as
code. From the project&rsquo;s outset, we&rsquo;ve been inspired by technologies
like Terraform, AWS CloudFormation, and Helm, and in fact leverage the
Terraform Providers ecosystem, to support a broad range of clouds,
including AWS, Azure, and Google Cloud. Just recently, we extended this
with first class support for Kubernetes. Pulumi delivers the same
infrastructure as code workflows only using general purpose languages
like JavaScript, TypeScript, Python, and Go, extending robust
infrastructure provisioning with abstraction and reuse, highly
productive tooling, and access to all the other things we already know
and love about programming languages.

In this article, we will convert existing Terraform configuration to
Pulumi TypeScript. By doing so, we&rsquo;ll see how using general purpose
programming languages can help you create simpler, more flexible
infrastructure as code, with greater productivity and less repetition.
The infrastructure we&rsquo;ll be working with describes a load-balanced web
server hosted by an AWS EC2 instance per availability zone with an
option to allow SSH access. Of course, these same benefits would also
accrue were we to target Azure, Google Cloud, or Kubernetes instead.">
    

    
    
        
            
        
    
    <meta property="og:image" content="/blog/from-terraform-to-infrastructure-as-software/tf-to-pulumi.png">

    <title>From Terraform to Infrastructure as Software - Pulumi</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />

    
    <link rel="canonical" href="https://www.pulumi.com/blog/from-terraform-to-infrastructure-as-software/" >

    
    <link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Pulumi Blog" />

    
    
    
        
        
        
        <link rel="stylesheet" href="/css/styles.3496f5522ba2ee3f8bbb9a51ff2cb20fb6827ca85a8ae61de0a9f960bacf1023.css" integrity="sha256-NJb1Uiui7j&#43;Lu5pR/yyyD7aCfKhaiuYd4Kn5YLrPECM=">
    

    <script async defer src="https://buttons.github.io/buttons.js"></script>

    
    
        <script src="//cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function(event) {
                anchors.add("h1:not(.no-anchor), h2:not(.no-anchor), h3:not(.no-anchor), h4:not(.no-anchor), h5:not(.no-anchor), h6:not(.no-anchor)");
            });
        </script>
    

    
    
        
            
                
            
        
        
    
</head>

    <body class="section-blog">
        <nav class="bg-black text-white text-sm py-2 px-4 lg:px-0 transition-all max-h-screen md:max-h-full">
    <div class="container mx-auto">
        <ul class="flex justify-end items-center h-6">
            <li class="mr-8"><a href="https://slack.pulumi.io/" target="_blank">Slack</a></li>
            <li class="mr-8"><a href="https://github.com/pulumi" target="_blank">GitHub</a></li>
            <li class="mr-8"><a href="https://app.pulumi.com/" target="_blank">Console</a></li>
            <li class="github-widget">
                <a class="github-button" href="https://github.com/pulumi/pulumi" data-size="small" data-show-count="true" aria-label="Star pulumi/pulumi on GitHub">Star</a>
            </li>
        </ul>
    </div>
</nav>



<nav class="nav-main bg-purple-700 py-6 px-4 lg:px-0 border-t border-purple-500">
    <div class="container mx-auto">
        <header class="flex items-center justify-between flex-wrap md:flex-no-wrap">
            <div class="flex items-center flex-shrink-0 text-white lg:mr-6">
                <a class="block" href="/">
                    <img class="h-10 block" src="/images/logo/logo-inv.svg" alt="Pulumi logo">
                </a>
            </div>

            <div class="nav-header-toggle block md:hidden">
                <button class="flex items-center px-3 py-2 border rounded text-white border-purple-400 bg-purple-600">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <ul class="nav-header-items hidden w-full flex-grow md:flex md:items-center md:w-auto text-white text-sm md:text-xs lg:text-sm uppercase pt-4 md:pt-0">
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/product/" data-submenu="product" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Products
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/why-pulumi/" data-submenu="why" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Why Pulumi
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/pricing/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Pricing
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/docs/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Docs
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/blog/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded bg-purple-400 hover:bg-purple-400">
                            Blog
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/about/" data-submenu="about" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            About
                        </a>
                    </li>
                

                <li class="md:ml-auto md:mr-2 lg:mr-4">
                    <a class="block mt-4 md:mt-0 md:text-xs lg:text-sm btn btn-orange-translucent" href="https://app.pulumi.com/">Sign In</a>
                </li>
                <li>
                    <a class="block mt-4 md:mt-0 md:text-xs lg:text-sm btn" href="https://app.pulumi.com/signup">Sign Up</a>
                </li>
            </ul>
        </header>
    </div>
</nav>
<div class="submenu">
    <div class="text-white relative overflow-visible">
        <div class="submenu-item submenu-item-product hidden absolute inset-x-0 z-50 bg-purple-700 shadow-lg pt-8 pb-16">
            <div class="container mx-auto flex items-start">
                <div class="w-1/2 pr-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">The Pulumi Platform</h3>
                    <p class="text-white">
                        Cloud Apps and Infrastructure for any cloud using languages you already know and love.
                    </p>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-sdk">Pulumi SDK</a>
                            <span>&rarr; Cloud native infrastructure as code.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-crosswalk">Pulumi Crosswalk</a>
                            <span>&rarr; Productive infrastructure as code with built-in best practices.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-saas">Pulumi SaaS</a>
                            <span>&rarr; Continuously deliver and manage cloud software for any cloud.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#multi-cloud-subscription">Multi-Cloud Subscription</a>
                            <span>&rarr; End-to-end Kubernetes solutions to achieve multi-cloud.</span>
                        </li>
                    </ul>
                    <p>
                        <span class="text-white">Pulumi is open source, free to start, and has plans available for teams.</span>
                        <a class="text-orange-500 hover:text-orange-400 hover:mr-1 transition-all" href="/pricing/">View Pricing</a> &rarr;
                    </p>
                </div>
                <div class="w-1/2 pl-12 text-purple-100 text-sm">
                    <h3 class="text-white">Get Started</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/reference/install/">Install (Mac, Windows, Linux)</a> &rarr;
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/">Documentation and Examples</a> &rarr;
                        </li>
                    </ul>
                    <h3 class="text-white">Migrate to Pulumi</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/cloudformation/">from CloudFormation</a> &rarr;
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/terraform/">from Terraform</a> &rarr;
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="submenu-item submenu-item-why hidden absolute inset-x-0 z-50 bg-purple-700 shadow pt-8 pb-16">
           <div class="container mx-auto flex items-start">
                <div class="w-1/2 pr-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">Solutions for All Teams and Engineers</h3>
                    <p class="text-white">
                        Maximize cloud velocity for Dev, DevOps, and IT, no matter your team size.
                    </p>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-developers">For Developers</a>
                            <span>&rarr; Your favorite languages, tools, and libraries.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-operators">For DevOps and IT</a>
                            <span>&rarr; Empower your team to deliver to many clouds.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-business-leaders">For Business Leaders</a>
                            <span>&rarr; Modern multi-cloud for startups and enterprises.</span>
                        </li>
                    </ul>
                </div>
                <div class="w-1/4 px-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">Any Code</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/serverless/">Serverless</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/containers/">Containers</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/kubernetes/">Kubernetes</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/reference/tutorials/aws/tutorial-ec2-webserver/">Infrastructure</a>
                            <span>&rarr;</span>
                        </li>
                    </ul>
                </div>
                <div class="w-1/4 pl-12 text-purple-100 text-sm">
                    <h3 class="text-white">Migrate to Pulumi</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/aws/">AWS</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/azure/">Azure</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/gcp/">GCP</a>
                            <span>&rarr;</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


        
        

        <main>
            
    <div class="container mx-auto px-8 py-8 md:px-0">
        <div class="md:flex">
            <div class="md:w-3/12 pr-8">
                
<aside class="md:pr-8">

    
    <div class="md:hidden">
        <button class="blog-sidebar-toggle items-center px-3 py-2 border rounded text-purple border-purple">
            <i class="fas fa-bars"></i>
        </button>
        <a href="/blog/">üçπ Pulumi Blog</a>
    </div>

    <h3 class="no-anchor hidden md:flex mt-4">
        <a href="/blog/">üçπ Pulumi Blog</a>
    </h3>

    
    <div class="blog-sidebar-content hidden md:block">
        <div class="bg-gray-100 rounded-lg p-4 my-6 text-gray-700">
            <h5 class="no-anchor text-gray-700">Program the Cloud</h5>
            <p class="text-sm my-0">
                Create, deploy, and manage cloud infrastructure using your favorite language.
            </p>
        </div>

        <ul class="list-none p-0 mb-4 inline-flex flex-wrap text-xs">
            
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/apigateway/">
                            apigateway
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/applications/">
                            applications
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/auth/">
                            auth
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/aws/">
                            aws
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/azure/">
                            azure
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/ci/cd/">
                            ci/cd
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/cloud-native/">
                            cloud-native
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/containers/">
                            containers
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/customer/">
                            customer
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/digitalocean/">
                            digitalocean
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/docker/">
                            docker
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/eks/">
                            eks
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/events/">
                            events
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/features/">
                            features
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/gcp/">
                            gcp
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/gke/">
                            gke
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/infrastructure/">
                            infrastructure
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/javascript/">
                            javascript
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/jupyter/">
                            jupyter
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/kubernetes/">
                            kubernetes
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/lambda/">
                            lambda
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/logging/">
                            logging
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/mysql/">
                            mysql
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/new-features/">
                            new-features
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/pulumi/">
                            pulumi
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/pulumi-news/">
                            pulumi-news
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/python/">
                            python
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/security/">
                            security
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/serverless/">
                            serverless
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/testing/">
                            testing
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/typescript/">
                            typescript
                        </a>
                    </li>
                
            
        </ul>

        <div class="hidden lg:block my-4">
            <h5 class="no-anchor">Recent Posts</h5>
            <ul class="list-none p-0">
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/day-2-kubernetes-migrating-eks-nodegroups-with-zero-downtime/">Day 2 Kubernetes: Migrating EKS Node Groups with Zero Downtime</a>
                        </li>
                    
                
                    
                        
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/getting-started-on-digitalocean-with-pulumi/">Getting Started on DigitalOcean with Pulumi</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/pulumi-meetup-recap-apis-custom-resources-and-github-webhooks/">Pulumi Meetup Recap: APIs, Custom Resources and GitHub Webhooks</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/persisting-kubernetes-workloads-with-amazon-efscsi-volumes-using-pulumi-sdks/">Persisting Kubernetes workloads with Amazon EFS CSI volumes using Pulumi open source SDKs</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/unit-testing-infrastructure-in-nodejs-and-mocha/">Unit Testing Your Infrastructure with Node.js and Mocha</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/kubernetes-ingress-with-aws-alb-ingress-controller-and-pulumi-crosswalk/">Kubernetes Ingress with AWS ALB Ingress Controller and Pulumi Crosswalk for AWS</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/globally-distributed-serverless-application-in-100-lines-of-code-infrastructure-included/">Globally-distributed Serverless Application in 100 Lines of Code. Infrastructure Included!</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/hosting-a-static-website-on-azure-with-pulumi/">Hosting a Static Website on Azure with Pulumi</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/running-containers-in-aws-the-lowdown-ecs-fargate-and-eks/">Running Containers in AWS, the Lowdown: ECS, Fargate, and EKS</a>
                        </li>
                    
                
            </ul>
        </div>
    </div>

    <div class="md:hidden pb-4">
        
    </div>
</aside>

            </div>

            <div class="md:w-7/12">
                <article class="mb-8 pb-8 border-b border-gray-200">
                    <h1 class="no-anchor"><a href="/blog/from-terraform-to-infrastructure-as-software/">From Terraform to Infrastructure as Software</a></h1>
                    <div class="flex items-center">
                        <span>
                            <span class="flex items-center">
    
        
        

        <span class="flex items-center mr-2">
            
                <a class="rounded-full p-1 bg-gray-300 mr-2" href="/blog/author/pat-gavlin/">
                    <img class="w-8 rounded-full" src="/images/team/pat-gavlin.jpg" alt="Pat Gavlin" title="Pat Gavlin">
                </a>
                <a class="" href="/blog/author/pat-gavlin/">Pat Gavlin</a>
            
        </span>
    
</span>

                        </span>
                    </div>
                    <section>
                        <p>Here at Pulumi, we love programming the cloud using infrastructure as
code. From the project&rsquo;s outset, we&rsquo;ve been inspired by technologies
like Terraform, AWS CloudFormation, and Helm, and in fact leverage the
Terraform Providers ecosystem, to support a broad range of clouds,
including AWS, Azure, and Google Cloud. Just recently, we extended this
with first class support for Kubernetes. Pulumi delivers the same
infrastructure as code workflows only using general purpose languages
like JavaScript, TypeScript, Python, and Go, extending robust
infrastructure provisioning with abstraction and reuse, highly
productive tooling, and access to all the other things we already know
and love about programming languages.</p>

<p>In this article, we will convert existing Terraform configuration to
Pulumi TypeScript. By doing so, we&rsquo;ll see how using general purpose
programming languages can help you create simpler, more flexible
infrastructure as code, with greater productivity and less repetition.
The infrastructure we&rsquo;ll be working with describes a load-balanced web
server hosted by an AWS EC2 instance per availability zone with an
option to allow SSH access. Of course, these same benefits would also
accrue were we to target Azure, Google Cloud, or Kubernetes instead.</p>

<h2 id="starting-from-terraform-configuration">Starting from Terraform Configuration</h2>

<p>The Terraform configuration we&rsquo;ll be starting with is below. This
configuration accepts a list of AZs and an optional public key as inputs
and produces a (possibly empty) list of the web servers&rsquo; public IP
addresses and the URL of the load-balanced web site as outputs. When a
public key is provided, this configuration will enable SSH access to the
virtual machines that serve the web site.</p>

<p>Let&rsquo;s walk the example one step at a time &ndash; feel free to skip ahead if
you&rsquo;re a Terraform expert and just want to see how Pulumi is different.</p>

<p>First, we declare that¬†<code>availability_zones</code>¬†and¬†<code>public_key</code>¬†are
parameterizable inputs:</p>

<pre><code>variable &quot;availability_zones&quot; {}
variable &quot;public_key&quot; {
    default = &quot;&quot;
}
</code></pre>

<p>And then we look up the latest AWS AMI for Ubuntu Trusty in our current
region. This is what our web server will run when we get around to
provisioning it later:</p>

<pre><code>data &quot;aws_ami&quot; &quot;ubuntu&quot; {
    ¬†most_recent = true

    ¬†filter {
    ¬†¬†¬†name ¬†¬†= &quot;name&quot;
    ¬†¬†¬†values = [&quot;ubuntu/images/hvm-ssd/ubuntu-trusty-14.04-amd64-server-*&quot;]
    ¬†}

    ¬†filter {
    ¬†¬†¬†name ¬†¬†= &quot;virtualization-type&quot;
    ¬†¬†¬†values = [&quot;hvm&quot;]
    ¬†}

    ¬†owners = [&quot;099720109477&quot;] # Canonical
}
</code></pre>

<p>Next, we&rsquo;ll create security groups that allow HTTP ingress on port 80
and, if a public key is available, SSH over port 22, in addition to
allowing outbound Internet access. Notice that we are using
the¬†<code>count</code>¬†property for the SSH rule to enable it conditionally:</p>

<pre><code>resource &quot;aws_security_group&quot; &quot;default&quot; {
    name_prefix = &quot;example_sg&quot;
}

resource &quot;aws_security_group_rule&quot; &quot;allow_http&quot; {
    type = &quot;ingress&quot;
    from_port = 80
    to_port = 80
    protocol = &quot;tcp&quot;
    cidr_blocks = [&quot;0.0.0.0/0&quot;]

    security_group_id = &quot;${aws_security_group.default.id}&quot;
}

resource &quot;aws_security_group_rule&quot; &quot;allow_all_outbound&quot; {
    type = &quot;egress&quot;
    from_port = 0
    to_port = 0
    protocol = &quot;-1&quot;
    cidr_blocks = [&quot;0.0.0.0/0&quot;]

    security_group_id = &quot;${aws_security_group.default.id}&quot;
}

resource &quot;aws_security_group_rule&quot; &quot;allow_ssh&quot; {
    ¬†count = &quot;${var.public_key == &quot;&quot; ? 0 : 1}&quot;

    ¬†type = &quot;ingress&quot;
    ¬†from_port = 22
    ¬†to_port = 22
    ¬†protocol = &quot;tcp&quot;
    ¬†cidr_blocks = [&quot;0.0.0.0/0&quot;]

    ¬†security_group_id = &quot;${aws_security_group.default.id}&quot;
}
</code></pre>

<p>Now let&rsquo;s actually create the web servers. This is where things get a
little awkward in a DSL, because we want to conditionally attach
the¬†<code>key_name</code>, based on whether SSH access is enabled. This requires
that we duplicate some configuration for the key and no-key code paths,
in addition to splitting, transforming, and indexing into our list of
AZs:</p>

<pre><code>    resource &quot;aws_key_pair&quot; &quot;default&quot; {
     ¬†count = &quot;${var.public_key == &quot;&quot; ? 0 : 1}&quot;

     ¬†key_name_prefix = &quot;default&quot;
     ¬†public_key = &quot;${var.public_key}&quot;
    }

    resource &quot;aws_instance&quot; &quot;web-server-key&quot; {
     ¬†count = &quot;${var.public_key == &quot;&quot; ? 0 : length(split(&quot;,&quot;, var.availability_zones))}&quot;

     ¬†ami = &quot;${data.aws_ami.ubuntu.id}&quot;
     ¬†instance_type = &quot;t2.micro&quot;

     ¬†availability_zone = &quot;${element(split(&quot;,&quot;, var.availability_zones), count.index)}&quot;
     ¬†user_data = &quot;${file(&quot;userdata.sh&quot;)}&quot;
     ¬†security_groups = [&quot;${aws_security_group.default.name}&quot;]

     ¬†key_name = &quot;${aws_key_pair.default.0.key_name}&quot;
    }

    resource &quot;aws_instance&quot; &quot;web-server-nokey&quot; {
     ¬†count = &quot;${var.public_key == &quot;&quot; ? length(split(&quot;,&quot;, var.availability_zones)) : 0}&quot;

     ¬†ami = &quot;${data.aws_ami.ubuntu.id}&quot;
     ¬†instance_type = &quot;t2.micro&quot;

     ¬†availability_zone = &quot;${element(split(&quot;,&quot;, var.availability_zones), count.index)}&quot;
     ¬†user_data = &quot;${file(&quot;userdata.sh&quot;)}&quot;
     ¬†security_groups = [&quot;${aws_security_group.default.name}&quot;]
    }
</code></pre>

<p>After creating the web servers, we will create and attach an ELB, so
that traffic is spread across the AZs. This also requires the same
conditional duplication for key and no-key configurations:</p>

<pre><code>resource &quot;aws_elb&quot; &quot;elb&quot; {
    name_prefix = &quot;webelb&quot;

    availability_zones = [&quot;${split(&quot;,&quot;, var.availability_zones)}&quot;]

    listener {
    instance_port = 80
    instance_protocol = &quot;http&quot;
    lb_port = 80 
    lb_protocol = &quot;http&quot;
    }

    health_check {
    healthy_threshold = 2
    unhealthy_threshold = 2
    timeout = 3
    target = &quot;HTTP:80/&quot;
    interval = 30
    }
}

resource &quot;aws_elb_attachment&quot; &quot;web-server-key&quot; {
    count = &quot;${var.public_key == &quot;&quot; ? 0 : length(split(&quot;,&quot;, var.availability_zones))}&quot;

    elb = &quot;${aws_elb.elb.id}&quot;
    instance = &quot;${element(aws_instance.web-server-key.*.id, count.index)}&quot;
}

resource &quot;aws_elb_attachment&quot; &quot;web-server-nokey&quot; {
    count = &quot;${var.public_key == &quot;&quot; ? length(split(&quot;,&quot;, var.availability_zones)) : 0}&quot;

    elb = &quot;${aws_elb.elb.id}&quot;
    instance = &quot;${element(aws_instance.web-server-nokey.*.id, count.index)}&quot;
}
</code></pre>

<p>Finally, we&rsquo;ll export the public instance IPs for SSH access (if
enabled) and the ELB URL:</p>

<pre><code>output &quot;public_ips&quot; {
    ¬†value = &quot;${aws_instance.web-server-key.*.public_ip}&quot;
}

output &quot;url&quot; {
    ¬†value = &quot;http://${aws_elb.elb.dns_name}&quot;
}
</code></pre>

<p>And that&rsquo;s it. This program provisions an EC2 VM per AZ in your region
of choice, behind a load balancer, with conditional SSH enablement.The
full code is¬†<a href="https://gist.github.com/pgavlin/c09972d6e04e452250c86d10bd7ccd31#file-main-tf">available here</a>¬†if
you&rsquo;d like to see it in one place.</p>

<h2 id="migrating-to-a-general-purpose-language">Migrating to a General Purpose Language</h2>

<p>Now let&rsquo;s see how to migrate this program to using a general purpose
language. There are several opportunities to simplify the program &ndash;
most immediately apparent, using familiar if statements instead of the
the awkward conditionals that use count variables.</p>

<p>We could just go ahead and convert the program by hand, however
<a href="https://github.com/pulumi/tf2pulumi">the¬†<code>tf2pulumi</code>¬†tool</a> was designed
to take a Terraform HCL program as input and perform the entire
translation automatically for you. This is a great place to get started
&ndash; and from there we can then refactor the resulting program gradually
to leverage languages better.¬†</p>

<p>The first step is to create a Pulumi project.
<a href="/docs/reference/install/">Download Pulumi here</a>, and then run:</p>

<pre><code>$ pulumi new aws-typescript 
    -n webservers -d &quot;Pulumi Web Servers&quot; -g --dir pulumi
</code></pre>

<p>Run this from wherever your Terraform program resides. This will
initialize and scaffold a minimal Pulumi TypeScript program targeting
AWS in the pulumi subdirectory.</p>

<p>We&rsquo;ll then <a href="https://github.com/pulumi/tf2pulumi#building-and-installation">install¬†<code>tf2pulumi</code></a>,
and run it, to generate the Pulumi TypeScript program:</p>

<pre><code>$ tf2pulumi &gt;pulumi/index.ts
</code></pre>

<p>The full program created by this command can be
<a href="https://gist.github.com/pgavlin/c09972d6e04e452250c86d10bd7ccd31#file-index-generated-ts">found here</a>.
Notice that it looks structurally very similar to the Terraform HCL
program above, except that it&rsquo;s written in TypeScript instead. Even this
rote translation has benefits &ndash; for example, open it in your favorite
editor, and you&rsquo;ll notice you get syntax highlighting, statement
completion, and integrated documentation. But we&rsquo;ll soon see that once
we have this code in our favorite language, we can refactor it to
leverage real programming languages more idiomatically, reducing a lot
of boilerplate.</p>

<p>After the conversion is complete, we can create, configure, and update a
Pulumi stack to create the resources described by the generated Pulumi
program:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">cd</span> pulumi
$ npm install
$ pulumi stack init webservers-prod
$ pulumi config <span class="nb">set</span> aws:region us-west-2
$ pulumi config <span class="nb">set</span> availabilityZones <span class="s2">&#34;us-west-2a,us-west-2b,us-west-2c&#34;</span>
$ pulumi up</code></pre></div>
<p>A Pulumi stack is an environment that can be configured and deployed to
independently of all other stacks. Here we&rsquo;ve
created¬†<code>webservers-prod</code>¬†and set it to deploy into
the¬†<code>us-west-2a</code>,¬†<code>us-west-2b</code>, and¬†<code>us-west-2c</code>¬†availability zones in
AWS&rsquo;s¬†<code>us-west-2</code>¬†region. <code>pulumi up¬†</code>will then show you a plan and then
let you confirm it to deploy your resources:</p>

<p><img src="./tf-pulumi-preview.png" alt="tf-pulumi-preview" /></p>

<p>After selecting &ldquo;yes&rdquo;, the update will proceed with interactive status
updates:</p>

<p><img src="./tf-pulumi-update.png" alt="tf-pulumi-update" /></p>

<h2 id="leveraging-programming-languages">Leveraging Programming Languages</h2>

<p>This is great &ndash; we now have a working Pulumi program. Let&rsquo;s now go
about simplifying the generated code so that it is easier to read,
understand, and maintain. We&rsquo;ll only scratch the surface in this post,
as many of the real benefits shine when you go beyond a single program
and use reusable constructs like functions, classes, and packages, to
cut down on copy and paste. But even some of the syntactic
transformations we&rsquo;ll make can provide a real boost to productivity.</p>

<p>First, notice that our package dependencies are just NPM packages. The
full ecosystem of our language&rsquo;s native package manager is available to
us:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">pulumi</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/pulumi&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">aws</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/aws&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">fs</span> <span class="nx">from</span> <span class="s2">&#34;fs&#34;</span><span class="p">;</span></code></pre></div>
<p>The first order of business is to place the list of configured
availability zones into a local variable:</p>

<pre><code>const availabilityZones = config.require(&quot;availabilityZones&quot;).split(&quot;,&quot;);
</code></pre>

<p>Because Pulumi programs are ordinary programs, we can use variables in
the usual ways. Notice that we&rsquo;ve not only defined a variable, but also
split the string, so that we don&rsquo;t need to do it on every usage within
the file, using the standard JavaScript¬†<code>split</code> function.</p>

<p>Terraform data sources are represented as function calls in our program.
So, to fetch the Ubuntu AMI, we simply call the¬†<code>getAmi</code>¬†function,
passing in the filters as parameters to it:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">const</span> <span class="nx">ubuntuAmi</span> <span class="o">=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">getAmi</span><span class="p">({</span>
    <span class="nx">filters</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="nx">values</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;ubuntu/images/hvm-ssd/ubuntu-trusty-14.04-amd64-server-*&#34;</span><span class="p">]</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;virtualization-type&#34;</span><span class="p">,</span> <span class="nx">values</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;hvm&#34;</span><span class="p">]</span> <span class="p">},</span>
    <span class="p">],</span>
    <span class="nx">mostRecent</span>: <span class="kt">true</span><span class="p">,</span>
    <span class="nx">owners</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;099720109477&#34;</span><span class="p">],</span> <span class="c1">// Canonical
</span><span class="c1"></span><span class="p">});</span></code></pre></div>
<p>We already saw how the use of variables can save us from repeating
ourselves over and over again, and again, we can use this to avoid
repeating the 0.0.0.0/0 CIDR block everywhere:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">const</span> <span class="nx">anyCidr</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;0.0.0.0/0&#34;</span><span class="p">];</span>
<span class="kr">const</span> <span class="nx">webServerSg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">ec2</span><span class="p">.</span><span class="nx">SecurityGroup</span><span class="p">(</span><span class="s2">&#34;default&#34;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">egress</span><span class="o">:</span> <span class="p">[{</span> <span class="nx">cidrBlocks</span>: <span class="kt">anyCidr</span><span class="p">,</span> <span class="nx">fromPort</span>: <span class="kt">0</span><span class="p">,</span> <span class="nx">protocol</span><span class="o">:</span> <span class="s2">&#34;-1&#34;</span><span class="p">,</span> <span class="nx">toPort</span>: <span class="kt">0</span> <span class="p">}],</span>
    <span class="nx">ingress</span><span class="o">:</span> <span class="p">[{</span> <span class="nx">cidrBlocks</span>: <span class="kt">anyCidr</span><span class="p">,</span> <span class="nx">fromPort</span>: <span class="kt">80</span><span class="p">,</span> <span class="nx">protocol</span><span class="o">:</span> <span class="s2">&#34;tcp&#34;</span><span class="p">,</span> <span class="nx">toPort</span>: <span class="kt">80</span> <span class="p">}],</span>
<span class="p">});</span></code></pre></div>
<p>Now we can change how we conditionally create the web server instances.
This is where we&rsquo;ll start to see the big wins, because we can use any of
the familiar programming language control constructs,
including¬†<code>for</code>¬†loops,¬†<code>case</code> statements,¬†<code>if</code> blocks, function calls,
and even higher order list functions like¬†<code>map</code> and¬†<code>filter</code>.</p>

<p>In order to conditionally create a resource in Terraform, we had to set
its¬†<code>count</code> to either¬†<code>0</code> or the desired AZ count. However, this affects
any resources that depend on the conditional resource: the dependent
resources either become conditional themselves or require complex
interpolation expressions in order to ensure that the configuration does
not reference any undefined properties. In our original Terraform
configuration, the conditional creation of an AWS Key Pair forces us to
declare our web servers twice: once with the key pair and once without.</p>

<pre><code>resource &quot;aws_key_pair&quot; &quot;default&quot; {
    count = &quot;${var.public_key == &quot;&quot; ? 0 : 1}&quot;
‚Ä¶

resource &quot;aws_instance&quot; &quot;web-server-key&quot; {
    count = &quot;${var.public_key == &quot;&quot; ? 0 : length(split(&quot;,&quot;, var.availability_zones))}&quot;
‚Ä¶

resource &quot;aws_elb_attachment&quot; &quot;web-server-key&quot; {
    count = &quot;${var.public_key == &quot;&quot; ? 0 : length(split(&quot;,&quot;, var.availability_zones))}&quot;
‚Ä¶

resource &quot;aws_instance&quot; &quot;web-server-nokey&quot; {
    count = &quot;${var.public_key == &quot;&quot; ? length(split(&quot;,&quot;, var.availability_zones)) : 0}&quot;
‚Ä¶

resource &quot;aws_elb_attachment&quot; &quot;web-server-nokey&quot; {
    count = &quot;${var.public_key == &quot;&quot; ? length(split(&quot;,&quot;, var.availability_zones)) : 0}&quot;
‚Ä¶
</code></pre>

<p>This is rather cumbersome. The syntactic transformation performed
by¬†<code>tf2pulumi</code>¬†preserved this same structure to ensure the semantics of
translation are identical, but we can now go back and clean it up
considerably.</p>

<p>First, to conditionally allocate an EC2 KeyPair and to open port 22, we
use an¬†<code>if</code> statement:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kd">let</span> <span class="nx">keyName</span>: <span class="kt">pulumi.Output</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">publicKey</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">keyName</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">ec2</span><span class="p">.</span><span class="nx">KeyPair</span><span class="p">(</span><span class="s2">&#34;default&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">publicKey</span> <span class="p">}).</span><span class="nx">id</span><span class="p">;</span>
        <span class="k">new</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">ec2</span><span class="p">.</span><span class="nx">SecurityGroupRule</span><span class="p">(</span><span class="s2">&#34;allow_ssh&#34;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;ingress&#34;</span><span class="p">,</span>
        <span class="nx">cidrBlocks</span>: <span class="kt">anyCidr</span><span class="p">,</span>
        <span class="nx">fromPort</span>: <span class="kt">22</span><span class="p">,</span>
        <span class="nx">toPort</span>: <span class="kt">22</span><span class="p">,</span>
        <span class="nx">protocol</span><span class="o">:</span> <span class="s2">&#34;tcp&#34;</span><span class="p">,</span>
        <span class="nx">securityGroupId</span>: <span class="kt">webServerSg.id</span><span class="p">,</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre></div>
<p>The use of conditionals just works and interacts with planning just as
you might expect, so that we always see the result of the conditional
evaluation before we&rsquo;ve decided to deploy anything.</p>

<p>Another subtle advantage is that we can just pass
the¬†<code>webServerSg.id¬†</code>property &ndash; Pulumi understands the resource DAG,
and the use of this property automatically forms an edge.</p>

<p>Now let&rsquo;s create our web servers. We might use a for loop for this, and
append each one to an array, however it&rsquo;s just as easy to use the
JavaScript¬†<code>map</code>¬†function to do this more declaratively:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">const</span> <span class="nx">webServers</span>: <span class="kt">aws.ec2.Instance</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">availabilityZones</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">az</span> <span class="o">=&gt;</span>
    <span class="k">new</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">ec2</span><span class="p">.</span><span class="nx">Instance</span><span class="p">(</span><span class="sb">`web-server-key-</span><span class="si">${</span><span class="nx">az</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">ami</span>: <span class="kt">ubuntuAmi.then</span><span class="p">(</span><span class="nx">ami</span> <span class="o">=&gt;</span> <span class="nx">ami</span><span class="p">.</span><span class="nx">id</span><span class="p">),</span>
        <span class="nx">associatePublicIpAddress</span>: <span class="kt">publicKey</span> <span class="o">!==</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nx">availabilityZone</span>: <span class="kt">az</span><span class="p">,</span>
        <span class="nx">instanceType</span><span class="o">:</span> <span class="s2">&#34;t2.micro&#34;</span><span class="p">,</span>
        <span class="nx">securityGroups</span><span class="o">:</span> <span class="p">[</span> <span class="nx">webServerSg</span><span class="p">.</span><span class="nx">name</span> <span class="p">],</span>
        <span class="nx">userData</span>: <span class="kt">fs.readFileSync</span><span class="p">(</span><span class="s2">&#34;userdata.sh&#34;</span><span class="p">,</span> <span class="s2">&#34;utf-8&#34;</span><span class="p">),</span>
        <span class="nx">keyName</span>: <span class="kt">keyName</span><span class="p">,</span>
    <span class="p">}),</span>
<span class="p">);</span></code></pre></div>
<p>Interestingly, we&rsquo;ve passed¬†<code>keyName</code> to the constructor here, even
though it might not have been defined (the JavaScript default value
of¬†<code>undefined</code>). Pulumi understands that this means &ldquo;the absence of a
value&rdquo;, which is how we were able to simplify the web server
provisioning so greatly. We also read in the¬†<code>userdata.sh</code> file using
standard JavaScript I/O functionality.</p>

<p>Now that we&rsquo;ve simplified our configuration such that the web servers
are declared once, we can simplify their interaction with the load
balancer. We can just create the ELB last and pass it a list of all of
our instances. We can also improve the reliability of configuration by
ensuring that the ELB is associated with each availability zone in which
we&rsquo;ve created a web server:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">const</span> <span class="nx">webServerElb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">elasticloadbalancing</span><span class="p">.</span><span class="nx">LoadBalancer</span><span class="p">(</span><span class="s2">&#34;elb&#34;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">availabilityZones</span>: <span class="kt">webServers.map</span><span class="p">(</span><span class="nx">instance</span> <span class="o">=&gt;</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">availabilityZone</span><span class="p">),</span>
    <span class="nx">instances</span>: <span class="kt">webServers.map</span><span class="p">(</span><span class="nx">instance</span> <span class="o">=&gt;</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">id</span><span class="p">),</span>
    <span class="nx">healthCheck</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">healthyThreshold</span>: <span class="kt">2</span><span class="p">,</span>
        <span class="nx">interval</span>: <span class="kt">30</span><span class="p">,</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s2">&#34;HTTP:80/&#34;</span><span class="p">,</span>
        <span class="nx">timeout</span>: <span class="kt">3</span><span class="p">,</span>
        <span class="nx">unhealthyThreshold</span>: <span class="kt">2</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">listeners</span><span class="o">:</span> <span class="p">[{</span>
        <span class="nx">instancePort</span>: <span class="kt">80</span><span class="p">,</span>
        <span class="nx">instanceProtocol</span><span class="o">:</span> <span class="s2">&#34;http&#34;</span><span class="p">,</span>
        <span class="nx">lbPort</span>: <span class="kt">80</span><span class="p">,</span>
        <span class="nx">lbProtocol</span><span class="o">:</span> <span class="s2">&#34;http&#34;</span><span class="p">,</span>
    <span class="p">}],</span>
<span class="p">});</span></code></pre></div>
<p>Finally, the way we express outputs is by using standard JavaScript
module exports:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">publicIps</span> <span class="o">=</span> <span class="nx">webServers</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">publicIp</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">webServerElb</span><span class="p">.</span><span class="nx">dnsName</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">hostname</span> <span class="o">=&gt;</span> <span class="sb">`http://</span><span class="si">${</span><span class="nx">hostname</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span></code></pre></div>
<p>And that&rsquo;s it. After doing this refactoring, you can simply
run¬†<code>pulumi up</code>, and it will show you any diffs compared to your
previous deployment, which you can choose to accept and deploy. The full
code is <a href="https://gist.github.com/pgavlin/c09972d6e04e452250c86d10bd7ccd31#file-index-ts">available here</a>.</p>

<h2 id="next-steps">Next Steps</h2>

<p>In this post, we&rsquo;ve applied general purpose programming languages to
infrastructure as code to achieve more expressive and reusable programs,
simplify our infrastructure&rsquo;s readability and maintainability, and
deliver a heightened level of productivity. Pulumi is
<a href="https://github.com/pulumi/pulumi">open source</a> and free to use &ndash;
give it a try today!</p>
                    </section>
                    <div>
                        <p class="text-gray-500">Posted on <time>Friday, Nov 2, 2018</time>
                        
                        <ul class="m-0 p-0">
                            
                            <li class="inline-flex">
                                
                                <a class="px-2 text-s rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/javascript/">
                                    JavaScript
                                </a>
                            </li>
                            
                            <li class="inline-flex">
                                
                                <a class="px-2 text-s rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/infrastructure/">
                                    Infrastructure
                                </a>
                            </li>
                            
                            <li class="inline-flex">
                                
                                <a class="px-2 text-s rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/typescript/">
                                    TypeScript
                                </a>
                            </li>
                            
                        </ul>
                        
                    </div>
                </article>
            </div>

            <div class="md:w-2/12 pl-8">
                
            </div>
        </div>
    </div>

        </main>

        <nav class="footer bg-purple-700 py-8 px-8 md:px-0">
    <div class="container mx-auto">
        <footer>
            <div class="md:flex items-top justify-between flex-wrap">

                <div class="mb-6 md:w-4/12">
                    <a class="block mt-2" href="/">
                        <img class="h-10 opacity-50" src="/images/logo/logo-white.svg" alt="Pulumi logo">
                    </a>
                    <a class="inline-block my-4 opacity-50 text-white text-lg" href="mailto:team@pulumi.com">team@pulumi.com</a>
                    <ul class="flex inline-items text-blue-300 text-2xl">
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://twitter.com/pulumicorp" target="_blank"><i class="fab fa-twitter"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://www.linkedin.com/company/pulumi/" target="_blank"><i class="fab fa-linkedin"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://github.com/pulumi/" target="_blank"><i class="fab fa-github"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://www.youtube.com/channel/UC2Dhyn4Ev52YSbcpfnfP0Mw" target="_blank"><i class="fab fa-youtube"></i></a></li>
                        <li><a class="hover:text-blue-200" href="https://slack.pulumi.io/" target="_blank"><i class="fab fa-slack-hash"></i></a></li>
                    </ul>
                </div>

                <div class="flex flex-wrap items-top md:w-8/12">
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/containers/">Containers</a></li>
                        <li class="mb-4"><a href="/serverless/">Serverless</a></li>
                        <li class="mb-4"><a href="/docs/reference/tutorials/aws/tutorial-ec2-webserver/">Infrastructure</a></li>
                        <li class="mb-4"><a href="/kubernetes/">Kubernetes</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/docs/reference/install/">Install</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/">Get Started</a></li>
                        <li class="mb-4"><a href="/docs/reference/">Documentation</a></li>
                        <li class="mb-4"><a href="/docs/reference/pkg/">APIs</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/docs/quickstart/aws/">AWS</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/azure/">Azure</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/gcp/">Google Cloud</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/kubernetes/">Kubernetes</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/cloudfx/">Cloud Framework</a></li>
                        <li class="mb-4"><a href="/docs/reference/clouds/openstack/">OpenStack</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/about/">About Us</a></li>
                        <li class="mb-4"><a href="/contact/">Contact Us</a></li>
                        <li class="mb-4"><a href="/support/">Support</a></li>
                        <li class="mb-4"><a href="/careers/">Careers</a></li>
                    </ul>
                </div>
            </div>

            <div class="text-white opacity-75 text-sm lg:flex items-center border-t border-purple-500 mt-4 pt-4">
                
                <p class="md:w-4/12">&copy; 2019 Pulumi. All rights reserved.</p>

                <ul class="md:w-8/12">
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/trademark/">Trademark Usage</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/acceptable-use/">Acceptable Use Policy</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/terms-and-conditions/">Terms &amp; Conditions</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/privacy/">Privacy Policy</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/professional-services-agreement/">Professional Services Agreement</a></li>
                    
                </ul>
            </div>
        </footer>
    </div>
</nav>

        <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>











    




<script src="/js/bundle.min.8d935315b94bf6e77843b9c51ebc10238af740294e751f49b183b5d1e27a1c27.js" integrity="sha256-jZNTFblL9ud4Q7nFHrwQI4r3QClOdR9JsYO10eJ6HCc="></script>

    </body>
</html>
