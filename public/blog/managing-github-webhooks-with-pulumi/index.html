<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
    <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="google-site-verification" content="j-Opn93zR4YQcV5bbYN99BmNc48BT5mzd2VpzKaW9YY" />

    

    
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://www.pulumi.com/blog/managing-github-webhooks-with-pulumi/">
    <meta property="og:site_name" content="pulumi">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@PulumiCorp">

    
        
            
            
                
                    <meta name="twitter:creator" content="@ellism">
                
            
        
    

    
        <meta property="og:title" content="Managing GitHub Webhooks with Pulumi">
    

    
        <meta name="description" content="At Pulumi, we do all of our development on GitHub, with a workflow built
around topic branches. When a developer wants to make a change, they
push a branch to GitHub, open a pull request and (in theory) once it&rsquo;s
merged, delete the branch. In practice, we&rsquo;ll often forget to delete the
topic branch (I&rsquo;m probably the worst offender), which means we end up
having topic branches linger on our main repository until they are
explicitly cleaned up. While it&rsquo;s a lot of fun to go a click through the
GitHub UI from time to time, deleting merged branches, it&rsquo;s even more
fun to build automation to do this for us. Since GitHub has a rich set
of webhooks and Pulumi makes
it easy to write serverless functions, it felt like it would be natural
to use Pulumi to write a hook that would clean up branches after a pull
request got merged. In addition, Pulumi lets us leverage real
programming languages to build abstractions, which means we can build a
simple framework that hides much of the ceremony behind defining a hook
and lets us focus on the core logic of our hook, without worrying about
how it is deployed and managed.">
        <meta property="og:description" content="At Pulumi, we do all of our development on GitHub, with a workflow built
around topic branches. When a developer wants to make a change, they
push a branch to GitHub, open a pull request and (in theory) once it&rsquo;s
merged, delete the branch. In practice, we&rsquo;ll often forget to delete the
topic branch (I&rsquo;m probably the worst offender), which means we end up
having topic branches linger on our main repository until they are
explicitly cleaned up. While it&rsquo;s a lot of fun to go a click through the
GitHub UI from time to time, deleting merged branches, it&rsquo;s even more
fun to build automation to do this for us. Since GitHub has a rich set
of webhooks and Pulumi makes
it easy to write serverless functions, it felt like it would be natural
to use Pulumi to write a hook that would clean up branches after a pull
request got merged. In addition, Pulumi lets us leverage real
programming languages to build abstractions, which means we can build a
simple framework that hides much of the ceremony behind defining a hook
and lets us focus on the core logic of our hook, without worrying about
how it is deployed and managed.">
    

    
    
    <meta property="og:image" content="https://www.pulumi.com/social/pulumi.png">

    <title>Managing GitHub Webhooks with Pulumi - Pulumi</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />

    
    <link rel="canonical" href="https://www.pulumi.com/blog/managing-github-webhooks-with-pulumi/" >

    
    <link rel="alternate" type="application/rss+xml" href="https://www.pulumi.com/blog/rss.xml" title="Pulumi Blog" />

    
    
    
        
        
        
        <link rel="stylesheet" href="https://www.pulumi.com/css/styles.3496f5522ba2ee3f8bbb9a51ff2cb20fb6827ca85a8ae61de0a9f960bacf1023.css" integrity="sha256-NJb1Uiui7j&#43;Lu5pR/yyyD7aCfKhaiuYd4Kn5YLrPECM=">
    

    <script async defer src="https://buttons.github.io/buttons.js"></script>
    
    <script>
    !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement("script");n.type="text/javascript";n.async=!0;n.src="https://cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(n,a);analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.1.0";
    analytics.load("UK90Ofwacetj5VCPJ7cUgkbNcKLSHO3u");
    analytics.page();
    }}();
    </script>

    
    
        <script src="//cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function(event) {
                anchors.add("h1:not(.no-anchor), h2:not(.no-anchor), h3:not(.no-anchor), h4:not(.no-anchor), h5:not(.no-anchor), h6:not(.no-anchor)");
            });
        </script>
    

    
    
        
            
                
            
        
        
    
</head>

    <body class="section-blog">
        <nav class="bg-black text-white text-sm py-2 px-4 lg:px-0 transition-all max-h-screen md:max-h-full">
    <div class="container mx-auto">
        <ul class="flex justify-end items-center h-6">
            <li class="mr-8"><a href="https://slack.pulumi.io/" target="_blank">Slack</a></li>
            <li class="mr-8"><a href="https://github.com/pulumi" target="_blank">GitHub</a></li>
            <li class="mr-8"><a href="https://app.pulumi.com/" target="_blank">Console</a></li>
            <li class="github-widget">
                <a class="github-button" href="https://github.com/pulumi/pulumi" data-size="small" data-show-count="true" aria-label="Star pulumi/pulumi on GitHub">Star</a>
            </li>
        </ul>
    </div>
</nav>



<nav class="nav-main bg-purple-700 py-6 px-4 lg:px-0 border-t border-purple-500">
    <div class="container mx-auto">
        <header class="flex items-center justify-between flex-wrap md:flex-no-wrap">
            <div class="flex items-center flex-shrink-0 text-white lg:mr-6">
                <a class="block" href="/">
                    <img class="h-10 block" src="/images/logo/logo-inv.svg" alt="Pulumi logo">
                </a>
            </div>

            <div class="nav-header-toggle block md:hidden">
                <button class="flex items-center px-3 py-2 border rounded text-white border-purple-400 bg-purple-600">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <ul class="nav-header-items hidden w-full flex-grow md:flex md:items-center md:w-auto text-white text-sm md:text-xs lg:text-sm uppercase pt-4 md:pt-0">
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/product/" data-submenu="product" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Products
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/why-pulumi/" data-submenu="why" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Why Pulumi
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/pricing/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Pricing
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/docs/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Docs
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/blog/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded bg-purple-400 hover:bg-purple-400">
                            Blog
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/about/" data-submenu="about" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            About
                        </a>
                    </li>
                

                <li class="md:ml-auto md:mr-2 lg:mr-4">
                    <a class="block mt-4 md:mt-0 md:text-xs lg:text-sm btn btn-orange-translucent" href="https://app.pulumi.com/">Sign In</a>
                </li>
                <li>
                    <a class="block mt-4 md:mt-0 md:text-xs lg:text-sm btn" href="https://app.pulumi.com/signup">Sign Up</a>
                </li>
            </ul>
        </header>
    </div>
</nav>
<div class="submenu">
    <div class="text-white relative overflow-visible">
        <div class="submenu-item submenu-item-product hidden absolute inset-x-0 z-50 bg-purple-700 shadow-lg pt-8 pb-16">
            <div class="container mx-auto flex items-start">
                <div class="w-1/2 pr-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">The Pulumi Platform</h3>
                    <p class="text-white">
                        Cloud Apps and Infrastructure for any cloud using languages you already know and love.
                    </p>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-sdk">Pulumi SDK</a>
                            <span>&rarr; Cloud native infrastructure as code.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-crosswalk">Pulumi Crosswalk</a>
                            <span>&rarr; Productive infrastructure as code with built-in best practices.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-saas">Pulumi SaaS</a>
                            <span>&rarr; Continuously deliver and manage cloud software for any cloud.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#multi-cloud-subscription">Multi-Cloud Subscription</a>
                            <span>&rarr; End-to-end Kubernetes solutions to achieve multi-cloud.</span>
                        </li>
                    </ul>
                    <p>
                        <span class="text-white">Pulumi is open source, free to start, and has plans available for teams.</span>
                        <a class="text-orange-500 hover:text-orange-400 hover:mr-1 transition-all" href="/pricing/">View Pricing</a> &rarr;
                    </p>
                </div>
                <div class="w-1/2 pl-12 text-purple-100 text-sm">
                    <h3 class="text-white">Get Started</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/reference/install/">Install (Mac, Windows, Linux)</a> &rarr;
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/">Documentation and Examples</a> &rarr;
                        </li>
                    </ul>
                    <h3 class="text-white">Migrate to Pulumi</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/cloudformation/">from CloudFormation</a> &rarr;
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/terraform/">from Terraform</a> &rarr;
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="submenu-item submenu-item-why hidden absolute inset-x-0 z-50 bg-purple-700 shadow pt-8 pb-16">
           <div class="container mx-auto flex items-start">
                <div class="w-1/2 pr-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">Solutions for All Teams and Engineers</h3>
                    <p class="text-white">
                        Maximize cloud velocity for Dev, DevOps, and IT, no matter your team size.
                    </p>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-developers">For Developers</a>
                            <span>&rarr; Your favorite languages, tools, and libraries.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-operators">For DevOps and IT</a>
                            <span>&rarr; Empower your team to deliver to many clouds.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-business-leaders">For Business Leaders</a>
                            <span>&rarr; Modern multi-cloud for startups and enterprises.</span>
                        </li>
                    </ul>
                </div>
                <div class="w-1/4 px-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">Any Code</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/serverless/">Serverless</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/containers/">Containers</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/kubernetes/">Kubernetes</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/reference/tutorials/aws/tutorial-ec2-webserver/">Infrastructure</a>
                            <span>&rarr;</span>
                        </li>
                    </ul>
                </div>
                <div class="w-1/4 pl-12 text-purple-100 text-sm">
                    <h3 class="text-white">Migrate to Pulumi</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/aws/">AWS</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/azure/">Azure</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/gcp/">GCP</a>
                            <span>&rarr;</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


        
        

        <main>
            
    <div class="container mx-auto px-8 py-8 md:px-0">
        <div class="md:flex">
            <div class="md:w-3/12 pr-8">
                
<aside class="md:pr-8">

    
    <div class="md:hidden">
        <button class="blog-sidebar-toggle items-center px-3 py-2 border rounded text-purple border-purple">
            <i class="fas fa-bars"></i>
        </button>
        <a href="/blog/">üçπ Pulumi Blog</a>
    </div>

    <h3 class="no-anchor hidden md:flex mt-4">
        <a href="/blog/">üçπ Pulumi Blog</a>
    </h3>

    
    <div class="blog-sidebar-content hidden md:block">
        <div class="bg-gray-100 rounded-lg p-4 my-6 text-gray-700">
            <h5 class="no-anchor text-gray-700">Program the Cloud</h5>
            <p class="text-sm my-0">
                Create, deploy, and manage cloud infrastructure using your favorite language.
            </p>
        </div>

        <ul class="list-none p-0 mb-4 inline-flex flex-wrap text-xs">
            
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/apigateway/">
                            apigateway
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/applications/">
                            applications
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/auth/">
                            auth
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/aws/">
                            aws
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/azure/">
                            azure
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/ci/cd/">
                            ci/cd
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/cloud-native/">
                            cloud-native
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/containers/">
                            containers
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/customer/">
                            customer
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/digitalocean/">
                            digitalocean
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/docker/">
                            docker
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/eks/">
                            eks
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/events/">
                            events
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/features/">
                            features
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/gcp/">
                            gcp
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/gke/">
                            gke
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/infrastructure/">
                            infrastructure
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/javascript/">
                            javascript
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/jupyter/">
                            jupyter
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/kubernetes/">
                            kubernetes
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/lambda/">
                            lambda
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/logging/">
                            logging
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/mysql/">
                            mysql
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/new-features/">
                            new-features
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/pulumi/">
                            pulumi
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/pulumi-news/">
                            pulumi-news
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/python/">
                            python
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/security/">
                            security
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/serverless/">
                            serverless
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/testing/">
                            testing
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="https://www.pulumi.com/blog/tag/typescript/">
                            typescript
                        </a>
                    </li>
                
            
        </ul>

        <div class="hidden lg:block my-4">
            <h5 class="no-anchor">Recent Posts</h5>
            <ul class="list-none p-0">
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="https://www.pulumi.com/blog/day-2-kubernetes-migrating-eks-nodegroups-with-zero-downtime/">Day 2 Kubernetes: Migrating EKS Node Groups with Zero Downtime</a>
                        </li>
                    
                
                    
                        
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="https://www.pulumi.com/blog/getting-started-on-digitalocean-with-pulumi/">Getting Started on DigitalOcean with Pulumi</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="https://www.pulumi.com/blog/pulumi-meetup-recap-apis-custom-resources-and-github-webhooks/">Pulumi Meetup Recap: APIs, Custom Resources and GitHub Webhooks</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="https://www.pulumi.com/blog/persisting-kubernetes-workloads-with-amazon-efscsi-volumes-using-pulumi-sdks/">Persisting Kubernetes workloads with Amazon EFS CSI volumes using Pulumi open source SDKs</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="https://www.pulumi.com/blog/unit-testing-infrastructure-in-nodejs-and-mocha/">Unit Testing Your Infrastructure with Node.js and Mocha</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="https://www.pulumi.com/blog/kubernetes-ingress-with-aws-alb-ingress-controller-and-pulumi-crosswalk/">Kubernetes Ingress with AWS ALB Ingress Controller and Pulumi Crosswalk for AWS</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="https://www.pulumi.com/blog/globally-distributed-serverless-application-in-100-lines-of-code-infrastructure-included/">Globally-distributed Serverless Application in 100 Lines of Code. Infrastructure Included!</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="https://www.pulumi.com/blog/hosting-a-static-website-on-azure-with-pulumi/">Hosting a Static Website on Azure with Pulumi</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="https://www.pulumi.com/blog/running-containers-in-aws-the-lowdown-ecs-fargate-and-eks/">Running Containers in AWS, the Lowdown: ECS, Fargate, and EKS</a>
                        </li>
                    
                
            </ul>
        </div>
    </div>

    <div class="md:hidden pb-4">
        
    </div>
</aside>

            </div>

            <div class="md:w-7/12">
                <article class="mb-8 pb-8 border-b border-gray-200">
                    <h1 class="no-anchor"><a href="https://www.pulumi.com/blog/managing-github-webhooks-with-pulumi/">Managing GitHub Webhooks with Pulumi</a></h1>
                    <div class="flex items-center">
                        <span>
                            <span class="flex items-center">
    
        
        

        <span class="flex items-center mr-2">
            
                <a class="rounded-full p-1 bg-gray-300 mr-2" href="https://www.pulumi.com/blog/author/matt-ellis/">
                    <img class="w-8 rounded-full" src="/images/team/matt-ellis.jpg" alt="Matt Ellis" title="Matt Ellis">
                </a>
                <a class="" href="https://www.pulumi.com/blog/author/matt-ellis/">Matt Ellis</a>
            
        </span>
    
</span>

                        </span>
                    </div>
                    <section>
                        <p>At Pulumi, we do all of our development on GitHub, with a workflow built
around topic branches. When a developer wants to make a change, they
push a branch to GitHub, open a pull request and (in theory) once it&rsquo;s
merged, delete the branch. In practice, we&rsquo;ll often forget to delete the
topic branch (I&rsquo;m probably the worst offender), which means we end up
having topic branches linger on our main repository until they are
explicitly cleaned up. While it&rsquo;s a lot of fun to go a click through the
GitHub UI from time to time, deleting merged branches, it&rsquo;s even more
fun to build automation to do this for us. Since GitHub has a rich set
of <a href="https://developer.github.com/webhooks/">webhooks</a> and Pulumi makes
it easy to write serverless functions, it felt like it would be natural
to use Pulumi to write a hook that would clean up branches after a pull
request got merged. In addition, Pulumi lets us leverage real
programming languages to build abstractions, which means we can build a
simple framework that hides much of the ceremony behind defining a hook
and lets us focus on the core logic of our hook, without worrying about
how it is deployed and managed.</p>

<h2 id="a-simple-hook">A simple hook</h2>

<p>When you register a webhook with GitHub, you provide an HTTP endpoint
and a set of events you&rsquo;d like to listen for. When one of the events
happens on GitHub, it makes a POST request to your HTTP endpoint with a
payload that describes the event. We&rsquo;ll start by creating a simple
endpoint that just logs when an event happens. We&rsquo;ll start by using the
<a href="https://www.npmjs.com/package/@pulumi/aws-serverless"><code>aws-serverless</code></a>
package to define an API that just calls <code>console.log</code> to write the
<code>X-GitHub-Event</code> header that is sent with the request:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">serverless</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/aws-serverless&#34;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">serverless</span><span class="p">.</span><span class="nx">apigateway</span><span class="p">.</span><span class="nx">API</span><span class="p">(</span><span class="s2">&#34;hook&#34;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">routes</span><span class="o">:</span> <span class="p">[{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
        <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;POST&#34;</span><span class="p">,</span>
        <span class="nx">handler</span>: <span class="kt">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Got event </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-GitHub-Event&#39;</span><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="nx">statusCode</span>: <span class="kt">200</span><span class="p">,</span>
                <span class="nx">body</span><span class="o">:</span> <span class="s2">&#34;&#34;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},],</span>
<span class="p">});</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span></code></pre></div>
<p>After running <code>pulumi update</code>, we&rsquo;ll have a HTTP endpoint we can give to
GitHub:</p>

<pre><code>Updating stack 'github-hook-blog-dev'
Performing changes:

     Type                                Name                                   Status      Info
 +   pulumi:pulumi:Stack                 github-hook-blog-github-hook-blog-dev  created
 +   ‚îú‚îÄ aws-serverless:apigateway:API    hook                                   created
 +   ‚îÇ  ‚îú‚îÄ aws:apigateway:RestApi        hook                                   created
 +   ‚îÇ  ‚îú‚îÄ aws:apigateway:Deployment     hook                                   created
 +   ‚îÇ  ‚îú‚îÄ aws:lambda:Permission         hook-980655da                          created
 +   ‚îÇ  ‚îî‚îÄ aws:apigateway:Stage          hook                                   created
 +   ‚îî‚îÄ aws:serverless:Function          hook980655da                           created
 +      ‚îú‚îÄ aws:iam:Role                  hook980655da                           created
 +      ‚îú‚îÄ aws:iam:RolePolicyAttachment  hook980655da-32be53a2                  created
 +      ‚îî‚îÄ aws:lambda:Function           hook980655da                           created

---outputs:---
url: &quot;https://t1vyz1x203.execute-api.us-west-1.amazonaws.com/stage/&quot;
</code></pre>

<p>Now that we have our Webhook deployed, we&rsquo;ll add it to GitHub. In this
case, I have a little throwaway GitHub repository I use for testing this
sort of stuff. In that repository, I go to Settings -&gt; Webhooks -&gt; Add
webhook and fill in my information:</p>

<ul>
<li>Payload URL: The value of the <code>url</code> output of my Pulumi program (in
this case it is
<code>https://t1vyz1x203.execute-api.us-west-1.amazonaws.com/stage/</code>).</li>
<li>Content Type: <code>application-json</code>. I know we&rsquo;ll be inspecting this
content as we develop the hook and since we&rsquo;re writing the
implementation in TypeScript, it will be easier to interact with
JSON encoded data.</li>
<li>Secret: Generate a random string and put it here. I used
<a href="https://www.random.org/">random.org</a> to do so, but any random
string will suffice. We&rsquo;ll use this string to validate that the
request came from GitHub.</li>
<li>Events: I only care about <code>pull_request</code> events, so I picked &ldquo;Let me
select individual events&rdquo; and then checked &ldquo;Pull requests&rdquo; and
unchecked the other event types.</li>
<li>Active: Since we want GitHub to deliver events, we&rsquo;ll keep this
checked.</li>
</ul>

<p>Once that&rsquo;s done, we can test our hook by opening a pull request,
waiting a few moments and then use <code>pulumi logs</code> to ensure our hook was
triggered:</p>

<pre><code>$ pulumi logs
Collecting logs for stack github-hook-blog-dev since 2018-07-09T09:06:51.000-07:00.

 2018-07-09T10:06:00.610-07:00[          hook980655da-d0462d4] START RequestId: 5aab2d71-839a-11e8-a7ae-93a25d68b5a9 Version: $LATEST
 2018-07-09T10:06:00.612-07:00[          hook980655da-d0462d4] 2018-07-09T17:06:00.611Z 5aab2d71-839a-11e8-a7ae-93a25d68b5a9    Got event ping
 2018-07-09T10:06:00.630-07:00[          hook980655da-d0462d4] END RequestId: 5aab2d71-839a-11e8-a7ae-93a25d68b5a9
 2018-07-09T10:06:00.630-07:00[          hook980655da-d0462d4] REPORT RequestId: 5aab2d71-839a-11e8-a7ae-93a25d68b5a9   Duration: 10.99 ms  Billed Duration: 100 ms     Memory Size: 128 MB Max Memory Used: 20 MB

 2018-07-09T10:06:23.241-07:00[          hook980655da-d0462d4] START RequestId: 68445127-839a-11e8-80a6-759a29eb6005 Version: $LATEST
 2018-07-09T10:06:23.243-07:00[          hook980655da-d0462d4] 2018-07-09T17:06:23.243Z 68445127-839a-11e8-80a6-759a29eb6005    Got event pull_request
 2018-07-09T10:06:23.250-07:00[          hook980655da-d0462d4] END RequestId: 68445127-839a-11e8-80a6-759a29eb6005
 2018-07-09T10:06:23.250-07:00[          hook980655da-d0462d4] REPORT RequestId: 68445127-839a-11e8-80a6-759a29eb6005   Duration: 1.32 ms   Billed Duration: 100 ms     Memory Size: 128 MB Max Memory Used: 20 MB
</code></pre>

<p>Here we can see our hook got two events, the first is the
<a href="https://developer.github.com/webhooks/#ping-event"><code>ping</code></a> event, which
GitHub sends to verify the hook. The second event is from when I opened
a pull request in the repository.</p>

<p>Before we go any further, let&rsquo;s start using the secret we set to
validate the Webhook payload. When GitHub sends an event to a Webhook,
it sets a special header
<a href="https://developer.github.com/webhooks/#delivery-headers"><code>X-Hub-Signature</code></a>
which is an HMAC digest of the request body. The value we placed in the
Secret field when configuring the Webhook is the key. So I&rsquo;ll take that
secret value, set it as a configuration value in my project:</p>

<pre><code>$ pulumi config set --secret hookSecret [READACTED]
</code></pre>

<p>Once that&rsquo;s done, I can use this value to validate the signiture. We&rsquo;ll
use some functions from node&rsquo;s <code>crypto</code> library at runtime to handle
this. If the signature we computed doesn&rsquo;t match what was provided with
the request, we&rsquo;ll return error code 400. Our program now looks like
this:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">pulumi</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/pulumi&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">serverless</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/aws-serverless&#34;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pulumi</span><span class="p">.</span><span class="nx">Config</span><span class="p">(</span><span class="nx">pulumi</span><span class="p">.</span><span class="nx">getProject</span><span class="p">());</span>
<span class="kr">const</span> <span class="nx">hookSecret</span> <span class="o">=</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&#34;hookSecret&#34;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">serverless</span><span class="p">.</span><span class="nx">apigateway</span><span class="p">.</span><span class="nx">API</span><span class="p">(</span><span class="s2">&#34;hook&#34;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">routes</span><span class="o">:</span> <span class="p">[{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
        <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;POST&#34;</span><span class="p">,</span>
        <span class="nx">handler</span>: <span class="kt">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="c1">// Compute the HMAC of the body, using `hookSecret` as the key and `sha1` as the algorithm
</span><span class="c1"></span>
            <span class="c1">// First, grab the body. It may be base64 encoded, depending on if `req.isBase64Encoded` is set. If so, we
</span><span class="c1"></span>            <span class="c1">// should decode it.
</span><span class="c1"></span>            <span class="kd">let</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">isBase64Encoded</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">body</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">body</span><span class="p">,</span> <span class="s1">&#39;base64&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// Now compute the HMAC.
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">await</span> <span class="kr">import</span><span class="p">(</span><span class="s2">&#34;crypto&#34;</span><span class="p">);</span>
            <span class="kr">const</span> <span class="nx">hmac</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="s2">&#34;sha1&#34;</span><span class="p">,</span> <span class="nx">hookSecret</span><span class="p">);</span>
            <span class="nx">hmac</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>

            <span class="kr">const</span> <span class="nx">computedSignature</span> <span class="o">=</span> <span class="sb">`sha1=</span><span class="si">${</span><span class="nx">hmac</span><span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

            <span class="c1">// Compare the signature that came in with the request to what we computed.
</span><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-Hub-Signature&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span>
                <span class="o">!</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">timingSafeEqual</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-Hub-Signature&#39;</span><span class="p">]),</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">computedSignature</span><span class="p">)))</span>
            <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`error: bad signature </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-Hub-Signature&#39;</span><span class="p">]</span><span class="si">}</span><span class="sb"> !== </span><span class="si">${</span><span class="nx">computedSignature</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="nx">statusCode</span>: <span class="kt">400</span><span class="p">,</span>
                    <span class="nx">body</span><span class="o">:</span> <span class="s2">&#34;bad signature&#34;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Got event </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-GitHub-Event&#39;</span><span class="p">]</span><span class="si">}</span><span class="sb"> and signature </span><span class="si">${</span><span class="nx">computedSignature</span><span class="si">}</span><span class="sb"> matched`</span><span class="p">);</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="nx">statusCode</span>: <span class="kt">200</span><span class="p">,</span>
                <span class="nx">body</span><span class="o">:</span> <span class="s2">&#34;&#34;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},],</span>
<span class="p">});</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span></code></pre></div>
<p>After deploying, we can trigger another event by closing an existing
pull request or opening a new one, and then use <code>pulumi logs</code> to confirm
that our validation is working as intended:</p>

<pre><code>$ pulumi logs
Collecting logs for stack github-hook-blog-dev since 2018-07-09T12:43:05.000-07:00.

 2018-07-09T13:43:00.630-07:00[          hook980655da-d0462d4] START RequestId: ab363ec7-83b8-11e8-a7ae-93a25d68b5a9 Version: $LATEST
 2018-07-09T13:43:00.693-07:00[          hook980655da-d0462d4] 2018-07-09T20:43:00.693Z ab363ec7-83b8-11e8-a7ae-93a25d68b5a9    Got event pull_request and signature sha1=b83320205edc7cb9aeea1a845b85de0c83092e1d matched
 2018-07-09T13:43:00.731-07:00[          hook980655da-d0462d4] END RequestId: ab363ec7-83b8-11e8-a7ae-93a25d68b5a9
 2018-07-09T13:43:00.731-07:00[          hook980655da-d0462d4] REPORT RequestId: ab363ec7-83b8-11e8-a7ae-93a25d68b5a9   Duration: 128.75 ms Billed Duration: 200 ms     Memory Size: 128 MB Max Memory Used: 20 MB
</code></pre>

<h2 id="building-an-abstraction">Building an abstraction</h2>

<p>We now have a nice little skeleton that we can use when writing a
webhook on GitHub. Let&rsquo;s start to leverage some other Pulumi features to
make things simpler and provide a nicer interface for writing hooks.
Let&rsquo;s start by abstracting away the code that handles validating the
request and returning a response behind a helper method. We&rsquo;ll pass a
function to this helper which will be called after the validation has
completed. We&rsquo;ll also parse the body into a JSON object that our handler
can use.</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">pulumi</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/pulumi&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">serverless</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/aws-serverless&#34;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pulumi</span><span class="p">.</span><span class="nx">Config</span><span class="p">(</span><span class="nx">pulumi</span><span class="p">.</span><span class="nx">getProject</span><span class="p">());</span>
<span class="kr">const</span> <span class="nx">hookSecret</span> <span class="o">=</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&#34;hookSecret&#34;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">createWebhook</span><span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="p">((</span><span class="nx">req</span>: <span class="kt">serverless.apigateway.Request</span><span class="p">,</span> <span class="nx">body</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">serverless</span><span class="p">.</span><span class="nx">apigateway</span><span class="p">.</span><span class="nx">API</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">routes</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">path</span><span class="o">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;POST&#34;</span><span class="p">,</span>
            <span class="nx">handler</span>: <span class="kt">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="c1">// Compute the HMAC of the body, using `hookSecret` as the key and `sha1` as the algorithm
</span><span class="c1"></span>
                <span class="c1">// First, grab the body. It may be base64 encoded, depending on if `req.isBase64Encoded` is set. If so, we
</span><span class="c1"></span>                <span class="c1">// should decode it.
</span><span class="c1"></span>                <span class="kd">let</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">isBase64Encoded</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">body</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">body</span><span class="p">,</span> <span class="s1">&#39;base64&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="c1">// Now compute the HMAC.
</span><span class="c1"></span>                <span class="kr">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">await</span> <span class="kr">import</span><span class="p">(</span><span class="s2">&#34;crypto&#34;</span><span class="p">);</span>
                <span class="kr">const</span> <span class="nx">hmac</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="s2">&#34;sha1&#34;</span><span class="p">,</span> <span class="nx">hookSecret</span><span class="p">);</span>
                <span class="nx">hmac</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>

                <span class="kr">const</span> <span class="nx">computedSignature</span> <span class="o">=</span> <span class="sb">`sha1=</span><span class="si">${</span><span class="nx">hmac</span><span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

                <span class="c1">// Compare the signature that came in with the request to what we computed.
</span><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-Hub-Signature&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span>
                    <span class="o">!</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">timingSafeEqual</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-Hub-Signature&#39;</span><span class="p">]),</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">computedSignature</span><span class="p">)))</span>
                <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`error: bad signature </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-Hub-Signature&#39;</span><span class="p">]</span><span class="si">}</span><span class="sb"> !== </span><span class="si">${</span><span class="nx">computedSignature</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
                    <span class="k">return</span> <span class="p">{</span>
                        <span class="nx">statusCode</span>: <span class="kt">400</span><span class="p">,</span>
                        <span class="nx">body</span><span class="o">:</span> <span class="s2">&#34;bad signature&#34;</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="c1">// Call the handler after parsing the body as JSON
</span><span class="c1"></span>                <span class="nx">await</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">));</span>

                <span class="k">return</span> <span class="p">{</span>
                    <span class="nx">statusCode</span>: <span class="kt">200</span><span class="p">,</span>
                    <span class="nx">body</span><span class="o">:</span> <span class="s2">&#34;&#34;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},],</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">createWebhook</span><span class="p">(</span><span class="s2">&#34;hook&#34;</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Got event </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-GitHub-Event&#39;</span><span class="p">]</span><span class="si">}</span><span class="sb"> with action </span><span class="si">${</span><span class="nx">body</span><span class="p">.</span><span class="nx">action</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">});</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span></code></pre></div>
<p>The shape of the JSON object for this event is
<a href="https://developer.github.com/v3/activity/events/types/#pullrequestevent">documented</a>
on GitHub. Here we&rsquo;re pulling out the action field, which tells us
something about the state of the pull request. For our bot, we only care
about PRs where the <code>action</code> is <code>closed</code> and the <code>merged</code> key is set to
<code>true</code>. When this holds, we&rsquo;ll want to delete the branch the pull
request came from, if it was a topic branch (instead of a PR opened from
a fork). We&rsquo;ll leverage the existing <a href="https://www.npmjs.com/package/@octokit/rest"><code>@octokit/rest</code> NPM package</a> to do this. We can
generate a <a href="https://github.com/settings/tokens">personal access token</a>,
and give it <code>repo</code> level scope, so it can act as us and delete branches.
We&rsquo;ll then add this key to our configuration:</p>

<pre><code>$ pulumi config set --secret githubToken [REDACTED]
</code></pre>

<p>And we can now update our handler to use this API:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">pulumi</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/pulumi&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">serverless</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/aws-serverless&#34;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pulumi</span><span class="p">.</span><span class="nx">Config</span><span class="p">(</span><span class="nx">pulumi</span><span class="p">.</span><span class="nx">getProject</span><span class="p">());</span>
<span class="kr">const</span> <span class="nx">hookSecret</span> <span class="o">=</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&#34;hookSecret&#34;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">createWebhook</span><span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="p">((</span><span class="nx">req</span>: <span class="kt">serverless.apigateway.Request</span><span class="p">,</span> <span class="nx">body</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">))</span> <span class="p">{</span>
    <span class="cm">/* Same as the previous version */</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">githubToken</span> <span class="o">=</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&#34;githubToken&#34;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">createWebhook</span><span class="p">(</span><span class="s2">&#34;hook&#34;</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s2">&#34;closed&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">merged</span> <span class="o">&amp;&amp;</span>
        <span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">login</span> <span class="o">===</span> <span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">login</span> <span class="o">&amp;&amp;</span>
        <span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">octokit</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@octokit/rest&#39;</span><span class="p">)()</span>
        <span class="nx">octokit</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;token&#39;</span><span class="p">,</span>
            <span class="nx">token</span>: <span class="kt">githubToken</span>
        <span class="p">});</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Deleting reference heads/</span><span class="si">${</span><span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">ref</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

        <span class="nx">await</span> <span class="nx">octokit</span><span class="p">.</span><span class="nx">gitdata</span><span class="p">.</span><span class="nx">deleteReference</span><span class="p">({</span>
            <span class="nx">owner</span>: <span class="kt">body.pull_request.head.user.login</span><span class="p">,</span>
            <span class="nx">repo</span>: <span class="kt">body.pull_request.head.repo.name</span><span class="p">,</span>
            <span class="nx">ref</span><span class="o">:</span> <span class="sb">`heads/</span><span class="si">${</span><span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">ref</span><span class="si">}</span><span class="sb">`</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span></code></pre></div>
<p>After <code>pulumi updating</code>, try merging a pull request! Shortly after you
click the merge button, the source branch should be deleted
automatically. You can also see our log message in the output of
<code>pulumi logs</code>:</p>

<pre><code>$ pulumi logs
[matell@matell throwaway]$ pulumi logs
Collecting logs for stack github-hook-blog-dev since 2018-07-09T13:30:26.000-07:00.

 2018-07-09T14:28:52.254-07:00[          hook980655da-d0462d4] START RequestId: 1368afec-83bf-11e8-bf0d-cf623578c325 Version: $LATEST
 2018-07-09T14:28:52.431-07:00[          hook980655da-d0462d4] 2018-07-09T21:28:52.371Z 1368afec-83bf-11e8-bf0d-cf623578c325    Deleting reference heads/test-branch
 2018-07-09T14:28:53.478-07:00[          hook980655da-d0462d4] END RequestId: 1368afec-83bf-11e8-bf0d-cf623578c325
 2018-07-09T14:28:53.478-07:00[          hook980655da-d0462d4] REPORT RequestId: 1368afec-83bf-11e8-bf0d-cf623578c325   Duration: 1221.97 ms    Billed Duration: 1300 ms    Memory Size: 128 MB Max Memory Used: 33 MB
</code></pre>

<p>So, in about 75 lines of code, we&rsquo;ve defined a small abstraction for
authoring a GitHub Webhook and we&rsquo;ve used it to write a little bot that
deletes topic branches after pull requests from them have been merged.
In itself, that&rsquo;s pretty cool, but we can do some more cool stuff with
Pulumi. As is, while we can create the Webhook using Pulumi, we have to
register it using the GitHub console, which is a little tedious. What if
we could manage the registration of the hook with Pulumi itself? We&rsquo;d
really like to model the hook&rsquo;s association with GitHub as a resource
that can be created, updated and deleted. Is there a way we can do that?
Yes, there is!</p>

<h2 id="managing-all-the-things-with-pulumi">Managing all the things with Pulumi</h2>

<p>Pulumi <a href="https://github.com/pulumi/pulumi/blob/master/sdk/proto/provider.proto">uses gRPC</a>
to define a contract between resource providers and the rest of Pulumi.
So, we could go implement that contract in a language like go, like we
do in our <a href="https://github.com/pulumi/pulumi-kubernetes">Kubernetes</a>
provider. Another option would be to take the existing
<a href="https://github.com/terraform-providers/terraform-provider-github">Terraform GitHub Provider</a>
and use <a href="https://github.com/pulumi/pulumi-terraform/">Pulumi&rsquo;s terraform bridge</a> wrap it into a
Pulumi resource provider, like we do with our
<a href="https://github.com/pulumi/pulumi-aws">pulumi-aws</a> provider. There&rsquo;s one
final option, which is to use the &ldquo;<a href="https://github.com/pulumi/pulumi/blob/ad3b5e7ee88346bc7e960de9f953957a72f84516/sdk/nodejs/dynamic/index.ts#L109">dynamic provider</a>&rdquo;,
which allows us to implement a resource provider in JavaScript itself.
We wrote this provider to help us with testing, so we could mock out
resources and control their lifecycle, but we can also use it to create
a resource that manages registration of a webhook with GitHub. To do so,
we need to implement <code>dynamic.ResourceProvider</code> interface. Once we have
the provider, we can also write a resource that uses it.</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">class</span> <span class="nx">GithubWebhookProvider</span> <span class="kr">implements</span> <span class="nx">dynamic</span><span class="p">.</span><span class="nx">ResourceProvider</span> <span class="p">{</span>

    <span class="c1">// Check ensures that all required properties are set. In this case we have three required parameters.
</span><span class="c1"></span>    <span class="nx">check</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">olds</span>: <span class="kt">any</span><span class="p">,</span> <span class="nx">news</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">failedChecks</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">prop</span> <span class="nx">of</span> <span class="p">[</span><span class="s2">&#34;url&#34;</span><span class="p">,</span> <span class="s2">&#34;owner&#34;</span><span class="p">,</span> <span class="s2">&#34;repo&#34;</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">news</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">failedChecks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">property</span>: <span class="kt">prop</span><span class="p">,</span> <span class="nx">reason</span><span class="o">:</span> <span class="sb">`required property &#39;</span><span class="si">${</span><span class="nx">prop</span><span class="si">}</span><span class="sb">&#39; missing`</span><span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span> <span class="nx">inputs</span>: <span class="kt">news</span><span class="p">,</span> <span class="nx">failedChecks</span>: <span class="kt">failedChecks</span> <span class="p">};</span>
    <span class="p">}</span>

    <span class="c1">// Today the engine does the diff between properties to detect if there is a change but this method does
</span><span class="c1"></span>    <span class="c1">// tell the engine if the changes between the old and new values require the resource to be &#34;replaced&#34;
</span><span class="c1"></span>    <span class="c1">// (that is a new one is created and the old one is deleted) vs being edited in place. For us, if the owner
</span><span class="c1"></span>    <span class="c1">// or repo the hook is installed on changes, we&#39;ll trigger a replacement.
</span><span class="c1"></span>    <span class="nx">diff</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">pulumi.ID</span><span class="p">,</span> <span class="nx">olds</span>: <span class="kt">any</span><span class="p">,</span> <span class="nx">news</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">replaces</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">prop</span> <span class="nx">of</span> <span class="p">[</span><span class="s2">&#34;owner&#34;</span><span class="p">,</span> <span class="s2">&#34;repo&#34;</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">olds</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">news</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">replaces</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">prop</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span> <span class="nx">replaces</span>: <span class="kt">replaces</span> <span class="p">};</span>
    <span class="p">}</span>

    <span class="c1">// Create actually creates the hook. We use octokit under the hood and return the ID of the hook that was created.
</span><span class="c1"></span>    <span class="c1">// Pulumi retains this ID and gives it to us when we need to update or delete the hook.
</span><span class="c1"></span>    <span class="nx">create</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">inputs</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">octokit</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@octokit/rest&#34;</span><span class="p">)();</span>
        <span class="nx">octokit</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;token&#34;</span><span class="p">,</span>
            <span class="nx">token</span>: <span class="kt">githubToken</span><span class="p">,</span>
        <span class="p">});</span>

        <span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">octokit</span><span class="p">.</span><span class="nx">repos</span><span class="p">.</span><span class="nx">createHook</span><span class="p">({</span>
            <span class="nx">owner</span>: <span class="kt">inputs</span><span class="p">[</span><span class="s2">&#34;owner&#34;</span><span class="p">],</span>
            <span class="nx">repo</span>: <span class="kt">inputs</span><span class="p">[</span><span class="s2">&#34;repo&#34;</span><span class="p">],</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;web&#34;</span><span class="p">,</span>
            <span class="nx">events</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;pull_request&#34;</span><span class="p">],</span>
            <span class="nx">config</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">content_type</span><span class="o">:</span> <span class="s2">&#34;json&#34;</span><span class="p">,</span>
                <span class="nx">url</span>: <span class="kt">inputs</span><span class="p">[</span><span class="s2">&#34;url&#34;</span><span class="p">],</span>
                <span class="nx">secret</span>: <span class="kt">hookSecret</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">});</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">201</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`bad response: </span><span class="si">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// The engine expects that the ID property is a string.
</span><span class="c1"></span>        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
        <span class="p">};</span>
    <span class="p">}</span>

    <span class="nx">update</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">pulumi.ID</span><span class="p">,</span> <span class="nx">olds</span>: <span class="kt">any</span><span class="p">,</span> <span class="nx">news</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">octokit</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@octokit/rest&#34;</span><span class="p">)();</span>
        <span class="nx">octokit</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;token&#34;</span><span class="p">,</span>
            <span class="nx">token</span>: <span class="kt">githubToken</span><span class="p">,</span>
        <span class="p">});</span>

        <span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">octokit</span><span class="p">.</span><span class="nx">repos</span><span class="p">.</span><span class="nx">editHook</span><span class="p">({</span>
            <span class="nx">hook_id</span>: <span class="kt">id</span><span class="p">,</span>
            <span class="nx">owner</span>: <span class="kt">news</span><span class="p">[</span><span class="s2">&#34;owner&#34;</span><span class="p">],</span>
            <span class="nx">repo</span>: <span class="kt">news</span><span class="p">[</span><span class="s2">&#34;repo&#34;</span><span class="p">],</span>
            <span class="nx">events</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;pull_request&#34;</span><span class="p">],</span>
            <span class="nx">config</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">content_type</span><span class="o">:</span> <span class="s2">&#34;json&#34;</span><span class="p">,</span>
                <span class="nx">url</span>: <span class="kt">news</span><span class="p">[</span><span class="s2">&#34;url&#34;</span><span class="p">],</span>
            <span class="p">},</span>
        <span class="p">});</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`bad response: </span><span class="si">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{}</span>
    <span class="p">}</span>

    <span class="k">delete</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">pulumi.ID</span><span class="p">,</span> <span class="nx">props</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">octokit</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@octokit/rest&#34;</span><span class="p">)();</span>

        <span class="nx">octokit</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;token&#34;</span><span class="p">,</span>
            <span class="nx">token</span>: <span class="kt">githubToken</span><span class="p">,</span>
        <span class="p">});</span>

        <span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">octokit</span><span class="p">.</span><span class="nx">repos</span><span class="p">.</span><span class="nx">deleteHook</span><span class="p">({</span>
            <span class="nx">hook_id</span>: <span class="kt">id</span><span class="p">,</span>
            <span class="nx">owner</span>: <span class="kt">props</span><span class="p">[</span><span class="s2">&#34;owner&#34;</span><span class="p">],</span>
            <span class="nx">repo</span>: <span class="kt">props</span><span class="p">[</span><span class="s2">&#34;repo&#34;</span><span class="p">],</span>
        <span class="p">});</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">204</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`bad response: </span><span class="si">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">GitHubWebhookResourceArgs</span> <span class="p">{</span>
    <span class="nx">url</span>: <span class="kt">pulumi.Input</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nx">owner</span>: <span class="kt">pulumi.Input</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nx">repo</span>: <span class="kt">pulumi.Input</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">GitHubWebhookResource</span> <span class="kr">extends</span> <span class="nx">dynamic</span><span class="p">.</span><span class="nx">Resource</span> <span class="p">{</span>
    <span class="kr">constructor</span><span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span>: <span class="kt">GitHubWebhookResourceArgs</span><span class="p">,</span> <span class="nx">opts?</span>: <span class="kt">pulumi.ResourceOptions</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="k">new</span> <span class="nx">GithubWebhookProvider</span><span class="p">(),</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>With this new dynamic resource, registering the hook itself becomes
easy:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="k">new</span> <span class="nx">GitHubWebhookResource</span><span class="p">(</span><span class="s2">&#34;hook-registration&#34;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">url</span>: <span class="kt">api.url</span><span class="p">,</span>
    <span class="nx">owner</span><span class="o">:</span> <span class="s2">&#34;ellismg&#34;</span><span class="p">,</span>
    <span class="nx">repo</span><span class="o">:</span> <span class="s2">&#34;testing&#34;</span><span class="p">,</span>
<span class="p">});</span></code></pre></div>
<p>Before running <code>pulumi update</code> go and manually delete the hook
registration on GitHub. Now, when you <code>pulumi update</code> you&rsquo;ll see the new
resource created:</p>

<pre><code>Updating stack 'github-hook-blog-dev'
Performing changes:

     Type                               Name                                   Status      Info
 *   pulumi:pulumi:Stack                github-hook-blog-github-hook-blog-dev  done
 +   ‚îî‚îÄ pulumi-nodejs:dynamic:Resource  hook-registration                      created

---outputs:---
url: &quot;https://t1vyz1x203.execute-api.us-west-1.amazonaws.com/stage/&quot;

info: 1 change performed:
    + 1 resource created
      10 resources unchanged
Update duration: 4.649249758s
</code></pre>

<p>And if you look on GitHub, the hook should once again be registered!
Now, if the URL for our handler ends up changing or we destroy our
stack, the hook registration will be updated accordingly. Since our
little program is getting large (~200 lines at this point), let&rsquo;s do a
little more work on our abstraction.</p>

<h2 id="building-a-component">Building a Component</h2>

<p>Pulumi has the concept of a <code>ComponentResource</code> which is a resource that
aggregates other resources. Many resources that we interact with day to
day in Pulumi are actually <code>ComponentResources</code> (In fact, the API
resource we&rsquo;re using here is itself a component). In another file, we
can create the component resource and move much of our logic into there:</p>

<p>The interesting new code looks like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">GitHubWebhookArgs</span> <span class="p">{</span>
    <span class="nx">owner</span>: <span class="kt">pulumi.Input</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nx">repo</span>: <span class="kt">pulumi.Input</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nx">handler</span><span class="o">:</span> <span class="p">(</span><span class="nx">req</span>: <span class="kt">serverless.apigateway.Request</span><span class="p">,</span> <span class="nx">body</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kr">class</span> <span class="nx">GitHubWebhook</span> <span class="kr">extends</span> <span class="nx">pulumi</span><span class="p">.</span><span class="nx">ComponentResource</span> <span class="p">{</span>
    <span class="kr">public</span> <span class="nx">readonly</span> <span class="nx">url</span>: <span class="kt">pulumi.Output</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="kr">constructor</span><span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span>: <span class="kt">GitHubWebhookArgs</span><span class="p">,</span> <span class="nx">opts?</span>: <span class="kt">pulumi.ResourceOptions</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="s2">&#34;github:webhooks:Hook&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">opts</span><span class="p">);</span>

        <span class="kr">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">serverless</span><span class="p">.</span><span class="nx">apigateway</span><span class="p">.</span><span class="nx">API</span><span class="p">(</span><span class="s2">&#34;hook&#34;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">routes</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nx">path</span><span class="o">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
                    <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;POST&#34;</span><span class="p">,</span>
                    <span class="nx">handler</span>: <span class="kt">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="c1">// Compute the HMAC of the body, using `hookSecret` as the key and `sha1` as the algorithm
</span><span class="c1"></span>
                        <span class="c1">// First, grab the body. It may be base64 encoded, depending on if `req.isBase64Encoded` is set. If so, we
</span><span class="c1"></span>                        <span class="c1">// should decode it.
</span><span class="c1"></span>                        <span class="kd">let</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">isBase64Encoded</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">body</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">body</span><span class="p">,</span> <span class="s1">&#39;base64&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
                        <span class="p">}</span>

                        <span class="c1">// Now compute the HMAC.
</span><span class="c1"></span>                        <span class="kr">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">await</span> <span class="kr">import</span><span class="p">(</span><span class="s2">&#34;crypto&#34;</span><span class="p">);</span>
                        <span class="kr">const</span> <span class="nx">hmac</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="s2">&#34;sha1&#34;</span><span class="p">,</span> <span class="nx">hookSecret</span><span class="p">);</span>
                        <span class="nx">hmac</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>

                        <span class="kr">const</span> <span class="nx">computedSignature</span> <span class="o">=</span> <span class="sb">`sha1=</span><span class="si">${</span><span class="nx">hmac</span><span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

                        <span class="c1">// Compare the signature that came in with the request to what we computed.
</span><span class="c1"></span>                        <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-Hub-Signature&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span>
                            <span class="o">!</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">timingSafeEqual</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-Hub-Signature&#39;</span><span class="p">]),</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">computedSignature</span><span class="p">)))</span>
                        <span class="p">{</span>
                            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`error: bad signature </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-Hub-Signature&#39;</span><span class="p">]</span><span class="si">}</span><span class="sb"> !== </span><span class="si">${</span><span class="nx">computedSignature</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
                            <span class="k">return</span> <span class="p">{</span>
                                <span class="nx">statusCode</span>: <span class="kt">400</span><span class="p">,</span>
                                <span class="nx">body</span><span class="o">:</span> <span class="s2">&#34;bad signature&#34;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>

                        <span class="c1">// Call the handler after parsing the body as JSON:
</span><span class="c1"></span>                        <span class="nx">await</span> <span class="nx">args</span><span class="p">.</span><span class="nx">handler</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">));</span>

                        <span class="k">return</span> <span class="p">{</span>
                            <span class="nx">statusCode</span>: <span class="kt">200</span><span class="p">,</span>
                            <span class="nx">body</span><span class="o">:</span> <span class="s2">&#34;&#34;</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                <span class="p">},</span>
            <span class="p">],</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="nx">parent</span>: <span class="kt">this</span><span class="p">,</span>
        <span class="p">});</span>

        <span class="k">new</span> <span class="nx">GitHubWebhookResource</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">-registration-</span><span class="si">${</span><span class="nx">args</span><span class="p">.</span><span class="nx">owner</span><span class="si">}</span><span class="sb">-</span><span class="si">${</span><span class="nx">args</span><span class="p">.</span><span class="nx">repo</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">owner</span>: <span class="kt">args.owner</span><span class="p">,</span>
            <span class="nx">repo</span>: <span class="kt">args.repo</span><span class="p">,</span>
            <span class="nx">url</span>: <span class="kt">api.url</span><span class="p">,</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="nx">parent</span>: <span class="kt">this</span><span class="p">,</span>
        <span class="p">});</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>Here, we&rsquo;ve transformed our <code>createWebhook</code> method into an actual
<code>GitHubWebhook</code> component that manages both the API of the hook as the
hook&rsquo;s registration with GitHub. With this abstraction (and all of this
complexity hidden off in a separate <code>github.ts</code> file), the code we focus
on when actually writing our bot is quite small:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">pulumi</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/pulumi&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">GitHubWebhook</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;./github&#34;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pulumi</span><span class="p">.</span><span class="nx">Config</span><span class="p">(</span><span class="nx">pulumi</span><span class="p">.</span><span class="nx">getProject</span><span class="p">());</span>
<span class="kr">const</span> <span class="nx">githubToken</span> <span class="o">=</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&#34;githubToken&#34;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">hook</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GitHubWebhook</span><span class="p">(</span><span class="s2">&#34;hook&#34;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">owner</span><span class="o">:</span> <span class="s2">&#34;ellismg&#34;</span><span class="p">,</span>
    <span class="nx">repo</span><span class="o">:</span> <span class="s2">&#34;testing&#34;</span><span class="p">,</span>
    <span class="nx">handler</span>: <span class="kt">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s2">&#34;closed&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">merged</span> <span class="o">&amp;&amp;</span>
            <span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">login</span> <span class="o">===</span> <span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">login</span> <span class="o">&amp;&amp;</span>
            <span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">octokit</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@octokit/rest&#39;</span><span class="p">)()</span>
            <span class="nx">octokit</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">({</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;token&#39;</span><span class="p">,</span>
                <span class="nx">token</span>: <span class="kt">githubToken</span>
            <span class="p">});</span>

            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Deleting reference heads/</span><span class="si">${</span><span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">ref</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

            <span class="nx">await</span> <span class="nx">octokit</span><span class="p">.</span><span class="nx">gitdata</span><span class="p">.</span><span class="nx">deleteReference</span><span class="p">({</span>
                <span class="nx">owner</span>: <span class="kt">body.pull_request.head.user.login</span><span class="p">,</span>
                <span class="nx">repo</span>: <span class="kt">body.pull_request.head.repo.name</span><span class="p">,</span>
                <span class="nx">ref</span><span class="o">:</span> <span class="sb">`heads/</span><span class="si">${</span><span class="nx">body</span><span class="p">.</span><span class="nx">pull_request</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">ref</span><span class="si">}</span><span class="sb">`</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">hook</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span></code></pre></div>
<h2 id="going-further">Going Further</h2>

<p>From here, there&rsquo;s a lot of ways we could extend this code. For example,
while we require the configuration value <code>hookSecret</code> to be set before
using this abstraction, we could manage this on behalf of the user. To
do so, we could use the dynamic provider to create a special &ldquo;random&rdquo;
resource, this resource would generate a new random string when created,
but update calls would not impact the resource. Since Pulumi stores the
state of every resource across invocations in the checkpoint, our random
resource would not need to be backed by any cloud infrastructure. We
could change the shape of the <code>GitHubWebhook</code> component to allow
multiple owner/repository pairs to be provided and it would generate a
single AWS API and then multiple <code>GitHubWebhookResource</code>&rsquo;s to register
the same hook across multiple repositories. We could even extend this to
allow registration of both repository and organization level webhooks.
Or instead of hard-coding in the <code>pull_request</code> event as the only event
we care about take it as another input property to <code>GitHubWebhook</code>.</p>

<p>One of my favorite things about Pulumi is while it is easy to <em>build</em>
these abstractions, it&rsquo;s also easy to share them. For example, I&rsquo;ve
implemented a few of these ideas to build a framework for our use at
Pulumi. You can find the source on
<a href="https://github.com/ellismg/github-webhooks-serverless">GitHub</a> and I&rsquo;ve
published it as an NPM package at
<a href="https://www.npmjs.com/package/@ellismg/pulumi-github-webhooks"><code>@ellismg/pulumi-github-webhooks</code></a>.</p>
                    </section>
                    <div>
                        <p class="text-gray-500">Posted on <time>Friday, Jul 13, 2018</time>
                        
                        <ul class="m-0 p-0">
                            
                            <li class="inline-flex">
                                
                                <a class="px-2 text-s rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/serverless/">
                                    Serverless
                                </a>
                            </li>
                            
                        </ul>
                        
                    </div>
                </article>
            </div>

            <div class="md:w-2/12 pl-8">
                
            </div>
        </div>
    </div>

        </main>

        <nav class="footer bg-purple-700 py-8 px-8 md:px-0">
    <div class="container mx-auto">
        <footer>
            <div class="md:flex items-top justify-between flex-wrap">

                <div class="mb-6 md:w-4/12">
                    <a class="block mt-2" href="/">
                        <img class="h-10 opacity-50" src="/images/logo/logo-white.svg" alt="Pulumi logo">
                    </a>
                    <a class="inline-block my-4 opacity-50 text-white text-lg" href="mailto:team@pulumi.com">team@pulumi.com</a>
                    <ul class="flex inline-items text-blue-300 text-2xl">
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://twitter.com/pulumicorp" target="_blank"><i class="fab fa-twitter"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://www.linkedin.com/company/pulumi/" target="_blank"><i class="fab fa-linkedin"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://github.com/pulumi/" target="_blank"><i class="fab fa-github"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://www.youtube.com/channel/UC2Dhyn4Ev52YSbcpfnfP0Mw" target="_blank"><i class="fab fa-youtube"></i></a></li>
                        <li><a class="hover:text-blue-200" href="https://slack.pulumi.io/" target="_blank"><i class="fab fa-slack-hash"></i></a></li>
                    </ul>
                </div>

                <div class="flex flex-wrap items-top md:w-8/12">
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/containers/">Containers</a></li>
                        <li class="mb-4"><a href="/serverless/">Serverless</a></li>
                        <li class="mb-4"><a href="/docs/reference/tutorials/aws/tutorial-ec2-webserver/">Infrastructure</a></li>
                        <li class="mb-4"><a href="/kubernetes/">Kubernetes</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/docs/reference/install/">Install</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/">Get Started</a></li>
                        <li class="mb-4"><a href="/docs/reference/">Documentation</a></li>
                        <li class="mb-4"><a href="/docs/reference/pkg/">APIs</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/docs/quickstart/aws/">AWS</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/azure/">Azure</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/gcp/">Google Cloud</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/kubernetes/">Kubernetes</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/cloudfx/">Cloud Framework</a></li>
                        <li class="mb-4"><a href="/docs/reference/clouds/openstack/">OpenStack</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/about/">About Us</a></li>
                        <li class="mb-4"><a href="/contact/">Contact Us</a></li>
                        <li class="mb-4"><a href="/support/">Support</a></li>
                        <li class="mb-4"><a href="/careers/">Careers</a></li>
                    </ul>
                </div>
            </div>

            <div class="text-white opacity-75 text-sm lg:flex items-center border-t border-purple-500 mt-4 pt-4">
                
                <p class="md:w-4/12">&copy; 2019 Pulumi. All rights reserved.</p>

                <ul class="md:w-8/12">
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/trademark/">Trademark Usage</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/acceptable-use/">Acceptable Use Policy</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/terms-and-conditions/">Terms &amp; Conditions</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/privacy/">Privacy Policy</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/professional-services-agreement/">Professional Services Agreement</a></li>
                    
                </ul>
            </div>
        </footer>
    </div>
</nav>

        <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>











    




<script src="/js/bundle.min.8d935315b94bf6e77843b9c51ebc10238af740294e751f49b183b5d1e27a1c27.js" integrity="sha256-jZNTFblL9ud4Q7nFHrwQI4r3QClOdR9JsYO10eJ6HCc="></script>

    </body>
</html>
