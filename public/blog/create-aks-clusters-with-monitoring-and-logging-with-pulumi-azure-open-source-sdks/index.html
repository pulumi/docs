<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
    <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="google-site-verification" content="j-Opn93zR4YQcV5bbYN99BmNc48BT5mzd2VpzKaW9YY" />

    

    
    <meta property="og:type" content="article">
    <meta property="og:url" content="/blog/create-aks-clusters-with-monitoring-and-logging-with-pulumi-azure-open-source-sdks/">
    <meta property="og:site_name" content="pulumi">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@PulumiCorp">

    
        
            
            
                
                    <meta name="twitter:creator" content="@nishidavidson">
                
            
        
    

    
        <meta property="og:title" content="Create AKS Clusters with monitoring and logging using Pulumi-Azure open source SDKs">
    

    
        <meta name="description" content="Pulumi-Azure open source package can be used to create Azure Kubernetes
Service (AKS) clusters with AD service principals tied to the cluster.
Monitoring and logging can also be enabled by default in simple steps
with Pulumi for core AKS components. This article will show you how to
write this as a simple example using Pulumi SDKs.">
        <meta property="og:description" content="Pulumi-Azure open source package can be used to create Azure Kubernetes
Service (AKS) clusters with AD service principals tied to the cluster.
Monitoring and logging can also be enabled by default in simple steps
with Pulumi for core AKS components. This article will show you how to
write this as a simple example using Pulumi SDKs.">
    

    
    
        
            
        
    
    <meta property="og:image" content="/blog/create-aks-clusters-with-monitoring-and-logging-with-pulumi-azure-open-source-sdks/hero.png">

    <title>Create AKS Clusters with monitoring and logging using Pulumi-Azure open source SDKs - Pulumi</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />

    
    <link rel="canonical" href="https://www.pulumi.com/blog/create-aks-clusters-with-monitoring-and-logging-with-pulumi-azure-open-source-sdks/" >

    
    <link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Pulumi Blog" />

    
    
    
        
        
        
        <link rel="stylesheet" href="/css/styles.3496f5522ba2ee3f8bbb9a51ff2cb20fb6827ca85a8ae61de0a9f960bacf1023.css" integrity="sha256-NJb1Uiui7j&#43;Lu5pR/yyyD7aCfKhaiuYd4Kn5YLrPECM=">
    

    <script async defer src="https://buttons.github.io/buttons.js"></script>

    
    
        <script src="//cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function(event) {
                anchors.add("h1:not(.no-anchor), h2:not(.no-anchor), h3:not(.no-anchor), h4:not(.no-anchor), h5:not(.no-anchor), h6:not(.no-anchor)");
            });
        </script>
    

    
    
        
            
                
            
        
        
    
</head>

    <body class="section-blog">
        <nav class="bg-black text-white text-sm py-2 px-4 lg:px-0 transition-all max-h-screen md:max-h-full">
    <div class="container mx-auto">
        <ul class="flex justify-end items-center h-6">
            <li class="mr-8"><a href="https://slack.pulumi.io/" target="_blank">Slack</a></li>
            <li class="mr-8"><a href="https://github.com/pulumi" target="_blank">GitHub</a></li>
            <li class="mr-8"><a href="https://app.pulumi.com/" target="_blank">Console</a></li>
            <li class="github-widget">
                <a class="github-button" href="https://github.com/pulumi/pulumi" data-size="small" data-show-count="true" aria-label="Star pulumi/pulumi on GitHub">Star</a>
            </li>
        </ul>
    </div>
</nav>



<nav class="nav-main bg-purple-700 py-6 px-4 lg:px-0 border-t border-purple-500">
    <div class="container mx-auto">
        <header class="flex items-center justify-between flex-wrap md:flex-no-wrap">
            <div class="flex items-center flex-shrink-0 text-white lg:mr-6">
                <a class="block" href="/">
                    <img class="h-10 block" src="/images/logo/logo-inv.svg" alt="Pulumi logo">
                </a>
            </div>

            <div class="nav-header-toggle block md:hidden">
                <button class="flex items-center px-3 py-2 border rounded text-white border-purple-400 bg-purple-600">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <ul class="nav-header-items hidden w-full flex-grow md:flex md:items-center md:w-auto text-white text-sm md:text-xs lg:text-sm uppercase pt-4 md:pt-0">
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/product/" data-submenu="product" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Products
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/why-pulumi/" data-submenu="why" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Why Pulumi
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/pricing/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Pricing
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/docs/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            Docs
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/blog/" data-submenu="" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded bg-purple-400 hover:bg-purple-400">
                            Blog
                        </a>
                    </li>
                
                    <li class="whitespace-no-wrap">
                        
                        <a href="/about/" data-submenu="about" class="block py-2 px-4 md:px-0 md:py-0 md:px-4 md:py-2 my-2 md:my-0 lg:mx-4 rounded hover:bg-purple-500">
                            About
                        </a>
                    </li>
                

                <li class="md:ml-auto md:mr-2 lg:mr-4">
                    <a class="block mt-4 md:mt-0 md:text-xs lg:text-sm btn btn-orange-translucent" href="https://app.pulumi.com/">Sign In</a>
                </li>
                <li>
                    <a class="block mt-4 md:mt-0 md:text-xs lg:text-sm btn" href="https://app.pulumi.com/signup">Sign Up</a>
                </li>
            </ul>
        </header>
    </div>
</nav>
<div class="submenu">
    <div class="text-white relative overflow-visible">
        <div class="submenu-item submenu-item-product hidden absolute inset-x-0 z-50 bg-purple-700 shadow-lg pt-8 pb-16">
            <div class="container mx-auto flex items-start">
                <div class="w-1/2 pr-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">The Pulumi Platform</h3>
                    <p class="text-white">
                        Cloud Apps and Infrastructure for any cloud using languages you already know and love.
                    </p>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-sdk">Pulumi SDK</a>
                            <span>&rarr; Cloud native infrastructure as code.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-crosswalk">Pulumi Crosswalk</a>
                            <span>&rarr; Productive infrastructure as code with built-in best practices.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#pulumi-saas">Pulumi SaaS</a>
                            <span>&rarr; Continuously deliver and manage cloud software for any cloud.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/product/#multi-cloud-subscription">Multi-Cloud Subscription</a>
                            <span>&rarr; End-to-end Kubernetes solutions to achieve multi-cloud.</span>
                        </li>
                    </ul>
                    <p>
                        <span class="text-white">Pulumi is open source, free to start, and has plans available for teams.</span>
                        <a class="text-orange-500 hover:text-orange-400 hover:mr-1 transition-all" href="/pricing/">View Pricing</a> &rarr;
                    </p>
                </div>
                <div class="w-1/2 pl-12 text-purple-100 text-sm">
                    <h3 class="text-white">Get Started</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/reference/install/">Install (Mac, Windows, Linux)</a> &rarr;
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/">Documentation and Examples</a> &rarr;
                        </li>
                    </ul>
                    <h3 class="text-white">Migrate to Pulumi</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/cloudformation/">from CloudFormation</a> &rarr;
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/terraform/">from Terraform</a> &rarr;
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="submenu-item submenu-item-why hidden absolute inset-x-0 z-50 bg-purple-700 shadow pt-8 pb-16">
           <div class="container mx-auto flex items-start">
                <div class="w-1/2 pr-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">Solutions for All Teams and Engineers</h3>
                    <p class="text-white">
                        Maximize cloud velocity for Dev, DevOps, and IT, no matter your team size.
                    </p>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-developers">For Developers</a>
                            <span>&rarr; Your favorite languages, tools, and libraries.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-operators">For DevOps and IT</a>
                            <span>&rarr; Empower your team to deliver to many clouds.</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400" href="/why-pulumi/#for-business-leaders">For Business Leaders</a>
                            <span>&rarr; Modern multi-cloud for startups and enterprises.</span>
                        </li>
                    </ul>
                </div>
                <div class="w-1/4 px-12 border-r border-purple-500 text-purple-100 text-sm">
                    <h3 class="text-white">Any Code</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/serverless/">Serverless</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/containers/">Containers</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/kubernetes/">Kubernetes</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/docs/reference/tutorials/aws/tutorial-ec2-webserver/">Infrastructure</a>
                            <span>&rarr;</span>
                        </li>
                    </ul>
                </div>
                <div class="w-1/4 pl-12 text-purple-100 text-sm">
                    <h3 class="text-white">Migrate to Pulumi</h3>
                    <ul class="p-0 leading-loose">
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/aws/">AWS</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/azure/">Azure</a>
                            <span>&rarr;</span>
                        </li>
                        <li>
                            <a class="text-orange-500 font-bold hover:text-orange-400 hover:mr-1 transition-all" href="/gcp/">GCP</a>
                            <span>&rarr;</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


        
        

        <main>
            
    <div class="container mx-auto px-8 py-8 md:px-0">
        <div class="md:flex">
            <div class="md:w-3/12 pr-8">
                
<aside class="md:pr-8">

    
    <div class="md:hidden">
        <button class="blog-sidebar-toggle items-center px-3 py-2 border rounded text-purple border-purple">
            <i class="fas fa-bars"></i>
        </button>
        <a href="/blog/">üçπ Pulumi Blog</a>
    </div>

    <h3 class="no-anchor hidden md:flex mt-4">
        <a href="/blog/">üçπ Pulumi Blog</a>
    </h3>

    
    <div class="blog-sidebar-content hidden md:block">
        <div class="bg-gray-100 rounded-lg p-4 my-6 text-gray-700">
            <h5 class="no-anchor text-gray-700">Program the Cloud</h5>
            <p class="text-sm my-0">
                Create, deploy, and manage cloud infrastructure using your favorite language.
            </p>
        </div>

        <ul class="list-none p-0 mb-4 inline-flex flex-wrap text-xs">
            
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/apigateway/">
                            apigateway
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/applications/">
                            applications
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/auth/">
                            auth
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/aws/">
                            aws
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/azure/">
                            azure
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/ci/cd/">
                            ci/cd
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/cloud-native/">
                            cloud-native
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/containers/">
                            containers
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/customer/">
                            customer
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/digitalocean/">
                            digitalocean
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/docker/">
                            docker
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/eks/">
                            eks
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/events/">
                            events
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/features/">
                            features
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/gcp/">
                            gcp
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/gke/">
                            gke
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/infrastructure/">
                            infrastructure
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/javascript/">
                            javascript
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/jupyter/">
                            jupyter
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/kubernetes/">
                            kubernetes
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/lambda/">
                            lambda
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/logging/">
                            logging
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/mysql/">
                            mysql
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/new-features/">
                            new-features
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/pulumi/">
                            pulumi
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/pulumi-news/">
                            pulumi-news
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/python/">
                            python
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/security/">
                            security
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/serverless/">
                            serverless
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/testing/">
                            testing
                        </a>
                    </li>
                
            
                
                    <li>
                        
                        
                        <a class="px-2 py-1 mr-1 rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/typescript/">
                            typescript
                        </a>
                    </li>
                
            
        </ul>

        <div class="hidden lg:block my-4">
            <h5 class="no-anchor">Recent Posts</h5>
            <ul class="list-none p-0">
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/day-2-kubernetes-migrating-eks-nodegroups-with-zero-downtime/">Day 2 Kubernetes: Migrating EKS Node Groups with Zero Downtime</a>
                        </li>
                    
                
                    
                        
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/getting-started-on-digitalocean-with-pulumi/">Getting Started on DigitalOcean with Pulumi</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/pulumi-meetup-recap-apis-custom-resources-and-github-webhooks/">Pulumi Meetup Recap: APIs, Custom Resources and GitHub Webhooks</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/persisting-kubernetes-workloads-with-amazon-efscsi-volumes-using-pulumi-sdks/">Persisting Kubernetes workloads with Amazon EFS CSI volumes using Pulumi open source SDKs</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/unit-testing-infrastructure-in-nodejs-and-mocha/">Unit Testing Your Infrastructure with Node.js and Mocha</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/kubernetes-ingress-with-aws-alb-ingress-controller-and-pulumi-crosswalk/">Kubernetes Ingress with AWS ALB Ingress Controller and Pulumi Crosswalk for AWS</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/globally-distributed-serverless-application-in-100-lines-of-code-infrastructure-included/">Globally-distributed Serverless Application in 100 Lines of Code. Infrastructure Included!</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/hosting-a-static-website-on-azure-with-pulumi/">Hosting a Static Website on Azure with Pulumi</a>
                        </li>
                    
                
                    
                        <li class="my-4 leading-snug">
                            <a class="text-sm" href="/blog/running-containers-in-aws-the-lowdown-ecs-fargate-and-eks/">Running Containers in AWS, the Lowdown: ECS, Fargate, and EKS</a>
                        </li>
                    
                
            </ul>
        </div>
    </div>

    <div class="md:hidden pb-4">
        
    </div>
</aside>

            </div>

            <div class="md:w-7/12">
                <article class="mb-8 pb-8 border-b border-gray-200">
                    <h1 class="no-anchor"><a href="/blog/create-aks-clusters-with-monitoring-and-logging-with-pulumi-azure-open-source-sdks/">Create AKS Clusters with monitoring and logging using Pulumi-Azure open source SDKs</a></h1>
                    <div class="flex items-center">
                        <span>
                            <span class="flex items-center">
    
        
        

        <span class="flex items-center mr-2">
            
                <a class="rounded-full p-1 bg-gray-300 mr-2" href="/blog/author/nishi-davidson/">
                    <img class="w-8 rounded-full" src="/images/team/nishi-davidson.jpg" alt="Nishi Davidson" title="Nishi Davidson">
                </a>
                <a class="" href="/blog/author/nishi-davidson/">Nishi Davidson</a>
            
        </span>
    
</span>

                        </span>
                    </div>
                    <section>
                        <p>Pulumi-Azure open source package can be used to create Azure Kubernetes
Service (AKS) clusters with AD service principals tied to the cluster.
Monitoring and logging can also be enabled by default in simple steps
with Pulumi for core AKS components. This article will show you how to
write this as a simple example using Pulumi SDKs.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ol>
<li><a href="/docs/reference/install/">Install <code>pulumi</code> CLI</a>
and set up your <a href="/docs/quickstart/azure/"><em>Azure credentials</em></a></li>
<li>Initialize a new <a href="/docs/reference/project/">Pulumi project</a> from available
templates. We use <strong><code>****</code>azure-typescript<code>****</code></strong> template here to
install all dependencies and save the configuration.</li>
</ol>

<h2 id="step-1-export-required-configurations-for-the-aks-stack">Step 1: Export required configurations for the AKS stack</h2>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">azure</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/azure&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">pulumi</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/pulumi&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">k8s</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/kubernetes&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">azuread</span> <span class="nx">from</span> <span class="s2">&#34;@pulumi/azuread&#34;</span><span class="p">;</span>

<span class="c1">// Step 1: Parse and export configuration variables for the AKS stack.
</span><span class="c1"></span>
<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pulumi</span><span class="p">.</span><span class="nx">Config</span><span class="p">();</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&#34;password&#34;</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">location</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;location&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&#34;East US&#34;</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">failoverLocation</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;failoverLocation&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&#34;East US 2&#34;</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">nodeCount</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">getNumber</span><span class="p">(</span><span class="s2">&#34;nodeCount&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">2</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">nodeSize</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;nodeSize&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&#34;Standard_D2_v2&#34;</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">sshPublicKey</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&#34;sshPublicKey&#34;</span><span class="p">);</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">resourceGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">azure</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">ResourceGroup</span><span class="p">(</span><span class="s2">&#34;aks&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">location</span> <span class="p">});</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">loganalytics</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">azure</span><span class="p">.</span><span class="nx">operationalinsights</span><span class="p">.</span><span class="nx">AnalyticsWorkspace</span><span class="p">(</span><span class="s2">&#34;aksloganalytics&#34;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">resourceGroupName</span>: <span class="kt">resourceGroup.name</span><span class="p">,</span>
    <span class="nx">location</span>: <span class="kt">resourceGroup.location</span><span class="p">,</span>
    <span class="nx">sku</span><span class="o">:</span> <span class="s2">&#34;PerGB2018&#34;</span><span class="p">,</span>
    <span class="nx">retentionInDays</span>: <span class="kt">30</span><span class="p">,</span>
<span class="p">})</span></code></pre></div>
<h2 id="step-2-create-the-ad-service-principal-for-the-aks-cluster">Step 2: Create the AD Service principal for the AKS cluster</h2>

<p>When you register an Azure AD application in the
<a href="https://portal.azure.com/">Azure portal</a>, two objects are created in your
Azure AD tenant: a) An application object, and b) A service principal
object. To access resources that are secured by an Azure AD tenant, the
entity that requires access must be represented by a security principal
that defines the access policy and permissions for the user/application
in the Azure AD tenant. This is true for both users (user principal) and
applications (service principal). This enables core features such as
authentication of the user/application during sign-in, and authorization
during resource access.</p>

<p>In our example we create the Service principal which is a required in
the successful creation of the AKS cluster. If you see that the Service
Principal Id was not found: &ldquo;Service principal clientID: xxxxx not
found&rdquo;, simply re-run <code>pulumi update</code>to proceed.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Step 2: Create the AD service principal for the k8s cluster.
</span><span class="c1"></span><span class="kd">let</span> <span class="nx">adApp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">azuread</span><span class="p">.</span><span class="nx">Application</span><span class="p">(</span><span class="s2">&#34;aks&#34;</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">adSp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">azuread</span><span class="p">.</span><span class="nx">ServicePrincipal</span><span class="p">(</span><span class="s2">&#34;aksSp&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">applicationId</span><span class="o">:</span> <span class="nx">adApp</span><span class="p">.</span><span class="nx">applicationId</span> <span class="p">});</span>
<span class="kd">let</span> <span class="nx">adSpPassword</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">azuread</span><span class="p">.</span><span class="nx">ServicePrincipalPassword</span><span class="p">(</span><span class="s2">&#34;aksSpPassword&#34;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">servicePrincipalId</span><span class="o">:</span> <span class="nx">adSp</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="nx">password</span><span class="p">,</span>
    <span class="nx">endDate</span><span class="o">:</span> <span class="s2">&#34;2099-01-01T00:00:00Z&#34;</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="step-3-create-the-aks-cluster">Step 3: Create the AKS cluster</h2>

<p>Now let&rsquo;s add the logic to create the AKS cluster with the Service
principal.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Step 3: This step creates an AKS cluster.
</span><span class="c1"></span><span class="k">export</span> <span class="k">const</span> <span class="nx">k8sCluster</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">azure</span><span class="p">.</span><span class="nx">containerservice</span><span class="p">.</span><span class="nx">KubernetesCluster</span><span class="p">(</span><span class="s2">&#34;aksCluster&#34;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">resourceGroupName</span><span class="o">:</span> <span class="nx">resourceGroup</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
        <span class="nx">location</span><span class="o">:</span> <span class="nx">location</span><span class="p">,</span>
        <span class="nx">agentPoolProfile</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;aksagentpool&#34;</span><span class="p">,</span>
            <span class="nx">count</span><span class="o">:</span> <span class="nx">nodeCount</span><span class="p">,</span>
            <span class="nx">vmSize</span><span class="o">:</span> <span class="nx">nodeSize</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="nx">dnsPrefix</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">pulumi</span><span class="p">.</span><span class="nx">getStack</span><span class="p">()</span><span class="si">}</span><span class="sb">-kube`</span><span class="p">,</span>
        <span class="nx">linuxProfile</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">adminUsername</span><span class="o">:</span> <span class="s2">&#34;aksuser&#34;</span><span class="p">,</span> 
            <span class="nx">sshKey</span><span class="o">:</span> <span class="p">{</span> <span class="nx">keyData</span><span class="o">:</span> <span class="nx">sshPublicKey</span><span class="p">,</span> <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">servicePrincipal</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">clientId</span><span class="o">:</span> <span class="nx">applicationId</span><span class="p">,</span>
            <span class="nx">clientSecret</span><span class="o">:</span> <span class="nx">adSpPassword</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="nx">addonProfile</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">omsAgent</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">enabled</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nx">logAnalyticsWorkspaceId</span><span class="o">:</span> <span class="nx">loganalytics</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">});</span> 

<span class="c1">// Expose a k8s provider instance using our custom cluster instance.
</span><span class="c1"></span><span class="k">export</span> <span class="k">const</span> <span class="nx">k8sProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">k8s</span><span class="p">.</span><span class="nx">Provider</span><span class="p">(</span><span class="s2">&#34;aksK8s&#34;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">kubeconfig</span><span class="o">:</span> <span class="nx">k8sCluster</span><span class="p">.</span><span class="nx">kubeConfigRaw</span><span class="p">,</span>
    <span class="p">});</span>

<span class="c1">// Export the kubeconfig
</span><span class="c1"></span><span class="k">export</span> <span class="k">const</span> <span class="nx">kubeconfig</span> <span class="o">=</span> <span class="nx">k8sCluster</span><span class="p">.</span><span class="nx">kubeConfigRaw</span>
</code></pre></div>
<h2 id="step-4-enable-default-monitoring-and-logging-for-the-aks-cluster">Step 4: Enable default monitoring and logging for the AKS cluster</h2>

<p>Log queries are used to retrieve any log data from Azure Monitor.
Whether you&rsquo;re
<a href="https://docs.microsoft.com/en-us/azure/azure-monitor/log-query/portals">analyzing data in the portal</a>,
<a href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/alerts-metric">configuring an alert rule</a>
to be notified of a particular condition, or retrieving data using the
<a href="https://dev.loganalytics.io/">Azure Monitor Logs API</a>, you will use a
query to specify the data you want.</p>

<p>We will now enable monitoring and logging by default for the cluster and
run <code>pulumi up</code></p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Step 4: Enables the Monitoring Diagonostic control plane component logs and AllMetrics   
</span><span class="c1"></span><span class="k">export</span> <span class="k">const</span> <span class="nx">azMonitoringDiagnostic</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">azure</span><span class="p">.</span><span class="nx">monitoring</span><span class="p">.</span><span class="nx">DiagnosticSetting</span><span class="p">(</span><span class="s2">&#34;aks&#34;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">logAnalyticsWorkspaceId</span><span class="o">:</span> <span class="nx">loganalytics</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="nx">targetResourceId</span><span class="o">:</span> <span class="nx">k8sCluster</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="nx">logs</span><span class="o">:</span>  <span class="p">[{</span>
        <span class="nx">category</span><span class="o">:</span> <span class="s2">&#34;kube-apiserver&#34;</span><span class="p">,</span>
        <span class="nx">enabled</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    
        <span class="nx">retentionPolicy</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">enabled</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">],</span>
    <span class="nx">metrics</span><span class="o">:</span> <span class="p">[{</span>
        <span class="nx">category</span><span class="o">:</span> <span class="s2">&#34;AllMetrics&#34;</span><span class="p">,</span>
    
        <span class="nx">retentionPolicy</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">enabled</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}],</span>
<span class="p">})</span>
</code></pre></div>
<p>If you run <code>pulumi up</code> with the entire <code>index.ts</code> file as defined
<a href="https://gist.github.com/d-nishi/b757e1e8b3ebe187d81ce32a4d15525e">here</a>
you will see an AKS cluster get created with monitoring and logging
enabled.</p>

<h2 id="step-5-check-if-everything-worked">Step 5: Check if everything worked</h2>

<p>a) Check with Pulumi CLI and <code>kubectl</code></p>

<pre><code>$ pulumi stack output kubeconfig &gt; kubeconfig.yaml

$ kubectl config current-context
akscluster1321f898
</code></pre>

<p>b) Check Pulumi Service Console for the resource creation on the stack
you just initialized: <code>d-nishi/azure-mean/dev</code>.</p>

<p><img src="./initialized.png" alt="initliazed" /></p>

<p>c) Check your Azure portal for the cluster-id and to find all the
metrics (Insights) and logs (Logs) show up as follows:</p>

<p><img src="./insights.png" alt="insights" /></p>

<p><img src="./logs.png" alt="logs" /></p>

<h2 id="summary">Summary</h2>

<p>We discussed how to set up AKS clusters with monitoring
and logging in simple steps with Pulumi packages. You can find the
complete pulumi code for our example
<a href="https://gist.github.com/d-nishi/b757e1e8b3ebe187d81ce32a4d15525e"><em>here</em></a>.
For more examples visit our <a href="https://github.com/pulumi/examples">GitHub examples</a> repo.</p>

<p>If you want to additionally look at how to integrate Azure DevOps with
Pulumi, check out our other post
<a href="/blog/cd-made-easy-with-pulumi-and-azure-pipelines/">CI/CD made easy with Pulumi and Azure Pipelines</a>.</p>
                    </section>
                    <div>
                        <p class="text-gray-500">Posted on <time>Wednesday, May 8, 2019</time>
                        
                        <ul class="m-0 p-0">
                            
                            <li class="inline-flex">
                                
                                <a class="px-2 text-s rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/kubernetes/">
                                    Kubernetes
                                </a>
                            </li>
                            
                            <li class="inline-flex">
                                
                                <a class="px-2 text-s rounded transition-all bg-white border border-gray-200 text-blue-600 hover:border-blue-600" href="/blog/tag/azure/">
                                    Azure
                                </a>
                            </li>
                            
                        </ul>
                        
                    </div>
                </article>
            </div>

            <div class="md:w-2/12 pl-8">
                
            </div>
        </div>
    </div>

        </main>

        <nav class="footer bg-purple-700 py-8 px-8 md:px-0">
    <div class="container mx-auto">
        <footer>
            <div class="md:flex items-top justify-between flex-wrap">

                <div class="mb-6 md:w-4/12">
                    <a class="block mt-2" href="/">
                        <img class="h-10 opacity-50" src="/images/logo/logo-white.svg" alt="Pulumi logo">
                    </a>
                    <a class="inline-block my-4 opacity-50 text-white text-lg" href="mailto:team@pulumi.com">team@pulumi.com</a>
                    <ul class="flex inline-items text-blue-300 text-2xl">
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://twitter.com/pulumicorp" target="_blank"><i class="fab fa-twitter"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://www.linkedin.com/company/pulumi/" target="_blank"><i class="fab fa-linkedin"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://github.com/pulumi/" target="_blank"><i class="fab fa-github"></i></a></li>
                        <li class="mr-4"><a class="hover:text-blue-200" href="https://www.youtube.com/channel/UC2Dhyn4Ev52YSbcpfnfP0Mw" target="_blank"><i class="fab fa-youtube"></i></a></li>
                        <li><a class="hover:text-blue-200" href="https://slack.pulumi.io/" target="_blank"><i class="fab fa-slack-hash"></i></a></li>
                    </ul>
                </div>

                <div class="flex flex-wrap items-top md:w-8/12">
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/containers/">Containers</a></li>
                        <li class="mb-4"><a href="/serverless/">Serverless</a></li>
                        <li class="mb-4"><a href="/docs/reference/tutorials/aws/tutorial-ec2-webserver/">Infrastructure</a></li>
                        <li class="mb-4"><a href="/kubernetes/">Kubernetes</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/docs/reference/install/">Install</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/">Get Started</a></li>
                        <li class="mb-4"><a href="/docs/reference/">Documentation</a></li>
                        <li class="mb-4"><a href="/docs/reference/pkg/">APIs</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/docs/quickstart/aws/">AWS</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/azure/">Azure</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/gcp/">Google Cloud</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/kubernetes/">Kubernetes</a></li>
                        <li class="mb-4"><a href="/docs/quickstart/cloudfx/">Cloud Framework</a></li>
                        <li class="mb-4"><a href="/docs/reference/clouds/openstack/">OpenStack</a></li>
                    </ul>
                    <ul class="my-4 text-white w-1/2 md:w-3/12">
                        <li class="mb-4"><a href="/about/">About Us</a></li>
                        <li class="mb-4"><a href="/contact/">Contact Us</a></li>
                        <li class="mb-4"><a href="/support/">Support</a></li>
                        <li class="mb-4"><a href="/careers/">Careers</a></li>
                    </ul>
                </div>
            </div>

            <div class="text-white opacity-75 text-sm lg:flex items-center border-t border-purple-500 mt-4 pt-4">
                
                <p class="md:w-4/12">&copy; 2019 Pulumi. All rights reserved.</p>

                <ul class="md:w-8/12">
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/trademark/">Trademark Usage</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/acceptable-use/">Acceptable Use Policy</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/terms-and-conditions/">Terms &amp; Conditions</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/privacy/">Privacy Policy</a></li>
                    
                        <li class="inline mr-2 lg:mr-4"><a href="/professional-services-agreement/">Professional Services Agreement</a></li>
                    
                </ul>
            </div>
        </footer>
    </div>
</nav>

        <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>











    




<script src="/js/bundle.min.8d935315b94bf6e77843b9c51ebc10238af740294e751f49b183b5d1e27a1c27.js" integrity="sha256-jZNTFblL9ud4Q7nFHrwQI4r3QClOdR9JsYO10eJ6HCc="></script>

    </body>
</html>
