---
title: "Module ecr"
title_tag: "Module ecr | Package @pulumi/awsx | Node.js SDK"
linktitle: "ecr"
meta_desc: "Explore members of the ecr module in the @pulumi/awsx package."
git_sha: "7e3319acc1119743eb7e923349542ed966380c18"
---

<!-- WARNING: this page was generated by a tool. Do not edit it by hand. -->
<!-- To change it, please see https://github.com/pulumi/docs/tree/master/tools/tscdocgen. -->

{{< resource-docs-alert "awsx" >}}


## Pulumi Elastic Contain Registry (ECR) Components

Pulumi's API's for simplifying working with [ECR](https://aws.amazon.com/ecr/). The API currently provides ways to define and configure [`Repositories`](https://docs.aws.amazon.com/AmazonECR/latest/userguide/Repositories.html) and [`LifecyclePolicies`](https://docs.aws.amazon.com/AmazonECR/latest/userguide/LifecyclePolicies.html).  It also makes it simple to build and push [Docker Images](https://docs.docker.com/engine/reference/commandline/image/) to a Repository providing stored cloud images that can then be used by other AWS services like ECS.

### Repositories

To start with, here's a simple example of how one can create a simple ECR Repository:

```ts
import * as aws from "@pulumi/aws";
import * as awsx from "@pulumi/awsx";

const repository = new awsx.ecr.Repository("app");
```

With a repository available, it's easy to build an push a Docker Image that will be stored in the cloud:


```ts
const repository = new awsx.ecr.Repository("app");

// "./app" is a relative folder to this application containing a Dockerfile.  For more
// examples of what can be built and pushed, see the @pulumi/docker package.
const image = repository.buildAndPushImage("./app");
```

Now that we have an image, it can be easily referenced from an ECS Service like so:

```ts
const repository = new awsx.ecr.Repository("app");
const image = repository.buildAndPushImage("./app");

const listener = new awsx.lb.NetworkListener("app", { port: 80 });
const nginx = new awsx.ecs.FargateService("app", {
    taskDefinitionArgs: {
        containers: {
            nginx: {
                image: image,
                memory: 128,
                portMappings: [listener],
            },
        },
    },
    desiredCount: 2,
});
```

In the case where you don't really need to use the repository (except as a place to store the built image), the above can be simplified as:


```ts
const nginx = new awsx.ecs.FargateService("app", {
    taskDefinitionArgs: {
        containers: {
            nginx: {
                image: awsx.ecr.buildAndPushImage("app", "./app"),
                // ...
            },
        },
    },
    // ...
});
```

### Lifecycle Policies

Amazon ECR lifecycle policies enable you to specify the lifecycle management of images in a repository. A lifecycle policy is a set of one or more rules, where each rule defines an action for Amazon ECR. The actions apply to images that contain tags prefixed with the given strings. This allows the automation of cleaning up unused images, for example expiring images based on age or count. You should expect that after creating a lifecycle policy the affected images are expired within 24 hours.  See https://docs.aws.amazon.com/AmazonECR/latest/userguide/LifecyclePolicies.html for more details.

The ECR module makes it easy to configure the Lifecycle Policy for a given Repository.  There are two main ways that control how an image is purged from the repository:

1. Once a maximum number of images has been reached (`maximumNumberOfImages`).
2. Once an image reaches a maximum allowed age (`maximumAgeLimit`).

Policies can apply to all images, 'untagged' images, or tagged images that match a specific tag-prefix.

By default an awsx.ecr.Repository is created with a policy that will only keep at most one untagged image around.  In other words, the following are equivalent:

```ts
const repository1 = new awsx.ecr.Repository("app1");
const repository2 = new awsx.ecr.Repository("app2", {
    lifeCyclePolicyArgs: {
        rules: [{
            selection: "untagged",
            maximumNumberOfImages: 1,
        }],
    },
});
```

### Policy Rules

A Lifecycle Policy is built from a collection of `rules`.  These rules are ordered from lower priority to higher priority. How the collection of `rules` is interpreted is as follows:

1. An image is expired by exactly one or zero rules.
2. An image that matches the tagging requirements of a higher priority rule cannot be expired by a
   rule with a lower priority.
3. Rules can never mark images that are marked by higher priority rules, but can still identify them
   as if they haven't been expired.
4. The set of rules must contain a unique set of tag prefixes.
5. Only one rule is allowed to select `untagged` images.
6. Expiration is always ordered by the "pushed at time" for an image, and always expires older
   images before newer ones.
7. When using the `tagPrefixList`, an image is successfully matched if all of the tags in the
   `tagPrefixList` value are matched against any of the image's tags.
8. With `maximumNumberOfImages`, images are sorted from youngest to oldest based on their "pushed at
   time" and then all images greater than the specified count are expired.
9. `maximumAgeLimit`, all images whose "pushed at time" is older than the specified number of days
   based on `countNumber` are expired.


### Examples

#### Example A:

The following example shows the lifecycle policy syntax for a policy that expires untagged images older than 14 days:

```ts
const repository = new awsx.ecr.Repository("app", {
    lifeCyclePolicyArgs: {
        rules: [{
            selection: "untagged",
            maximumAgeLimit: 14,
        }],
    },
});
```

#### Example B: Filtering on Multiple Rules

The following examples use multiple rules in a lifecycle policy. An example repository and lifecycle policy are given along with an explanation of the outcome.

```ts
const repository = new awsx.ecr.Repository("app", {
    lifeCyclePolicyArgs: {
        rules: [{
            selection: { tagPrefixList: ["prod"] },
            maximumNumberOfImages: 1,
        }, {
            selection: { tagPrefixList: ["beta"] },
            maximumNumberOfImages: 1,
        }],
    },
});
```

Repository contents:
* Image A, Taglist: ["beta-1", "prod-1"], Pushed: 10 days ago
* Image B, Taglist: ["beta-2", "prod-2"], Pushed: 9 days ago
* Image C, Taglist: ["beta-3"], Pushed: 8 days ago

The logic of this lifecycle policy would be:

1. Rule 1 identifies images tagged with prefix `prod`. It should mark images, starting with the
   oldest, until there is one or fewer images remaining that match. It marks Image A for expiration.

2. Rule 2 identifies images tagged with prefix beta. It should mark images, starting with the
   oldest, until there is one or fewer images remaining that match. It marks both Image A and Image
   B for expiration. However, Image A has already been seen by Rule 1 and if Image B were expired it
   would violate Rule 1 and thus is skipped.

Result: Image A is expired.

#### Example C: Filtering on Multiple Rules

This is the same repository as the previous example but the rule priority order is changed to illustrate the outcome.

```ts
const repository = new awsx.ecr.Repository("app", {
    lifeCyclePolicyArgs: {
        rules: [{
            selection: { tagPrefixList: ["beta"] },
            maximumNumberOfImages: 1,
        }, {
            selection: { tagPrefixList: ["prod"] },
            maximumNumberOfImages: 1,
        }],
    },
});
```

Repository contents:
* Image A, Taglist: ["beta-1", "prod-1"], Pushed: 10 days ago
* Image B, Taglist: ["beta-2", "prod-2"], Pushed: 9 days ago
* Image C, Taglist: ["beta-3"], Pushed: 8 days ago

The logic of this lifecycle policy would be:

1. Rule 1 identifies images tagged with beta. It should mark images, starting with the oldest, until
   there is one or fewer images remaining that match. It sees all three images and would mark Image
   A and Image B for expiration.

2. Rule 2 identifies images tagged with prod. It should mark images, starting with the oldest, until
   there is one or fewer images remaining that match. It would see no images because all available
   images were already seen by Rule 1 and thus would mark no additional images.

Result: Images A and B are expired.

#### Example D: Filtering on Multiple Tags in a Single Rule

The following examples specify the lifecycle policy syntax for multiple tag prefixes in a single rule. An example repository and lifecycle policy are given along with an explanation of the outcome.

When multiple tag prefixes are specified on a single rule, images must match all listed tag prefixes.

```ts
const repository = new awsx.ecr.Repository("app", {
    lifeCyclePolicyArgs: {
        rules: [{
            selection: { tagPrefixList: ["alpha", "beta"] },
            maximumAgeLimit: 5,
        },
    },
});
```

Repository contents:
* Image A, Taglist: ["alpha-1"], Pushed: 12 days ago
* Image B, Taglist: ["beta-1"], Pushed: 11 days ago
* Image C, Taglist: ["alpha-2", "beta-2"], Pushed: 10 days ago
* Image D, Taglist: ["alpha-3"], Pushed: 4 days ago
* Image E, Taglist: ["beta-3"], Pushed: 3 days ago
* Image F, Taglist: ["alpha-4", "beta-4"], Pushed: 2 days ago

The logic of this lifecycle policy would be:

1. Rule 1 identifies images tagged with alpha and beta. It sees images C and F. It should mark
   images that are older than five days, which would be Image C.

2. Result: Image C is expired.

#### Example E: Filtering on All Images

The following lifecycle policy examples specify all images with different filters. An example repository and lifecycle policy are given along with an explanation of the outcome.


```ts
const repository = new awsx.ecr.Repository("app", {
    lifeCyclePolicyArgs: {
        rules: [{
            selection: "any",
            maximumNumberOfImages: 5,
        },
    },
});
```

Repository contents:
* Image A, Taglist: ["alpha-1"], Pushed: 4 days ago
* Image B, Taglist: ["beta-1"], Pushed: 3 days ago
* Image C, Taglist: [], Pushed: 2 days ago
* Image D, Taglist: ["alpha-2"], Pushed: 1 day ago

The logic of this lifecycle policy would be:

1. Rule 1 identifies all images. It sees images A, B, C, and D. It should expire all images other
   than the newest one. It marks images A, B, and C for expiration.

2. Result: Images A, B, and C are expired.





<h3>Resources</h3>
<ul class="api">
    <li><a href="#Repository"><span class="symbol resource"></span>Repository</a></li>
</ul>


<h3>Others</h3>
<ul class="api">
    <li><a href="#buildAndPushImage"><span class="symbol api"></span>buildAndPushImage</a></li>
    <li><a href="#LifecyclePolicy"><span class="symbol api"></span>LifecyclePolicy</a></li>
    <li><a href="#LifecyclePolicyArgs"><span class="symbol api"></span>LifecyclePolicyArgs</a></li>
    <li><a href="#LifecyclePolicyRule"><span class="symbol api"></span>LifecyclePolicyRule</a></li>
    <li><a href="#RepositoryArgs"><span class="symbol api"></span>RepositoryArgs</a></li>
    <li><a href="#RepositoryImage"><span class="symbol api"></span>RepositoryImage</a></li>
</ul>


<h2 id="resources">Resources</h2>
<h3 class="pdoc-module-header" id="Repository" data-link-title="Repository">
    <a href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L31">
        Resource <strong>Repository</strong>
    </a>
</h3>

<pre class="highlight"><code><span class='kr'>class</span> <span class='nx'>Repository</span> <span class='kr'>extends</span> <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#ComponentResource'>ComponentResource</a></code></pre>

A [Repository] represents an [aws.ecr.Repository] along with an associated [LifecyclePolicy]
controlling how images are retained in the repo.

Docker images can be built and pushed to the repo using the [buildAndPushImage] method.  This
will call into the `@pulumi/docker/buildAndPushImage` function using this repo as the appropriate
destination registry.

<h4 class="pdoc-member-header" id="Repository-constructor">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L33"> <b>constructor</b></a>
</h4>


<pre class="highlight"><code><span class='kd'></span><span class='kd'>new</span> Repository(name: <span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>, args: <a href='#RepositoryArgs'>RepositoryArgs</a>, opts: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#ComponentResourceOptions'>ComponentResourceOptions</a>)</code></pre>

<h4 class="pdoc-member-header" id="Repository-buildAndPushImage">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L51">method <b>buildAndPushImage</b></a>
</h4>


<pre class="highlight"><code><span class='kd'>public </span>buildAndPushImage(pathOrBuild: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span> | DockerBuild&gt;): <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#OutputInstance'>OutputInstance</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>&gt; &amp; { ... }</code></pre>


Builds the docker container specified by [pathOrBuild] and pushes it to this repository.
The result is the unique ID pointing to that pushed image in this repo.  This unique ID
can be passed as the value to `image: repo.buildAndPushImage(...)` in an `ecs.Container`.

<h4 class="pdoc-member-header" id="Repository-getData">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L31">method <b>getData</b></a>
</h4>


<pre class="highlight"><code><span class='kd'>protected </span>getData(): <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise'>Promise</a>&lt;TData&gt;</code></pre>


Retrieves the data produces by [initialize].  The data is immediately available in a
derived class's constructor after the `super(...)` call to `ComponentResource`.

<h4 class="pdoc-member-header" id="Repository-getProvider">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L31">method <b>getProvider</b></a>
</h4>


<pre class="highlight"><code><span class='kd'></span>getProvider(moduleMember: <span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>): <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#ProviderResource'>ProviderResource</a> | <span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined'>undefined</a></span></code></pre>

<h4 class="pdoc-member-header" id="Repository-initialize">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L31">method <b>initialize</b></a>
</h4>


<pre class="highlight"><code><span class='kd'>protected </span>initialize(args: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Inputs'>Inputs</a>): <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise'>Promise</a>&lt;TData&gt;</code></pre>


Can be overridden by a subclass to asynchronously initialize data for this Component
automatically when constructed.  The data will be available immediately for subclass
constructors to use.  To access the data use `.getData`.

<h4 class="pdoc-member-header" id="Repository-isInstance">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L31">method <b>isInstance</b></a>
</h4>


<pre class="highlight"><code><span class='kd'>static </span>isInstance(obj: <span class='kd'><a href='https://www.typescriptlang.org/docs/handbook/basic-types.html#any'>any</a></span>): obj is <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#ComponentResource'>ComponentResource</a></code></pre>


Returns true if the given object is an instance of CustomResource.  This is designed to work even when
multiple copies of the Pulumi SDK have been loaded into the same process.

<h4 class="pdoc-member-header" id="Repository-registerOutputs">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L31">method <b>registerOutputs</b></a>
</h4>


<pre class="highlight"><code><span class='kd'>protected </span>registerOutputs(outputs?: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Inputs'>Inputs</a> | <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise'>Promise</a>&lt;<a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Inputs'>Inputs</a>&gt; | <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Output'>Output</a>&lt;<a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Inputs'>Inputs</a>&gt;): <span class='kd'><a href='https://www.typescriptlang.org/docs/handbook/basic-types.html#void'>void</a></span></code></pre>


registerOutputs registers synthetic outputs that a component has initialized, usually by
allocating other child sub-resources and propagating their resulting property values.

ComponentResources can call this at the end of their constructor to indicate that they are
done creating child resources.  This is not strictly necessary as this will automatically be
called after the `initialize` method completes.

<h4 class="pdoc-member-header" id="Repository-lifecyclePolicy">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L33">property <b>lifecyclePolicy</b></a>
</h4>

<pre class="highlight"><code><span class='kd'>public </span>lifecyclePolicy: <a href='/docs/reference/pkg/nodejs/pulumi/aws/ecr/#LifecyclePolicy'>LifecyclePolicy</a> | <span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined'>undefined</a></span>;</code></pre>
<h4 class="pdoc-member-header" id="Repository-repository">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L32">property <b>repository</b></a>
</h4>

<pre class="highlight"><code><span class='kd'>public </span>repository: <a href='/docs/reference/pkg/nodejs/pulumi/aws/ecr/#Repository'>Repository</a>;</code></pre>
<h4 class="pdoc-member-header" id="Repository-urn">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L31">property <b>urn</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>urn: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Output'>Output</a>&lt;<a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#URN'>URN</a>&gt;;</code></pre>

urn is the stable logical URN used to distinctly address a resource, both before and after
deployments.



<h2 id="apis">Others</h2>
<h3 class="pdoc-module-header" id="buildAndPushImage" data-link-title="buildAndPushImage">
    <a href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L65">
        function <strong>buildAndPushImage</strong>
    </a>
</h3>


<pre class="highlight"><code><span class='kd'></span>buildAndPushImage(name: <span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>, pathOrBuild: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span> | DockerBuild&gt;, args?: <a href='#RepositoryArgs'>RepositoryArgs</a>, opts?: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#ComponentResourceOptions'>pulumi.ComponentResourceOptions</a>): <a href='#RepositoryImage'>RepositoryImage</a></code></pre>


Creates a new [Repository], optionally configured using [args], builds the docker container
specified by [pathOrBuild] and then pushes the built image to the repository.  The result
contains both the Repository created as well as the unique ID referencing the built image in that
repo.  This result type can be passed in as `image: ecr.buildAndPushImage(...)` for an
`ecs.Container`

<h3 class="pdoc-module-header" id="LifecyclePolicy" data-link-title="LifecyclePolicy">
    <a href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L20">
        class <strong>LifecyclePolicy</strong>
    </a>
</h3>

<pre class="highlight"><code><span class='kr'>class</span> <span class='nx'>LifecyclePolicy</span> <span class='kr'>extends</span> <a href='/docs/reference/pkg/nodejs/pulumi/aws/ecr/#LifecyclePolicy'>LifecyclePolicy</a></code></pre>
<h4 class="pdoc-member-header" id="LifecyclePolicy-constructor">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L20"> <b>constructor</b></a>
</h4>


<pre class="highlight"><code><span class='kd'></span><span class='kd'>new</span> LifecyclePolicy(name: <span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>, repository: <a href='/docs/reference/pkg/nodejs/pulumi/aws/ecr/#Repository'>Repository</a>, args?: <a href='#LifecyclePolicyArgs'>LifecyclePolicyArgs</a>, opts: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#ComponentResourceOptions'>ComponentResourceOptions</a>)</code></pre>


Creates a new [LifecyclePolicy] for the given [repository].  If [args] is not provided, then
[getDefaultLifecyclePolicyArgs] will be used to set the default policy for this repo.

<h4 class="pdoc-member-header" id="LifecyclePolicy-defaultLifecyclePolicyArgs">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L41">method <b>defaultLifecyclePolicyArgs</b></a>
</h4>


<pre class="highlight"><code><span class='kd'>public static </span>defaultLifecyclePolicyArgs(): <a href='#LifecyclePolicyArgs'>LifecyclePolicyArgs</a></code></pre>


Creates a default lifecycle policy such that at most a single untagged image is retained. All
tagged layers and images will never expire.

<h4 class="pdoc-member-header" id="LifecyclePolicy-get">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L20">method <b>get</b></a>
</h4>


<pre class="highlight"><code><span class='kd'>static </span>get(name: <span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>, id: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#ID'>pulumi.ID</a>&gt;, state?: LifecyclePolicyState, opts?: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#CustomResourceOptions'>pulumi.CustomResourceOptions</a>): <a href='/docs/reference/pkg/nodejs/pulumi/aws/ecr/#LifecyclePolicy'>LifecyclePolicy</a></code></pre>


Get an existing LifecyclePolicy resource's state with the given name, ID, and optional extra
properties used to qualify the lookup.

<h4 class="pdoc-member-header" id="LifecyclePolicy-getProvider">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L20">method <b>getProvider</b></a>
</h4>


<pre class="highlight"><code><span class='kd'></span>getProvider(moduleMember: <span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>): <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#ProviderResource'>ProviderResource</a> | <span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined'>undefined</a></span></code></pre>

<h4 class="pdoc-member-header" id="LifecyclePolicy-isInstance">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L20">method <b>isInstance</b></a>
</h4>


<pre class="highlight"><code><span class='kd'>static </span>isInstance(obj: <span class='kd'><a href='https://www.typescriptlang.org/docs/handbook/basic-types.html#any'>any</a></span>): obj is <a href='/docs/reference/pkg/nodejs/pulumi/aws/ecr/#LifecyclePolicy'>LifecyclePolicy</a></code></pre>


Returns true if the given object is an instance of LifecyclePolicy.  This is designed to work even
when multiple copies of the Pulumi SDK have been loaded into the same process.

<h4 class="pdoc-member-header" id="LifecyclePolicy-id">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L20">property <b>id</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>id: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Output'>Output</a>&lt;<a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#ID'>ID</a>&gt;;</code></pre>

id is the provider-assigned unique ID for this managed resource.  It is set during
deployments and may be missing (undefined) during planning phases.

<h4 class="pdoc-member-header" id="LifecyclePolicy-policy">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L20">property <b>policy</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>policy: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Output'>pulumi.Output</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>&gt;;</code></pre>

The policy document. This is a JSON formatted string. See more details about [Policy Parameters](http://docs.aws.amazon.com/AmazonECR/latest/userguide/LifecyclePolicies.html#lifecycle_policy_parameters) in the official AWS docs.

<h4 class="pdoc-member-header" id="LifecyclePolicy-registryId">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L20">property <b>registryId</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>registryId: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Output'>pulumi.Output</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>&gt;;</code></pre>

The registry ID where the repository was created.

<h4 class="pdoc-member-header" id="LifecyclePolicy-repository">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L20">property <b>repository</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>repository: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Output'>pulumi.Output</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>&gt;;</code></pre>

Name of the repository to apply the policy.

<h4 class="pdoc-member-header" id="LifecyclePolicy-urn">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L20">property <b>urn</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>urn: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Output'>Output</a>&lt;<a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#URN'>URN</a>&gt;;</code></pre>

urn is the stable logical URN used to distinctly address a resource, both before and after
deployments.

<h3 class="pdoc-module-header" id="LifecyclePolicyArgs" data-link-title="LifecyclePolicyArgs">
    <a href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L139">
        interface <strong>LifecyclePolicyArgs</strong>
    </a>
</h3>

<pre class="highlight"><code><span class='kr'>interface</span> <span class='nx'>LifecyclePolicyArgs</span></code></pre>

See https://docs.aws.amazon.com/AmazonECR/latest/userguide/lifecycle_policy_examples.html for
more details.

<h4 class="pdoc-member-header" id="LifecyclePolicyArgs-rules">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L145">property <b>rules</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>rules: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<a href='#LifecyclePolicyRule'>LifecyclePolicyRule</a>&gt;[]&gt;;</code></pre>

Specifies the rules to determine how images should be retired from this repository. Rules are
ordered from lowest priority to highest.  If there is a rule with a `selection` value of
`any`, then it will have the highest priority.

<h3 class="pdoc-module-header" id="LifecyclePolicyRule" data-link-title="LifecyclePolicyRule">
    <a href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L175">
        interface <strong>LifecyclePolicyRule</strong>
    </a>
</h3>

<pre class="highlight"><code><span class='kr'>interface</span> <span class='nx'>LifecyclePolicyRule</span></code></pre>

The following behaviors hold for these rules:

 * An image is expired by exactly one or zero rules.

 * An image that matches the tagging requirements of a higher priority rule cannot be expired by
   a rule with a lower priority.

 * Rules can never mark images that are marked by higher priority rules, but can still identify
   them as if they haven't been expired.

 * The set of rules must contain a unique set of tag prefixes.

 * Only one rule is allowed to select `untagged` images.

 * Expiration is always ordered by pushed_at_time, and always expires older images before newer
   ones.

 * When using the `tagPrefixList`, an image is successfully matched if all of the tags in the
   `tagPrefixList` value are matched against any of the image's tags.

 * With `maximumNumberOfImages`, images are sorted from youngest to oldest based on
   pushed_at_time and then all images greater than the specified count are expired.

 * With `maximumAgeLimit`, all images whose pushed_at_time is older than the specified number of
   days based on countNumber are expired.

<h4 class="pdoc-member-header" id="LifecyclePolicyRule-description">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L179">property <b>description</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>description?: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>&gt;;</code></pre>

Describes the purpose of a rule within a lifecycle policy.

<h4 class="pdoc-member-header" id="LifecyclePolicyRule-maximumAgeLimit">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L207">property <b>maximumAgeLimit</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>maximumAgeLimit?: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number'>number</a></span>&gt;;</code></pre>

The maximum age limit (in days) for your images.  Either [maximumNumberOfImages] or
[maximumAgeLimit] must be provided.

<h4 class="pdoc-member-header" id="LifecyclePolicyRule-maximumNumberOfImages">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L201">property <b>maximumNumberOfImages</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>maximumNumberOfImages?: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number'>number</a></span>&gt;;</code></pre>

The maximum number of images that you want to retain in your repository.  Either
[maximumNumberOfImages] or [maximumAgeLimit] must be provided.

<h4 class="pdoc-member-header" id="LifecyclePolicyRule-selection">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/lifecyclePolicy.ts#L187">property <b>selection</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>selection: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<span class='s2'>"untagged"</span> | <span class='s2'>"any"</span> | {
    tagPrefixList: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>&gt;[]&gt;;
}&gt;;</code></pre>

Determines whether the lifecycle policy rule that you are adding specifies a tag for an
image. If you specify `any`, then all images have the rule applied to them. If you specify
`untagged` then the rule will only apply to untagged images.  Otherwise, you can specify a
`tagPrefixList` value.

<h3 class="pdoc-module-header" id="RepositoryArgs" data-link-title="RepositoryArgs">
    <a href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L73">
        interface <strong>RepositoryArgs</strong>
    </a>
</h3>

<pre class="highlight"><code><span class='kr'>interface</span> <span class='nx'>RepositoryArgs</span></code></pre>
<h4 class="pdoc-member-header" id="RepositoryArgs-lifeCyclePolicyArgs">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L88">property <b>lifeCyclePolicyArgs</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>lifeCyclePolicyArgs?: <a href='#LifecyclePolicyArgs'>LifecyclePolicyArgs</a>;</code></pre>

The arguments controlling the [LifecyclePolicy] for this [Repository].  If `undefined`, a default one will be
created using `LifecyclePolicy.getDefaultLifecyclePolicyArgs`.

<h4 class="pdoc-member-header" id="RepositoryArgs-repository">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L77">property <b>repository</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>repository?: <a href='/docs/reference/pkg/nodejs/pulumi/aws/ecr/#Repository'>aws.ecr.Repository</a>;</code></pre>

Underlying repository.  If not provided, a new one will be created on your behalf.

<h4 class="pdoc-member-header" id="RepositoryArgs-tags">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repository.ts#L82">property <b>tags</b></a>
</h4>

<pre class="highlight"><code><span class='kd'></span>tags?: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;Record&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>, <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>&gt;&gt;&gt;;</code></pre>

A mapping of tags to assign to the resource.

<h3 class="pdoc-module-header" id="RepositoryImage" data-link-title="RepositoryImage">
    <a href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repositoryImage.ts#L24">
        class <strong>RepositoryImage</strong>
    </a>
</h3>

<pre class="highlight"><code> <span class='kr'>implements</span> <a href='/docs/reference/pkg/nodejs/pulumi/awsx/ecs/#ContainerImageProvider'>ContainerImageProvider</a></code></pre>

A simple pair of a [Repository] and a built docker image that was pushed to it.  This can
be passed in as the `image: repoImage` value to an `ecs.Container`.

<h4 class="pdoc-member-header" id="RepositoryImage-constructor">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repositoryImage.ts#L26"> <b>constructor</b></a>
</h4>


<pre class="highlight"><code><span class='kd'></span><span class='kd'>new</span> RepositoryImage(repository: <a href='#Repository'>Repository</a>, image: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>&gt;)</code></pre>

<h4 class="pdoc-member-header" id="RepositoryImage-environment">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repositoryImage.ts#L34">method <b>environment</b></a>
</h4>


<pre class="highlight"><code><span class='kd'>public </span>environment(): <span class='kd'><a href='https://www.typescriptlang.org/docs/handbook/basic-types.html#never'>never</a></span>[]</code></pre>

<h4 class="pdoc-member-header" id="RepositoryImage-image">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repositoryImage.ts#L33">method <b>image</b></a>
</h4>


<pre class="highlight"><code><span class='kd'>public </span>image(): <span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span> | <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise'>Promise</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>&gt; | <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#OutputInstance'>OutputInstance</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>&gt;</code></pre>

<h4 class="pdoc-member-header" id="RepositoryImage-imageValue">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repositoryImage.ts#L26">property <b>imageValue</b></a>
</h4>

<pre class="highlight"><code><span class='kd'>public </span>imageValue: <a href='/docs/reference/pkg/nodejs/pulumi/pulumi/#Input'>pulumi.Input</a>&lt;<span class='kd'><a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String'>string</a></span>&gt;;</code></pre>
<h4 class="pdoc-member-header" id="RepositoryImage-repository">
<a class="pdoc-child-name" href="https://github.com/pulumi/pulumi-awsx/blob/7e3319acc1119743eb7e923349542ed966380c18/nodejs/awsx/ecr/repositoryImage.ts#L25">property <b>repository</b></a>
</h4>

<pre class="highlight"><code><span class='kd'>public </span>repository: <a href='#Repository'>Repository</a>;</code></pre>
