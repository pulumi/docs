<!-- Capability-aware breadcrumb implementation -->

<ol class="docs-breadcrumb">
    <!-- Always start with Docs home -->
    <li>
        <a data-track="breadcrumb" href="/docs/">
            Docs
        </a>
    </li>

    {{ $capability := .Params.capability }}
    {{ if $capability }}
        <!-- Capability-based breadcrumb path -->
        {{ $capabilityTitle := "" }}
        {{ $capabilityUrl := "" }}
        {{ $isCapabilityHomePage := .Params.docs_home }}
        
        {{ if eq $capability "build" }}
            {{ $capabilityTitle = "Build" }}
            {{ $capabilityUrl = "/docs/build/" }}
        {{ else if eq $capability "platform" }}
            {{ $capabilityTitle = "Platform" }}
            {{ $capabilityUrl = "/docs/platform/" }}
        {{ else if eq $capability "management" }}
            {{ $capabilityTitle = "Management" }}
            {{ $capabilityUrl = "/docs/management/" }}
        {{ else if eq $capability "developer-tools" }}
            {{ $capabilityTitle = "Developer Tools" }}
            {{ $capabilityUrl = "/docs/developer-tools/" }}
        {{ end }}

        {{ if $isCapabilityHomePage }}
            <!-- For capability landing pages, show as active (no extra level) -->
            <li class="active">
                <a>{{ $capabilityTitle }}</a>
            </li>
        {{ else }}
            <!-- For other capability pages, show capability link + current page -->
            <li>
                <a data-track="breadcrumb" href="{{ $capabilityUrl }}">
                    {{ $capabilityTitle }}
                </a>
            </li>
            <li class="active">
                <a>{{ .Title }}</a>
            </li>
        {{ end }}

    {{ else }}
        <!-- Fallback to path-based breadcrumb for pages without capability -->
        {{ template "pathbreadcrumb" (dict "p1" . "p2" .) }}
    {{ end }}
</ol>

<!-- Fallback path-based breadcrumb template (original logic) -->
{{ define "pathbreadcrumb" }}
    <!-- Don't include the website home page in the breadcrumb. -->
    {{ if and .p1.Parent (ne .p1.Parent .p1.Site.Home) }}
        {{ template "pathbreadcrumb" (dict "p1" .p1.Parent "p2" .p2) }}
    {{ end }}
    {{ if not (isset .p1.Params "redirect_to") }}
        <li {{ if eq .p1 .p2 }}class="active"{{ end }}>
            <a data-track="breadcrumb" href="{{ .p1.RelPermalink }}">
                {{ .p1.LinkTitle }}
            </a>
        </li>
    {{ end }}
{{ end }}