{{ $terraformCodeBlock := `- resource "aws_s3_bucket" "mybucket" {
-     bucket_prefix = "mybucket"
- }

- data "archive_file" "lambda_zip" {
-     type        = "zip"
-     output_path = "lambda.zip"

-     source {
-     filename = "index.js"
-     content = < {
-     console.log(JSON.stringify(ev))
- }
- EOF
-     }
- }

- data "aws_iam_policy_document" "lambda-assume-role-policy" {
-     statement {
-         actions = ["sts:AssumeRole"]

-         principals {
-             type        = "Service"
-             identifiers = ["lambda.amazonaws.com"]
-         }
-     }
- }

- resource "aws_iam_role" "lambda" {
-     assume_role_policy = "${data.aws_iam_policy_document.lambda-assume-role-policy.json}"
- }

- resource "aws_lambda_function" "my_lambda" {
-     filename = "${data.archive_file.lambda_zip.output_path}"
-     source_code_hash = "${data.archive_file.lambda_zip.output_base64sha256}"
-     function_name = "my_lambda"
-     role = "${aws_iam_role.lambda.arn}"
-     handler = "index.handler"
-     runtime = "nodejs8.10"
- }

- resource "aws_lambda_permission" "allow_bucket" {
-     statement_id  = "AllowExecutionFromS3Bucket"
-     action        = "lambda:InvokeFunction"
-     function_name = "${aws_lambda_function.my_lambda.arn}"
-     principal     = "s3.amazonaws.com"
-     source_arn    = "${aws_s3_bucket.mybucket.arn}"
- }

- resource "aws_s3_bucket_notification" "bucket_notification" {
-     bucket = "${aws_s3_bucket.mybucket.id}"

-     lambda_function {
-         lambda_function_arn = "${aws_lambda_function.my_lambda.arn}"
-         events              = ["s3:ObjectCreated:*"]
-     }
- }

- output "bucket_name" {
-     value = "${aws_s3_bucket.mybucket.id}"
- }`}}

{{ $typeScriptCodeBlock := `import * as aws from "@pulumi/aws";
import { readFileSync, readdirSync } from "fs";
import { join as pathjoin } from "path";

const bucket = new aws.s3.Bucket("mybucket");

const folder = "./files";
let files = readdirSync(folder);
for (let file of files) {
    const object = new aws.s3.BucketObject(file, {
        bucket: bucket,
        content: readFileSync(pathjoin(folder, file)).toString("utf8")
    });
}

export const bucketname = bucket.id;` }}

{{ $pythonCodeBlock := `+ import os

+ from pulumi import export, FileAsset
+ from pulumi_aws import s3

+ bucket = s3.Bucket('my-bucket')

+ for file in os.listdir('files'):
+     filepath = os.path.join(content_dir, file)
+     mime_type, _ = mimetypes.guess_type(filepath)
+     s3.BucketObject(file,
+         bucket=bucket.id,
+         source=FileAsset(filepath),
+         content_type=mime_type)

+ pulumi.export('bucket_name',  bucket.id)`}}

{{ $goCodeBlock := `package main

import (
    "io/ioutil"
    "github.com/pulumi/pulumi-aws/sdk/go/aws/s3"
    "github.com/pulumi/pulumi/sdk/go/pulumi"
)

func main() {
    pulumi.Run(func(ctx *pulumi.Context) error {
        bucket, err := s3.NewBucket(ctx, "my-bucket", nil)
        if err != nil {
            return err
        }

        files, err := ioutil.ReadDir("./")
        if err != nil {
            return err
        }

        for _, item := range files {
            name := item.Name()
            if _, err := s3.NewBucketObject(ctx, name, &s3.BucketObjectArgs{
                Bucket:      siteBucket.ID(),
                Source:      pulumi.NewFileAsset(filepath.Join(siteDir, name)),
                ContentType: pulumi.String(mime.TypeByExtension(path.Ext(name))),
            }); err != nil {
                return err
            }
        }

        ctx.Export("bucketName", bucket.ID())
        return nil
    })
}`}}

{{ $cSharpCodeBlock := `using System.Collections.Generic;
using System.Threading.Tasks;
using Pulumi;
using Pulumi.Aws.S3;

class Program
{
    static Task Main()
    {
        return Deployment.RunAsync(() => {
            var bucket = new Bucket("my-bucket");

            string[] files = Directory.GetFiles("./files");
            foreach (string fileName in fileEntries)
            {
                // ...upload the files to the bucket
            }

            return new Dictionary<string, object> {
                { "bucket_name" , bucket.Id },
            };
        });
    }
}`}}

<div id="terraformCompareCodeBlock" class="container mx-auto">
    {{ partial "chrome.html" . }}
    <div class="flex w-full">
        <div class="w-6/12 relative">
            <div class="absolute inset-0 code-diff-subtraction-overlay"></div>
            {{ partial "code" (dict "code" $terraformCodeBlock "lang" "plain" "mode" "dark" "opts" "linenos=true") }}
        </div>
        <div class="w-6/12 relative table">
            <!-- <div class="absolute inset-0 code-diff-addition-overlay"></div> -->
            {{ partial "code" (dict "code" $pythonCodeBlock "lang" "python" "mode" "dark" "opts" "linenos=true") }}
        </div>
    </div>
</div>

<!-- <div id="terraformCompareCodeBlock" class="flex mt-10">
    <div class="w-5/12">
        {{ partial "chrome.html" . }}
        <ul class="bg-gray-800">
            <li class="-mb-px mr-1">
                <span class="code-file-nav--item">main.tf</span>
            </li>
        </ul>
        {{ partial "code" (dict "code" $terraformCodeBlock "lang" "plain" "mode" "dark" "opts" "linenos=true") }}
    </div>
    <div class="w-1/12 text-center">
        <i class="fas fa-arrow-right text-6xl block mb-20 mt-10"></i>
        <i class="fas fa-arrow-right text-6xl block mb-20"></i>
    </div>
    <div class="w-6/12">
        {{ partial "chrome.html" . }}
        <div class="flex relative bg-gray-800 h-32">
            <div id="terraformComparePython">
                <a class="code-file-nav--item file-not-active" href="#">__main__.py</a>
                <div class="compare-code-block w-full absolute left-0 hidden">
                    {{ partial "code" (dict "code" $pythonCodeBlock "lang" "python" "mode" "dark" "opts" "linenos=true") }}
                </div>
            </div>
            <div id="terraformCompareGo">
                <a class="code-file-nav--item file-not-active" href="#">main.go</a>
                <div class="compare-code-block w-full absolute left-0 hidden">
                    {{ partial "code" (dict "code" $goCodeBlock "lang" "go" "mode" "dark" "opts" "linenos=true") }}
                </div>
            </div>
            <div id="terraformCompareCSharp">
                <a class="code-file-nav--item file-not-active" href="#">Program.cs</a>
                <div class="compare-code-block w-full absolute left-0 hidden">
                    {{ partial "code" (dict "code" $cSharpCodeBlock "lang" "csharp" "mode" "dark" "opts" "linenos=true") }}
                </div>
            </div>
            <div id="terraformCompareTypeScript" class="order-first">
                <a class="code-file-nav--item" href="#">index.ts</a>
                <div class="compare-code-block w-full absolute">
                    {{ partial "code" (dict "code" $typeScriptCodeBlock "lang" "typescript" "mode" "dark" "opts" "linenos=true") }}
                </div>
            </div>
        </div>
    </div>
</div> -->
