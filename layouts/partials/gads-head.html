<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

    <!-- GrowthBook / Segment keys -->
    <script>
        {{- if eq hugo.Environment "production" }}
            var segmentWriteKey = "UK90Ofwacetj5VCPJ7cUgkbNcKLSHO3u";
            var snippetName = "C8Y429BDEy/06ujkUhzfL.min.js";
            window.growthbook_sdk_key="sdk-psPofGr6jFV2ja9O";
            window.growthbook_decrypt_key="9NsAVMNWaDS+Oky3rhLQ+A==";
            window.growthbook_dev_mode=false;
        {{- else }}
            var segmentWriteKey = "bATvhu6XKpwi7Cs258MGsELkDpVOzvdY";
            var snippetName = "C8Y429BDEy/hpBKpR8Nx1yVCjKPB2nJWg.min.js";
            window.growthbook_sdk_key="sdk-BwIkZCqXQ9pZyp0P";
            window.growthbook_decrypt_key=undefined;
            window.growthbook_dev_mode=true;
        {{- end }}
    </script>

    <!-- Lightweight GADS assets (no jQuery) -->
    {{ partial "gads-assets" . }}

    <!-- Google Site Verification for Google Webmaster tools and YouTube. -->
    <meta name="google-site-verification" content="N-ezSTIu4P3bSc4TqidV4wWCkMzFiMN269ZgDYArGkk" />

    {{ if eq .Params.block_external_search_index true }}
        <meta name="robots" content="noindex" />
    {{ end }}

    <!-- Structured Data Schemas -->
    {{ partial "schema/loader.html" . }}

    <!--
        Metadata tags for OpenGraph and Twitter.
    -->

    {{ $ogImage := "/logos/brand/og-default.png" }}
    {{ $twitterImage := "/logos/brand/twitter-summary.png" }}
    {{ $twitterCardType := "summary" }}

    {{ if .Params.meta_image }}
        {{ $ogImage = .Params.meta_image }}
        {{ $twitterImage = $ogImage }}
        {{ $twitterCardType = "summary_large_image" }}
    {{ end }}

    <meta property="og:image" content="{{ $ogImage | absURL }}" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="{{ .Permalink }}" />
    <meta property="og:site_name" content="pulumi" />

    <meta name="twitter:image" content="{{ $twitterImage | absURL }}" />
    <meta name="twitter:card" content="{{ $twitterCardType }}" />
    <meta name="twitter:site" content="@PulumiCorp" />

    {{ if .Params.meta_title }}
        <meta property="og:title" content="{{ .Params.meta_title }}" />
    {{ else if .Params.title }}
        <meta property="og:title" content="{{ .Params.title }}" />
    {{ else }}
        <meta property="og:title" content="{{ .Site.Title }}" />
    {{ end }}

    {{ if .Params.meta_desc }}
        <meta name="description" content="{{ .Params.meta_desc }}" />
        <meta property="og:description" content="{{ .Params.meta_desc }}" />
    {{ else if and .IsHome .Site.Params.meta_desc }}
        <meta name="description" content="{{ .Site.Params.meta_desc }}" />
        <meta property="og:description" content="{{ .Site.Params.meta_desc }}" />
    {{ else if .Summary }}
        <meta name="description" content="{{ .Summary }}" />
        <meta property="og:description" content="{{ .Summary }}" />
    {{ end }}

    {{ if .IsHome }}
        <title>{{ .Site.Title }}</title>
    {{ else if .Title }}
        {{ $title := .Title }}
        {{ if .Params.title_tag }}
            {{ $title = .Params.title_tag }}
        {{ end }}
        <title>{{ $title }} | Pulumi</title>
    {{ end }}
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />

    <!--
        The canonical URL for the website. In all cases, this should be the public-facing
        production URL of the site, to avoid SEO penalties for duplicate content.
    -->

    {{ if .Params.canonical_url }}
        <link rel="canonical" href="{{ .Params.canonical_url }}" />
    {{ else }}
        <link rel="canonical" href="{{ .Site.Params.canonicalURL }}{{ .RelPermalink }}" />
    {{ end }}

    <!-- RSS link for the blog. -->
    <link rel="alternate" type="application/rss+xml" href="{{ "/blog/rss.xml" | absURL }}" title="Pulumi Blog" />

    <!-- Lazy-load Sentry - deferred to not block rendering -->
    <script src="https://js.sentry-cdn.com/02614bf2f18e4615a73218b810563ced.min.js" crossorigin="anonymous" defer></script>
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            if (typeof Sentry !== 'undefined') {
                Sentry.onLoad(function() {
                    Sentry.init({
                        environment: "{{ hugo.Environment }}",
                        {{ if in "preview production" hugo.Environment }}
                            release: "{{ getenv "ASSET_BUNDLE_ID" }}",
                        {{ end }}
                        beforeSend(event) {
                            const ua = event.request.headers["User-Agent"];
                            if (ua && ua.match(/Linespider|Yeti/)) {
                                return null;
                            }
                            return event;
                        }
                    });
                });
            }
        });
    </script>

    <!--Segment tracking-->
    <script>
        // Do not load Segment for these user agents.
        userAgentBlacklist = [
            'Mozilla/5.0 (compatible; SiteAuditBot/0.97; +http://www.semrush.com/bot.html)',
            'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36'
        ]

        !(function () {
            var i = "analytics",
                analytics = (window[i] = window[i] || []);
            if (!analytics.initialize)
                if (analytics.invoked) {
                    window.console && console.error && console.error("Segment snippet included twice.");
                } else if (userAgentBlacklist.includes(navigator.userAgent)) {
                    console.log("Segment snippet not loaded for user agent: " + navigator.userAgent);
                } else {
                    analytics.invoked = !0;
                    analytics.methods = [
                        "trackSubmit",
                        "trackClick",
                        "trackLink",
                        "trackForm",
                        "pageview",
                        "identify",
                        "reset",
                        "group",
                        "track",
                        "ready",
                        "alias",
                        "debug",
                        "page",
                        "screen",
                        "once",
                        "off",
                        "on",
                        "addSourceMiddleware",
                        "addIntegrationMiddleware",
                        "setAnonymousId",
                        "addDestinationMiddleware",
                        "register",
                    ];
                    analytics.factory = function (e) {
                        return function () {
                            if (window[i].initialized) return window[i][e].apply(window[i], arguments);
                            var n = Array.prototype.slice.call(arguments);
                            if (["track", "screen", "alias", "group", "page", "identify"].indexOf(e) > -1) {
                                var c = document.querySelector("link[rel='canonical']");
                                n.push({ __t: "bpc", c: (c && c.getAttribute("href")) || void 0, p: location.pathname, u: location.href, s: location.search, t: document.title, r: document.referrer });
                            }
                            n.unshift(e);
                            analytics.push(n);
                            return analytics;
                        };
                    };
                    for (var n = 0; n < analytics.methods.length; n++) {
                        var key = analytics.methods[n];
                        analytics[key] = analytics.factory(key);
                    }
                    analytics.load = function (key, n) {
                        var t = document.createElement("script");
                        t.type = "text/javascript";
                        t.async = !0;
                        t.setAttribute("data-global-segment-analytics-key", i);
                        t.src = "https://evs.analytics.pulumi.com/" + snippetName;
                        var r = document.getElementsByTagName("script")[0];
                        r.parentNode.insertBefore(t, r);
                        analytics._loadOptions = n;
                    };
                    analytics._writeKey = segmentWriteKey;
                    analytics._cdn = "https://evs.analytics.pulumi.com";
                    analytics.SNIPPET_VERSION = "5.2.0";
                    analytics.load(segmentWriteKey);
                    analytics.page();
                }
        })();
    </script>

    <!-- Segment Consent Manager -->
    <script>
        window.consentManagerConfig = function(exports) {
            var React = exports.React;
            var inEU = exports.inEU;

            var bannerContent = React.createElement(
                'span',
                null,
                'We use cookies (and other similar technologies) to collect data to improve your experience on our site. By using our website, you’öre agreeing to the collection of data as described in our',
                ' ',
                React.createElement(
                    'a',
                    { href: '/privacy/', target: '_blank' },
                    'Privacy Policy'
                ),
                '.'
            )
            var bannerSubContent = React.createElement(
                'div',
                { class: "manage-cookies-btn" },
                'Manage cookies'
            )
            var preferencesDialogTitle = 'Website Data Collection Preferences'
            var preferencesDialogContent =
                'We use data collected by cookies and JavaScript libraries to improve your browsing experience, analyze site traffic, deliver personalized advertisements, and increase the overall performance of our site.'
            var cancelDialogTitle = 'Are you sure you want to cancel?'
            var cancelDialogContent =
                'Your preferences have not been saved. By continuing to use our website, you are agreeing to our Website Data Collection Policy.'

            return {
                container: '#segment-consent-manager',
                writeKey: segmentWriteKey,
                bannerContent: bannerContent,
                bannerSubContent: bannerSubContent,
                preferencesDialogTitle: preferencesDialogTitle,
                preferencesDialogContent: preferencesDialogContent,
                cancelDialogTitle: cancelDialogTitle,
                cancelDialogContent: cancelDialogContent,
                shouldRequireConsent: exports.inEU,
                closeBehavior: exports.inEU() ? "dismiss" : "accept",
                bannerTextColor: "black",
                cdnHost: "evs.analytics.pulumi.com",
                shouldReload: false
            }
        }
    </script>

    <script
        src="/js/consent-manager.js"
        defer
    ></script>

    {{- if eq hugo.Environment "production" }}
        <!-- Clearbit snippet -->
        <script src="https://tag.clearbitscripts.com/v1/pk_54e7d7c428c6d5e79098374d93a7b333/tags.js" referrerpolicy="strict-origin-when-cross-origin" defer></script>

        <!-- Facebook Domain Verification -->
        <meta name="facebook-domain-verification" content="phlf6qes2bxa9ufzk8zt2es0qivg8j" />

        <!-- Common Room-->
        <script>
            (function() {
                if (typeof window === 'undefined') return;
                if (typeof window.signals !== 'undefined') return;
                var script = document.createElement('script');
                script.src = 'https://cdn.cr-relay.com/v1/site/a725b5ba-75f1-44dc-b250-11023fc10b9d/signals.js';
                script.async = true;
                window.signals = Object.assign(
                    [],
                    ['page', 'identify', 'form'].reduce(function (acc, method){
                        acc[method] = function () {
                        signals.push([method, arguments]);
                        return signals;
                        };
                        return acc;
                    }, {})
                );
                document.head.appendChild(script);
            })();
        </script>

        <!-- RB2B -->
        <script>
            !function () {var reb2b = window.reb2b = window.reb2b || [];
            if (reb2b.invoked) return;reb2b.invoked = true;reb2b.methods = ["identify", "collect"];
            reb2b.factory = function (method) {return function () {var args = Array.prototype.slice.call(arguments);
            args.unshift(method);reb2b.push(args);return reb2b;};};
            for (var i = 0; i < reb2b.methods.length; i++) {var key = reb2b.methods[i];reb2b[key] = reb2b.factory(key);}
            reb2b.load = function (key) {var script = document.createElement("script");script.type = "text/javascript";script.async = true;
            script.src = "https://s3-us-west-2.amazonaws.com/b2bjsstore/b/" + key + "/reb2b.js.gz";
            var first = document.getElementsByTagName("script")[0];
            first.parentNode.insertBefore(script, first);};
            reb2b.SNIPPET_VERSION = "1.0.1";reb2b.load("Y4O7Z0HKLKNX");}();
        </script>
    {{- end }}
</head>
