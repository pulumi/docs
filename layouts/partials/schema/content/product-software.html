{{/* SoftwareApplication Schema for Product Pages */}}

{{ if eq .Section "product" }}
  {{/* Get product entities with relationships */}}
  {{ $productEntities := partial "schema/utils/product-entities.html" . }}
  {{ $mainProduct := $productEntities.mainProduct }}
  {{ $relatedProducts := $productEntities.relatedProducts }}
  
  {{/* Determine product name and details based on page */}}
  {{ $productName := .Title }}
  {{ $productDescription := or .Params.meta_desc .Summary }}
  {{ $applicationCategory := "DeveloperApplication" }}
  {{ $applicationSubCategory := "" }}
  
  {{/* Product-specific customization */}}
  {{ if in .RelPermalink "/pulumi-cloud/" }}
    {{ $productName = "Pulumi Cloud" }}
    {{ $productDescription = "Enterprise-grade infrastructure management platform with state storage, secrets management, and team collaboration features." }}
    {{ $applicationSubCategory = "Cloud Management Platform" }}
    
  {{ else if in .RelPermalink "/pulumi-deployments/" }}
    {{ $productName = "Pulumi Deployments" }}
    {{ $productDescription = "Automated infrastructure deployment service with git-based workflows and CI/CD integration." }}
    {{ $applicationSubCategory = "Deployment Automation" }}
    
  {{ else if in .RelPermalink "/pulumi-insights/" }}
    {{ $productName = "Pulumi Insights" }}
    {{ $productDescription = "Search and analytics across your entire cloud infrastructure with AI-powered insights." }}
    {{ $applicationSubCategory = "Cloud Analytics" }}
    
  {{ else if in .RelPermalink "/infrastructure-as-code/" }}
    {{ $productName = "Pulumi IaC" }}
    {{ $productDescription = "Core infrastructure as code engine supporting TypeScript, Python, Go, C#, Java, and YAML." }}
    {{ $applicationSubCategory = "Infrastructure as Code" }}
    
  {{ else if in .RelPermalink "/secrets-management/" }}
    {{ $productName = "Pulumi ESC" }}
    {{ $productDescription = "Centralized secrets and configuration management across clouds and environments." }}
    {{ $applicationSubCategory = "Secrets Management" }}
    
  {{ else if in .RelPermalink "/neo/" }}
    {{ $productName = "Pulumi Neo" }}
    {{ $productDescription = "AI-powered infrastructure assistant that generates, reviews, and debugs infrastructure code." }}
    {{ $applicationSubCategory = "AI Assistant" }}
    {{ $applicationCategory = "ArtificialIntelligenceApplication" }}
  {{ end }}
  
  {{ $schema := dict
    "@context" "https://schema.org"
    "@type" "SoftwareApplication"
    "@id" (printf "%s#software" .Permalink)
    "name" $productName
    "description" $productDescription
    "url" .Permalink
    "applicationCategory" $applicationCategory
    "operatingSystem" (slice "Windows" "macOS" "Linux" "Web")
    "creator" (dict "@id" "https://www.pulumi.com/#organization")
    "maintainer" (dict "@id" "https://www.pulumi.com/#organization")
    "offers" (dict
      "@type" "Offer"
      "seller" (dict "@id" "https://www.pulumi.com/#organization")
      "url" "https://www.pulumi.com/pricing/"
    )
    "softwareRequirements" "Modern web browser or Pulumi CLI"
    "inLanguage" "en-US"
    "isAccessibleForFree" false
    "audience" (dict
      "@type" "Audience"
      "audienceType" "Developers, DevOps Engineers, Platform Engineers"
    )
  }}
  
  {{/* Add sub-category if defined */}}
  {{ if $applicationSubCategory }}
    {{ $schema = merge $schema (dict "applicationSubCategory" $applicationSubCategory) }}
  {{ end }}
  
  
  {{/* Add software version if applicable */}}
  {{ if in .RelPermalink "/infrastructure-as-code/" }}
    {{ $schema = merge $schema (dict
      "softwareVersion" (or .Site.Params.latest_version "3.198.0")
      "downloadUrl" "https://get.pulumi.com/"
      "installUrl" "https://www.pulumi.com/docs/iac/download-install/"
      "releaseNotes" "https://www.pulumi.com/docs/reference/changelog/"
      "license" "Apache-2.0"
    ) }}
  {{ end }}
  
  {{/* Add features as keywords */}}
  {{ $features := slice }}
  {{ if in .RelPermalink "/pulumi-cloud/" }}
    {{ $features = slice "state management" "team collaboration" "RBAC" "audit logs" "webhooks" }}
  {{ else if in .RelPermalink "/pulumi-deployments/" }}
    {{ $features = slice "git integration" "automated deployments" "CI/CD" "preview environments" }}
  {{ else if in .RelPermalink "/pulumi-insights/" }}
    {{ $features = slice "resource search" "cost analysis" "compliance" "analytics" }}
  {{ else if in .RelPermalink "/neo/" }}
    {{ $features = slice "AI code generation" "infrastructure debugging" "automated reviews" }}
  {{ end }}
  {{ if $features }}
    {{ $schema = merge $schema (dict "featureList" $features) }}
    {{ $schema = merge $schema (dict "keywords" (delimit $features ", ")) }}
  {{ end }}
  
  {{/* Add screenshots/images if available */}}
  {{ with .Params.meta_image }}
    {{ $image := . }}
    {{ if not (hasPrefix $image "http") }}
      {{ $image = printf "https://www.pulumi.com%s" $image }}
    {{ end }}
    {{ $schema = merge $schema (dict "screenshot" $image) }}
  {{ end }}
  
  {{/* Use product entity if available for rich relationships */}}
  {{ if $mainProduct }}
    {{/* Merge in the full product entity with relationships */}}
    {{ $schema = merge $schema $mainProduct }}
  {{ else }}
    {{/* Add isPartOf relationship to main Pulumi platform */}}
    {{ $schema = merge $schema (dict "isPartOf" (dict
      "@type" "SoftwareApplication"
      "@id" "https://www.pulumi.com/#pulumi-cli"
      "name" "Pulumi"
    )) }}
  {{ end }}
  
  {{/* Related products are now handled through isPartOf relationship for semantic accuracy */}}
  
  <script type="application/ld+json">
  {{ $schema | jsonify | safeJS }}
  </script>
{{ end }}