{{/* Main Schema Loader - Controls all structured data generation */}}

{{/* Skip schemas for external content */}}
{{ if not .Params.external }}

  {{/* Feature flag for @graph implementation on test pages */}}
  {{ $enableGraph := false }}
  {{ $testPages := slice
      "/blog/pulumi-neo/"
      "/tutorials/creating-resources-aws/"
      "/docs/iac/clouds/aws/guides/cdk/"
      "/product/neo/"
      "/"
  }}

  {{/* Check if current page is in test group */}}
  {{ if in $testPages .RelPermalink }}
    {{ $enableGraph = true }}
  {{ end }}

  {{/* Use @graph for test pages */}}
  {{ if $enableGraph }}
    {{ partial "schema/graph-builder.html" . }}
  {{ else }}

  {{/* Homepage: Load all base schemas */}}
  {{ if .IsHome }}
    {{ partial "schema/base/website.html" . }}
    {{ partial "schema/base/organization.html" . }}
    {{ partial "schema/base/software-app.html" . }}
  {{ end }}

  {{/* Breadcrumbs: All non-home pages */}}
  {{ if not .IsHome }}
    {{ partial "schema/base/breadcrumb.html" . }}
  {{ end }}

  {{/* Content-specific schemas based on type/section */}}
  {{ if and (eq .Type "blog") .IsPage }}
    {{ partial "schema/content/blog.html" . }}
    
  {{ else if eq .Type "docs" }}
    {{ partial "schema/content/article.html" . }}
    
  {{ else if eq .Type "tutorials" }}
    {{ partial "schema/content/howto.html" . }}
    
  {{ else if eq .Type "webinars" }}
    {{ partial "schema/content/event.html" . }}
    
  {{ else if eq .Section "product" }}
    {{ partial "schema/content/product-software.html" . }}
    
  {{ else if eq .Section "templates" }}
    {{/* Templates are content pages, use Article schema */}}
    {{ partial "schema/content/article.html" . }}
    
  {{ else if eq .Type "case-studies" }}
    {{ partial "schema/content/article.html" . }}
  {{ end }}

  {{/* Special page schemas */}}
  {{ if and (eq .RelPermalink "/pricing/") .Params.faq }}
    {{ partial "schema/content/qa.html" . }}
  {{ end }}

  {{/* Video schema for YouTube embeds */}}
  {{ if or (in .RawContent "{{< youtube") (in .Content "youtube.com/embed") }}
    {{ partial "schema/content/video.html" . }}
  {{ end }}

  {{/* HowTo schema for step-by-step tutorials */}}
  {{ if and .IsPage (or (in .Content "1. ") (in .Content "Step 1")) }}
    {{ if or (eq .Type "docs") (eq .Type "tutorials") }}
      {{ partial "schema/content/howto.html" . }}
    {{ end }}
  {{ end }}

  {{/* SoftwareSourceCode schema for code examples */}}
  {{ if and .IsPage (in .Content "```") }}
    {{ if or (eq .Type "docs") (eq .Type "tutorials") (eq .Type "blog") }}
      {{ partial "schema/content/code.html" . }}
    {{ end }}
  {{ end }}

  {{/* Keep backward compatibility for existing event schemas */}}
  {{ if or .Params.event_data .Params.exhibition_data }}
    {{ if not .Params.external }}
      {{ partial "schema/content/event.html" . }}
    {{ end }}
  {{ end }}

  {{ end }}{{/* End else for graph mode */}}

{{ end }}