<nav class="main-nav">



    {{ if eq .RelPermalink "/tutorials/" }}
        {{ $toc_page := . }}
        {{ $toc_sections := slice "Collections" }}
        {{ $toc_menus := dict "Collections" .Site.Data.tutorials.collections }}

        {{ range $index, $element := $toc_sections }}
            {{ $sidenav_selected := "" }}
            {{ $toc_name := . }}
            {{ $toc_menu := (index $toc_menus $toc_name) }}

            {{ $toc_section_link := "" }}

            {{ $toggle_class := "toggle" }}
            {{ if or (hasPrefix $.Page.RelPermalink $toc_section_link) (eq $toc_name "Clouds") }}
                {{ $toggle_class = "toggleVisible " }}
            {{ end }}

            <div id="toc-menu-{{ $toc_name }}" class="{{ $sidenav_selected }} text-black toc-header toggle-topLevel {{ $toggle_class }}" id="{{ $toc_name | urlize }}-toc-header">
                <div class="flex items-start">
                    <div class="icon icon-14-14 folder-open-14-14"></div>
                </div>
                <a href="{{ $toc_section_link }}">
                    <span class="text-black">{{ $toc_name }}</span>
                </a>
                <span class="toggleButton-topLevel down">
                    <div class="icon icon-14-14 keyboard-arrow-down-gray-14-14"></div>
                </span>
                <span class="toggleButton-topLevel right">
                    <div class="icon icon-14-14 keyboard-arrow-right-gray"></div>
                </span>
            </div>

            <div class="top-level-container">
                {{ template "toc-tutorials" (dict "page" $toc_page "menu" $toc_menu "taxonomies" $.Site.Taxonomies) }}
            </div>
        {{ end }}
    {{ else }}
        {{ $toc_name := .Scratch.Get "title" }}
        {{ $layout_type := .Scratch.Get "layout"}}
        {{ $sidenav_selected := "" }}
        {{ $toggle_state := "toggle" }}
        {{ $toggle_class := "toggle" }}
        {{ if ne $layout_type "topic" }}
            <div id="toc-menu-{{ $toc_name }}" class="{{ $sidenav_selected }} text-black toc-header toggle-topLevel {{ $toggle_class }}" id="{{ $toc_name | urlize }}-toc-header">
                <div class="flex items-start topic-badge">
                    <div class="icon icon-14-14 folder-open-14-14"></div>
                </div>
                <a>{{ $toc_name }}</a>
            </div>
            <div class="sidenav-subsection">
                <ul class="collapsed">
                    {{ $sorted_pages := sort .Pages ".Params.index" }}
                    {{ range $sorted_pages }}
                    <li class="sidenav-topic">
                        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                    </li>
                    {{ end }}
                </ul>
            </div>
        {{ else }}
            <div id="toc-menu-{{ $toc_name }}" class="{{ $sidenav_selected }} text-black toc-header toggle-topLevel {{ $toggle_class }}" id="{{ $toc_name | urlize }}-toc-header">
                <div class="flex items-start topic-badge">
                    <div class="icon icon-14-14 folder-open-14-14"></div>
                </div>
                <a href="{{ .Page.Parent.RelPermalink }}">{{ .Parent.Title }}</a>
            </div>
            <div class="sidenav-subsection">
                <ul class="collapsed">
                    {{ $sorted_pages := sort .Parent.Pages ".Params.index" }}
                    {{ range $sorted_pages }}
                        <li class="sidenav-topic">
                            <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                        </li>
                    {{ end }}
                </ul>
            </div>
        {{ end }}

    {{ end }}


    {{ define "toc-tutorials" }}
        {{ $page := .page }}
        {{ $tutorialTaxonomies := slice .taxonomies.collections }}
        {{ $tutorialTaxonomies }}

        {{ range .menu }}
            {{ $toggle_state := "toggle" }}
            {{ $filepath := .menu }}

            <ul id="toc-expandable-menu{{ replace $filepath "/" "-" }}" class="{{ $toggle_state }}">
                <ul class="collapsed">

                    {{ $thisGroup := index (where $tutorialTaxonomies "id" .id) 0 }}

                    {{ if $thisGroup }}
                        <li class="sidenav-topic">
                            <a href="/tutorials/{{ .id }}" data-track="toc-{{ .shortname | urlize }}">{{ .name }}</a>
                            {{ if .HasChildren }}
                                <span class="toggleButton">
                                    <div class="icon icon-14-14 keyboard-arrow-right-gray"></div>
                                </span>
                            {{ end }}
                        </li>
                    {{ end }}
                </ul>
                <ul class="expanded">
                    <li class="sidenav-topic">



                        <a href="{{ .URL }}" data-track="toc-{{ .shortname | urlize }}">{{ .shortname }} tutorials</a>
                        {{ if .HasChildren }}
                            <span class="toggleButton">
                                <div class="icon icon-14-14 keyboard-arrow-down-gray-14-14"></div>
                            </span>
                        {{ end }}
                    </li>
                    {{ if .HasChildren }}
                        <div class="sidenav-subsection">
                            {{ template "toc-tutorials" (dict "page" $page "menu" .Children) }}
                        </div>
                    {{ end }}
                </ul>
            </ul>
        {{ end }}
    {{ end }}
</nav>
