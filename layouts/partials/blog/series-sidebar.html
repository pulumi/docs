<!--
    Series sidebar, showing all posts in the current series with the current post highlighted.
-->
<aside class="lg:pr-8 sticky-sidebar">
    <!-- Sidebar menu toggle for mobile. -->
    <div class="lg:hidden">
        <button class="blog-sidebar-toggle items-center px-3 py-2 border rounded text-purple border-purple">Toggle Series Navigation</button>
    </div>

    <h2 class="no-anchor hidden lg:flex mt-2 mb-6">
        <a data-track="sidebar" class="text-2xl" href="{{ relref . "/blog" }}">Pulumi Blog</a>
    </h2>

    <!-- Sidebar content. Hidden on smaller displays unless toggled. -->
    <div class="blog-sidebar-content hidden lg:block">
        {{ partial "blog/search" . }}

        <hr class="my-8" />

        {{ $currentSeries := .Page.Params.series }}
        {{ if $currentSeries }}
            <!-- Series Navigation -->
            <div class="my-4">
                <h5 class="no-anchor text-lg font-semibold mb-4">In This Series</h5>
                
                <!-- Get all posts with the same series tag, including future posts, sorted chronologically -->
                {{ $allPages := .Site.AllPages }}
                {{ $seriesPosts := where $allPages "Params.series" $currentSeries }}
                {{ $seriesPosts := $seriesPosts.ByDate }}
                
                <ul class="list-none p-0 space-y-3">
                    {{ range $index, $post := $seriesPosts }}
                        <li class="leading-snug">
                            {{ if eq $post.RelPermalink $.Page.RelPermalink }}
                                <!-- Current post - highlighted -->
                                <div class="bg-blue-50 border-l-4 border-blue-500 pl-3 py-2 rounded-r">
                                    {{ if strings.Contains $post.Title ":" }}
                                        {{ $titleParts := split $post.Title ":" }}
                                        <div class="text-sm font-semibold text-blue-900">{{ add $index 1 }}. {{ trim (index $titleParts 0) " " }}</div>
                                        <div class="text-xs text-blue-700 mt-1">{{ trim (index $titleParts 1) " " }}</div>
                                    {{ else }}
                                        <span class="text-sm font-semibold text-blue-900">{{ add $index 1 }}. {{ $post.Title }}</span>
                                    {{ end }}
                                    <div class="text-xs text-blue-600 mt-1">Current post</div>
                                </div>
                            {{ else }}
                                <!-- Other posts in series -->
                                {{ if $post.Date.After now }}
                                    <!-- Future post - show as coming soon -->
                                    <div class="pl-3 py-1 opacity-60">
                                        <div class="text-sm text-gray-500">
                                            {{ if strings.Contains $post.Title ":" }}
                                                {{ $titleParts := split $post.Title ":" }}
                                                <div class="font-medium">{{ add $index 1 }}. {{ trim (index $titleParts 0) " " }}</div>
                                                <div class="text-xs text-gray-400 mt-1">{{ trim (index $titleParts 1) " " }}</div>
                                            {{ else }}
                                                {{ add $index 1 }}. {{ $post.Title }}
                                            {{ end }}
                                        </div>
                                        <div class="text-xs text-blue-400 mt-1">Coming {{ $post.Date.Format "Jan 2" }}</div>
                                    </div>
                                {{ else }}
                                    <!-- Published post -->
                                    <div class="pl-3 py-1">
                                        <a data-track="series-post" class="text-sm hover:text-blue-600" href="{{ $post.RelPermalink }}">
                                            {{ if strings.Contains $post.Title ":" }}
                                                {{ $titleParts := split $post.Title ":" }}
                                                <div class="font-medium">{{ add $index 1 }}. {{ trim (index $titleParts 0) " " }}</div>
                                                <div class="text-xs text-gray-600 mt-1">{{ trim (index $titleParts 1) " " }}</div>
                                            {{ else }}
                                                {{ add $index 1 }}. {{ $post.Title }}
                                            {{ end }}
                                        </a>
                                    </div>
                                {{ end }}
                            {{ end }}
                        </li>
                    {{ end }}
                </ul>
                
                <!-- Link to view all series posts -->
                <div class="mt-4 pt-3">
                    <a class="text-blue-600 text-sm" href="/blog/tag/{{ $currentSeries | urlize }}/">View whole series &rarr;</a>
                </div>
            </div>
        {{ end }}

        <hr class="my-8" />

        {{ partial "sidebar-cta" . }}
    </div>

    <div class="lg:hidden pb-4">
        <!-- Vertical spacer, for mobile layouts. -->
    </div>
</aside>
