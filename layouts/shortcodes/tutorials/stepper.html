{{/* Emits PREVIOUS and NEXT buttons based on the pages in the current directory,
    ordered by page index param.
*/}}

{{ $currentPage := .Page }}

{{/* Get the pages in the current directory. */}}
{{ $unsortedPages := slice $currentPage }}

{{ range $index, $page := .Page.Parent.CurrentSection.Pages }}
    {{ if (ne $page.RelPermalink $currentPage.RelPermalink) }}
        {{ $unsortedPages = $unsortedPages | append $page }}
    {{ end }}
{{ end }}

{{/* Sort by index number. */}}
{{ $pages := sort $unsortedPages ".Params.index" }}

{{/* Set the first and last indexes. */}}
{{ $first := 0 }}
{{ $last := sub (len $pages) 1 }}

{{/* Determine the index of the current step. */}}
{{ $step := -1 }}
{{ range $index, $element := $pages }}
    {{ if eq $element.RelPermalink $currentPage.RelPermalink }}
        {{ $step = $index }}
    {{ end }}
{{ end }}

{{ .Page.Parent }}

<div class="mt-6">
    {{ if ne $step $first }}
        {{ $prev := index $pages (sub $step 1) }}
        <a data-track="previous-step" class="btn btn-secondary" href="{{ $prev.RelPermalink }}">&larr; Previous Topic</a>
    {{ else }}
        <a data-track="previous-step" class="btn btn-secondary" href="{{ .Page.Parent.RelPermalink }}">&larr; Back to {{ .Page.Parent.Title }}</a>
    {{ end }}
    {{ if ne $step $last }}
        {{ $next := index $pages (add $step 1) }}
        <a data-track="next-step" class="btn" href="{{ $next.RelPermalink }}">Next Topic: {{ $next.LinkTitle }} &rarr;</a>
    {{ else }}
        <a data-track="next-step" class="btn" href="{{ .Page.Parent.RelPermalink }}">Return to {{ .Page.Parent.Title }} &rarr;</a>
    {{ end }}
</div>
